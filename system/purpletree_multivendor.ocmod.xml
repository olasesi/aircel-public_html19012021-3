<modification>
	<name>Purpletree Multivendor for OpenCart 3.x</name>
	<code>Purpletree Multivendor for OpenCart 3.x</code>
	<version>3.x</version> 
	<author>Purpletree</author>
			<file path="admin/controller/common/column_left.php">
		<operation error="skip"> 
			<search><![CDATA[$report = array();]]></search> 
			<add position="before"><![CDATA[
			/*********   Purpletree Multivendor Left Menu   ************/
			if ($this->config->get('module_purpletree_multivendor_status')) {
						$purpletree_multivendor = array();
			if ($this->user->hasPermission('access', 'extension/module/purpletree_multivendor')) {
				$purpletree_multivendor[] = array(
					'name'	   => $this->language->get('text_pt_setting'),
					'href'     => $this->url->link('extension/module/purpletree_multivendor', 'user_token=' . $this->session->data['user_token'], true),
					'children' => array()		
				);	
			}
			if ($this->user->hasPermission('access', 'extension/purpletree_multivendor/vendor')) {
				$purpletree_multivendor[] = array(
					'name'	   => $this->language->get('text_pt_vendors'),
					'href'     => $this->url->link('extension/purpletree_multivendor/vendor', 'user_token=' . $this->session->data['user_token'], true),
					'children' => array()		
				);	
			}
			if ($this->user->hasPermission('access', 'extension/purpletree_multivendor/stores')) {
				$purpletree_multivendor[] = array(
					'name'	   => $this->language->get('text_pt_stores'),
					'href'     => $this->url->link('extension/purpletree_multivendor/stores', 'user_token=' . $this->session->data['user_token'], true),
					'children' => array()		
				);	
			}
			
			if ($this->user->hasPermission('access', 'extension/purpletree_multivendor/sellerproducts')) {
				$purpletree_multivendor[] = array(
					'name'	   => $this->language->get('text_pt_sellerproducts'),
					'href'     => $this->url->link('extension/purpletree_multivendor/sellerproducts', 'user_token=' . $this->session->data['user_token'], true),
					'children' => array()		
				);	
			}
			if($this->config->get('module_purpletree_multivendor_seller_product_template')){
			if ($this->user->hasPermission('access', 'extension/purpletree_multivendor/admintemplate')) {
				$purpletree_multivendor[] = array(
					'name'	   => $this->language->get('text_admintemplate'),
					'href'     => $this->url->link('extension/purpletree_multivendor/admintemplate', 'user_token=' . $this->session->data['user_token'], true),
					'children' => array()		
				);	
			}
			if ($this->user->hasPermission('access', 'extension/purpletree_multivendor/admintemplate')) {
				$purpletree_multivendor[] = array(
					'name'	   => $this->language->get('text_sellertemplate'),
					'href'     => $this->url->link('extension/purpletree_multivendor/producttemplate', 'user_token=' . $this->session->data['user_token'], true),
					'children' => array()		
				);	
			}
			}
			$orderstatus = 0;
			if(null !== $this->config->get('module_purpletree_multivendor_commission_status')) {
				$orderstatus = $this->config->get('module_purpletree_multivendor_commission_status');
			}
			if ($this->user->hasPermission('access', 'extension/purpletree_multivendor/sellerorders')) {
				$purpletree_multivendor[] = array(
					'name'	   => $this->language->get('text_pt_sellerorders'),
					'href'     => $this->url->link('extension/purpletree_multivendor/sellerorders', 'filter_order_status='."".'&filter_admin_order_status='."".'&user_token=' . $this->session->data['user_token'], true),
					'children' => array()		
				);	
			}
			if ($this->user->hasPermission('access', 'extension/purpletree_multivendor/commissioninvoice')) {
				$purpletree_multivendor[] = array(
					'name'	   => $this->language->get('text_pt_commissioninvoice'),
					'href'     => $this->url->link('extension/purpletree_multivendor/commissioninvoice', 'user_token=' . $this->session->data['user_token'], true),
					'children' => array()		
				);	
			}
				if ($this->user->hasPermission('access', 'extension/purpletree_multivendor/sellercommission')) {
				$purpletree_multivendor[] = array(
					'name'	   => $this->language->get('text_pt_sellercommission'),
					'href'     => $this->url->link('extension/purpletree_multivendor/sellercommission', 'user_token=' . $this->session->data['user_token'], true),
					'children' => array()		
				);	
			}
			if ($this->user->hasPermission('access', 'extension/purpletree_multivendor/sellerreviews')) {
				$purpletree_multivendor[] = array(
					'name'	   => $this->language->get('text_pt_sellerreviews'),
					'href'     => $this->url->link('extension/purpletree_multivendor/sellerreviews', 'user_token=' . $this->session->data['user_token'], true),
					'children' => array()		
				);	
			}
			if ($this->user->hasPermission('access', 'extension/purpletree_multivendor/sellercontacts')) {
				$purpletree_multivendor[] = array(
					'name'	   => $this->language->get('text_pt_sellercontacts'),
					'href'     => $this->url->link('extension/purpletree_multivendor/sellercontacts', 'user_token=' . $this->session->data['user_token'], true),
					'children' => array()		
				);	
			}
			if ($this->user->hasPermission('access', 'extension/purpletree_multivendor/sellerenquiries')) {
				$purpletree_multivendor[] = array(
					'name'	   => $this->language->get('text_pt_seller_enquiries'),
					'href'     => $this->url->link('extension/purpletree_multivendor/sellerenquiries', 'user_token=' . $this->session->data['user_token'], true),
					'children' => array()		
				);	
			}
						/*********   Purpletree Multivendor Seller Bloog   ************/
			$purpletree_multivendor_seller_blog = array();
			
				if ($this->user->hasPermission('access', 'extension/purpletree_multivendor/sellerblogpost')) {
				$purpletree_multivendor_seller_blog[] = array(
					'name'	   => $this->language->get('text_blog_post'),
					'href'     => $this->url->link('extension/purpletree_multivendor/sellerblogpost', 'user_token=' . $this->session->data['user_token'], true),
					'children' => array()		
				);	
			}
				if ($this->user->hasPermission('access', 'extension/purpletree_multivendor/sellerblogcomment')) {
				$purpletree_multivendor_seller_blog[] = array(
					'name'	   => $this->language->get('text_blog_comment'),
					'href'     => $this->url->link('extension/purpletree_multivendor/sellerblogcomment', 'user_token=' . $this->session->data['user_token'], true),
					'children' => array()		
				);	
			}
		
			if ($purpletree_multivendor_seller_blog) {
				$purpletree_multivendor[] = array(				
					'name'	   => $this->language->get('text_purpletree_blog'),
					'href'     => '',
					'children' => $purpletree_multivendor_seller_blog
				);	
			}
			
		  /*********   End Purpletree Multivendor Seller Bloog   ************/
			
			if ($this->user->hasPermission('access', 'extension/purpletree_multivendor/categoriescommission')) {
				$purpletree_multivendor[] = array(
					'name'	   => $this->language->get('text_pt_categoriescommission'),
					'href'     => $this->url->link('extension/purpletree_multivendor/categoriescommission', 'user_token=' . $this->session->data['user_token'], true),
					'children' => array()		
				);	
			}
			if ($this->user->hasPermission('access', 'extension/purpletree_multivendor/shipping')) {				$purpletree_multivendor[] = array(
			    'name'  => $this->language->get('text_pt_shipping'),
				'href'  => $this->url->link('extension/purpletree_multivendor/shipping', 'user_token=' . $this->session->data['user_token'], true),
					'children' => array()		
				);	
			}
			if ($this->user->hasPermission('access', 'extension/purpletree_multivendor/bulkproductupload')) {				$purpletree_multivendor[] = array(
			    'name'  => $this->language->get('text_pt_bulkproductupload'),
				'href'  => $this->url->link('extension/purpletree_multivendor/bulkproductupload', 'user_token=' . $this->session->data['user_token'], true),
					'children' => array()		
				);	
			}
			
			
				if ($this->user->hasPermission('access', 'extension/purpletree_multivendor/subscriptionplan')) {
				if($this->config->get('module_purpletree_multivendor_subscription_plans')) {
				$purpletree_multivendor[] = array(
				'name'  => $this->language->get('text_pt_vendor_subscription_plan'),
				'href'  => $this->url->link('extension/purpletree_multivendor/subscriptionplan', 'user_token=' . $this->session->data['user_token'], true),
					'children' => array()		
				);	
				}
			}
			
			if ($this->user->hasPermission('access', 'extension/purpletree_multivendor/subscriptionplan')) {
				if($this->config->get('module_purpletree_multivendor_subscription_plans')) {
				$purpletree_multivendor[] = array(
				'name'  => $this->language->get('text_pt_subscription_invoice'),
				'href'  => $this->url->link('extension/purpletree_multivendor/subscriptionplan_pendinginvoice', 'user_token=' . $this->session->data['user_token'], true),
					'children' => array()		
				);	
				}
			}
			
			if ($this->user->hasPermission('access', 'extension/purpletree_multivendor/managesubscriptionplan')) {
			if($this->config->get('module_purpletree_multivendor_subscription_plans')) {
			$purpletree_multivendor[] = array(
				'name'  => $this->language->get('text_pt_manage_subscription_plan'),
				'href'  => $this->url->link('extension/purpletree_multivendor/managesubscriptionplan', 'user_token=' . $this->session->data['user_token'], true),
					'children' => array()		
				);
			}				
			}
			if ($this->user->hasPermission('access', 'extension/purpletree_multivendor/planinvoicestatus')) {
			$purpletree_multivendor[] = array(
				'name'  => $this->language->get('text_pt_plan_invoice_status'),
				'href'  => $this->url->link('extension/purpletree_multivendor/planinvoicestatus', 'user_token=' . $this->session->data['user_token'], true),
					'children' => array()		
				);	
			}
			if ($this->user->hasPermission('access', 'extension/purpletree_multivendor/upgradedatabase')) {				$purpletree_multivendor[] = array(
				'name'  => $this->language->get('text_pt_upgradedatabase'),
				'href'  => $this->url->link('extension/purpletree_multivendor/upgradedatabase', 'user_token=' . $this->session->data['user_token'], true),
					'children' => array()		
				);	
			}
			
			if ($purpletree_multivendor) {
				$data['menus'][] = array(
					'id'       => 'menu-purpletree-multivendor',
					'icon'	   => 'fa-user', 
					'name'	   => $this->language->get('text_pt_multivendor'),
					'href'     => '',
					'children' => $purpletree_multivendor
				);	
			}
			}
			]]></add>
		</operation>
		<operation error="skip">
				<search><![CDATA[$this->load->language('common/column_left');]]></search>
				<add position="before"><![CDATA[
					$this->load->language('customer/ptscustomer');
					
				]]></add>
			</operation>
	</file>
	<file path="admin/controller/extension/extension/module.php">
		<operation error="skip">
			<search><![CDATA[$this->model_setting_extension->install('module', $this->request->get['extension']);]]></search>
			<add position="after"><![CDATA[
			/***********    Create Tables For Multivendor Extension when module installs     ***********/
			if($this->request->get['extension']=="purpletree_multivendor"){
			$query = $this->db->query("SHOW TABLES LIKE '" . DB_PREFIX . "purpletree_vendor_stores'");	
				if($query->num_rows==0) 
		{
			$seller_layout = $this->db->query("SELECT layout_id FROM " . DB_PREFIX . "layout WHERE name='Account'");
			
			if($seller_layout->num_rows > 0){
				$data = $seller_layout->row;
					$this->db->query("INSERT into " . DB_PREFIX . "layout_route SET layout_id='".$data['layout_id']."', store_id='0', route='extension/account/%'");	
			}
		$this->db->query("CREATE TABLE IF NOT EXISTS `" . DB_PREFIX . "purpletree_vendor_stores` (
  							`id` int(11) NOT NULL AUTO_INCREMENT,
  							`seller_id` int(11) NOT NULL,
  							`store_name` varchar(256) NOT NULL,
  							`store_logo` varchar(150) NOT NULL,
  							`store_email` varchar(200) NOT NULL,
  							`store_phone` varchar(14) NOT NULL,
  							`store_banner` varchar(150) NOT NULL,
  							`document` varchar(150) NOT NULL,
  							`store_description` text NOT NULL,
  							`store_address` text NOT NULL,
  							`store_city` varchar(200) NOT NULL,
  							`store_country` int(11) NOT NULL,
  							`store_state` int(11) NOT NULL,
  							`store_zipcode` varchar(11) NOT NULL,
  							`store_shipping_policy` text NOT NULL,
							`store_return_policy` text NOT NULL,
							`store_meta_keywords` text NOT NULL,
							`store_meta_descriptions` text NOT NULL,
							`store_bank_details` varchar(356) NOT NULL,
  							`store_tin` varchar(50) NOT NULL,
							`store_shipping_type` varchar(50) NOT NULL,
							`store_shipping_order_type` varchar(50) NOT NULL,
  							`store_shipping_charge` decimal(6,2) NOT NULL,
							`store_live_chat_enable` tinyint(1) NOT NULL,
							`store_live_chat_code` text NOT NULL,
  							`store_status` tinyint(1) NOT NULL,
  							`store_commission` float(6,4) NULL DEFAULT NULL,
  							`is_removed` tinyint(1) NOT NULL,
  							`store_created_at` date NOT NULL,
  							`store_updated_at` date NOT NULL,
							`seller_paypal_id` varchar(50) NOT NULL,
							`multi_store_id` int(11) NOT NULL,
  							PRIMARY KEY (`id`)  ) CHARACTER SET utf8 COLLATE utf8_unicode_ci
						");
						$this->db->query("CREATE TABLE IF NOT EXISTS `" . DB_PREFIX . "purpletree_vendor_social_links` (
								`id` int(11) NOT NULL AUTO_INCREMENT,
								`store_id` int(11) NOT NULL,
								`facebook_link` varchar(255) NOT NULL,
								`google_link` varchar(255) NOT NULL,
								`instagram_link` varchar(255) NOT NULL,
								`twitter_link` varchar(255) NOT NULL,
								`pinterest_link` varchar(255) NOT NULL,
								`wesbsite_link` varchar(255) NOT NULL,	
								`whatsapp_link` varchar(255) NOT NULL,	
								PRIMARY KEY (`id`)) CHARACTER SET utf8 COLLATE utf8_unicode_ci
			            ");
				
				$this->db->query("CREATE TABLE IF NOT EXISTS `" . DB_PREFIX . "purpletree_vendor_products` (
  							`id` int(11) NOT NULL AUTO_INCREMENT,
  							`seller_id` int(11) NOT NULL,
  							`product_id` int(11) NOT NULL,
							`is_featured` int(11) NOT NULL,
							`is_category_featured` int(11) NOT NULL,
  							`is_approved` tinyint(1) NOT NULL,
  							`created_at` date NOT NULL,
  							`updated_at` date NOT NULL,
  							PRIMARY KEY (`id`)) CHARACTER SET utf8 COLLATE utf8_unicode_ci
						");
				$this->db->query("CREATE TABLE IF NOT EXISTS `" . DB_PREFIX . "purpletree_vendor_orders` (
  							`id` int(11) NOT NULL AUTO_INCREMENT,
  							`seller_id` int(11) NOT NULL,
  							`product_id` int(11) NOT NULL,
  							`order_id` int(11) NOT NULL,
  							`shipping` decimal(6,2) NOT NULL,
  							`quantity` int(11) NOT NULL,
  							`unit_price` decimal(10,2) NOT NULL,
  							`total_price` decimal(10,2) NOT NULL,
  							`order_status_id` int(3) NOT NULL,
  							`created_at` date NOT NULL,
  							`updated_at` date NOT NULL,
							`seen` int(11) NOT NULL DEFAULT '1',
  							PRIMARY KEY (`id`)) CHARACTER SET utf8 COLLATE utf8_unicode_ci
						");
				$this->db->query("CREATE TABLE IF NOT EXISTS `" . DB_PREFIX . "purpletree_order_total` (
  							`order_total_id` int(11) NOT NULL AUTO_INCREMENT,
  							`order_id` int(11) NOT NULL,
  							`seller_id` int(11) NOT NULL,
  							`code` varchar(32) NOT NULL,
  							`title` varchar(255) NOT NULL,
  							`value` decimal(15,4) NOT NULL,
  							`sort_order` int(3) NOT NULL,
  							PRIMARY KEY (`order_total_id`)) CHARACTER SET utf8 COLLATE utf8_unicode_ci
						");
				$this->db->query("CREATE TABLE IF NOT EXISTS `" . DB_PREFIX . "purpletree_vendor_orders_history` (
  							`id` int(11) NOT NULL AUTO_INCREMENT,
  							`seller_id` int(11) NOT NULL,
  							`order_id` int(11) NOT NULL,
  							`order_status_id` int(11) NOT NULL,
  							`comment` varchar(250) NOT NULL,
							`notify` tinyint(1) NOT NULL,
  							`created_at` date NOT NULL,
  							PRIMARY KEY (`id`)) CHARACTER SET utf8 COLLATE utf8_unicode_ci
						");
				$this->db->query("CREATE TABLE IF NOT EXISTS `" . DB_PREFIX . "purpletree_vendor_reviews` (
  							`id` int(11) NOT NULL AUTO_INCREMENT,
  							`seller_id` int(11) NOT NULL,
  							`customer_id` int(11) NOT NULL,
  							`review_title` varchar(150) NOT NULL,
  							`review_description` text NOT NULL,
  							`rating` int(11) NOT NULL,
  							`status` tinyint(1) NOT NULL,
  							`created_at` date NOT NULL,
  							`updated_at` date NOT NULL,
  							PRIMARY KEY (`id`)) CHARACTER SET utf8 COLLATE utf8_unicode_ci
						");
				$this->db->query("CREATE TABLE IF NOT EXISTS `" . DB_PREFIX . "purpletree_vendor_commissions` (
  							`id` int(11) NOT NULL AUTO_INCREMENT,
  							`seller_id` int(11) NOT NULL,
  							`order_id` int(11) NOT NULL,
  							`product_id` int(11) NOT NULL,
							`commission_fixed` int(50) NOT NULL DEFAULT '0',
							`commission_percent` decimal(4,2) NOT NULL DEFAULT '0.00',
							`commission_shipping` float(8,2) NOT NULL DEFAULT '0.00',
							`invoice_status` int(50) NOT NULL DEFAULT '0',
  							`commission` decimal(10,2) NOT NULL,
  							`status` varchar(50) NOT NULL,
  							`created_at` date NOT NULL,
  							`updated_at` date NOT NULL,
  							PRIMARY KEY (`id`)) CHARACTER SET utf8 COLLATE utf8_unicode_ci
						");
				$this->db->query("CREATE TABLE IF NOT EXISTS `" . DB_PREFIX . "purpletree_vendor_payments` (
  							`id` int(11) NOT NULL AUTO_INCREMENT,
  							`invoice_id` int(11) NOT NULL,
  							`seller_id` int(11) NOT NULL,
  							`transaction_id` varchar(20) NOT NULL,
  							`amount` decimal(10,2) NOT NULL,
  							`payment_mode` varchar(50) NOT NULL,
  							`status` varchar(50) NOT NULL,
  							`created_at` date NOT NULL,
  							`updated_at` date NOT NULL,
  							PRIMARY KEY (`id`)) CHARACTER SET utf8 COLLATE utf8_unicode_ci
						");
				       $this->db->query("CREATE TABLE IF NOT EXISTS `" . DB_PREFIX . "purpletree_vendor_contact` (
							  `id` int(10) NOT NULL AUTO_INCREMENT,
							  `seller_id` int(10) NOT NULL,
							  `customer_id` int(10) NOT NULL,
							  `contact_from` int(10) NOT NULL,
							  `customer_name` varchar(150) NOT NULL,
							  `customer_email` varchar(150) NOT NULL,
							  `customer_message` text NOT NULL,
							  `created_at` datetime NOT NULL,
							  `updated_at` datetime NOT NULL,
							  `seen` int(11) NOT NULL DEFAULT '1',
							  PRIMARY KEY (`id`)) CHARACTER SET utf8 COLLATE utf8_unicode_ci
					");
					$this->db->query("CREATE TABLE IF NOT EXISTS `" . DB_PREFIX . "purpletree_vendor_categories_commission` (
  							`id` int(11) NOT NULL AUTO_INCREMENT,
  							`category_id` int(11) NOT NULL,
  							`commission` decimal(4,2) NOT NULL,
							`commison_fixed` double NOT NULL,
  							`seller_group` int(50) NOT NULL DEFAULT '1',
  							PRIMARY KEY (`id`)) CHARACTER SET utf8 COLLATE utf8_unicode_ci
						");	
						$this->db->query("CREATE TABLE IF NOT EXISTS `" . DB_PREFIX . "purpletree_vendor_shipping` (
						`id` int(11) NOT NULL AUTO_INCREMENT,
						`seller_id` int(11) NOT NULL,
						`shipping_country` int(11) NOT NULL,
						`zipcode_from` varchar(11) NOT NULL,
						`zipcode_to` varchar(11) NOT NULL,
						`shipping_price` decimal(15,2) NOT NULL,
						`weight_from` decimal(15,2) NOT NULL,
						`weight_to` decimal(15,2) NOT NULL,
						`max_days` int(11) NOT NULL,
						PRIMARY KEY (`id`)) CHARACTER SET utf8 COLLATE utf8_unicode_ci
					");
						$this->db->query("CREATE TABLE IF NOT EXISTS `" . DB_PREFIX . "purpletree_vendor_downloads` (
  							`id` int(11) NOT NULL AUTO_INCREMENT,
  							`download_id` int(11) NOT NULL,
  							`seller_id` int(11) NOT NULL,
  							PRIMARY KEY (`id`)) CHARACTER SET utf8 COLLATE utf8_unicode_ci
						");	
						// Subscription Plan
		$this->db->query("CREATE TABLE IF NOT EXISTS `" . DB_PREFIX . "purpletree_vendor_plan_invoice_status` (
				`status_id` int(11) NOT NULL AUTO_INCREMENT,
				`created_date` datetime NOT NULL,
				`modified_date` datetime NOT NULL,
				PRIMARY KEY (`status_id`)) CHARACTER SET utf8 COLLATE utf8_unicode_ci
			");
			$this->db->query("CREATE TABLE IF NOT EXISTS `" . DB_PREFIX . "purpletree_vendor_plan_invoice_status_languge` (
				`id` int(11) NOT NULL AUTO_INCREMENT,
				`status_id` int(11) NOT NULL,
				`language_id` int(11) NOT NULL,
				`status` varchar(30) NOT NULL,
				PRIMARY KEY (`id`),FOREIGN KEY (`status_id`) REFERENCES " . DB_PREFIX . "purpletree_vendor_plan_invoice_status(`status_id`)) CHARACTER SET utf8 COLLATE utf8_unicode_ci
			");
			
			$this->db->query("CREATE TABLE IF NOT EXISTS `" . DB_PREFIX . "purpletree_vendor_plan` (
				`plan_id` int(11) NOT NULL AUTO_INCREMENT,
				`no_of_product` int(11) NOT NULL,
				`no_of_featured_product` int(10) NOT NULL,
				`no_of_category_featured_product` int(10) NOT NULL,
				`featured_store` int(10) NOT NULL,
				`joining_fee` decimal(15,4) NOT NULL,
				`subscription_price` decimal(15,4) NOT NULL,
				`validity` int(11) NOT NULL,
				`default_subscription_plan` int(1) NOT NULL,
				`status` int(1) NOT NULL,
				`created_date` datetime NOT NULL,
				`modified_date` datetime NOT NULL,
				PRIMARY KEY (`plan_id`)) CHARACTER SET utf8 COLLATE utf8_unicode_ci
			");	
			
			$this->db->query("CREATE TABLE IF NOT EXISTS `" . DB_PREFIX . "purpletree_vendor_plan_description` (
				`id` int(11) NOT NULL AUTO_INCREMENT,
				`plan_id` int(11) NOT NULL,
				`language_id` int(11) NOT NULL,
				`plan_name` varchar(30) NOT NULL,
				`plan_description` TEXT NOT NULL,
				`plan_short_description` TEXT NOT NULL,
				PRIMARY KEY (`id`),FOREIGN KEY (`plan_id`) REFERENCES " . DB_PREFIX . "purpletree_vendor_plan(`plan_id`)) CHARACTER SET utf8 COLLATE utf8_unicode_ci
			");	
				
			$this->db->query("CREATE TABLE IF NOT EXISTS `" . DB_PREFIX . "purpletree_vendor_seller_plan` (
				`id` int(11) NOT NULL AUTO_INCREMENT,
				`invoice_id` int(11) NOT NULL,
				`plan_id` int(11) NOT NULL,
				`seller_id` int(11) NOT NULL,
				`reminder` int(1) NOT NULL,
				`reminder1` int(1) NOT NULL,
				`reminder2` int(1) NOT NULL,
				`status` int(1) NOT NULL,
				`new_status` int(1) NOT NULL,
				`start_date` datetime NOT NULL,
				`end_date` datetime NOT NULL,
				`new_end_date` datetime NOT NULL,
				`created_date` datetime NOT NULL,
				`modified_date` datetime NOT NULL,
				PRIMARY KEY (`id`),FOREIGN KEY (`plan_id`) REFERENCES " . DB_PREFIX . "purpletree_vendor_plan(`plan_id`)) CHARACTER SET utf8 COLLATE utf8_unicode_ci
			");	
			
			$this->db->query("CREATE TABLE IF NOT EXISTS `" . DB_PREFIX . "purpletree_vendor_plan_invoice` (
				`invoice_id` int(11) NOT NULL AUTO_INCREMENT,
				`seller_id` int(11) NOT NULL,
				`plan_id` int(11) NOT NULL,
				`payment_mode` varchar(30) NOT NULL,
				`status_id` int(11) NOT NULL,
				`created_date` datetime NOT NULL,
				PRIMARY KEY (`invoice_id`),FOREIGN KEY (`plan_id`) REFERENCES " . DB_PREFIX . "purpletree_vendor_plan(`plan_id`),FOREIGN KEY (`status_id`) REFERENCES " . DB_PREFIX . "purpletree_vendor_plan_invoice_status(`status_id`)) CHARACTER SET utf8 COLLATE utf8_unicode_ci
			");	
			
			$this->db->query("CREATE TABLE IF NOT EXISTS `" . DB_PREFIX . "purpletree_vendor_plan_invoice_item` (
				`id` int(11) NOT NULL AUTO_INCREMENT,
				`invoice_id` int(11) NOT NULL,
				`code` varchar(30) NOT NULL,
				`title` varchar(30) NOT NULL,
				`price` decimal(15,4) NOT NULL,
				`sort_order` int(11) NOT NULL,
				PRIMARY KEY (`id`),FOREIGN KEY (`invoice_id`) REFERENCES " . DB_PREFIX . "purpletree_vendor_plan_invoice(`invoice_id`)) CHARACTER SET utf8 COLLATE utf8_unicode_ci
			");	

				$this->db->query("CREATE TABLE IF NOT EXISTS `" . DB_PREFIX . "purpletree_vendor_plan_invoice_history` (
				`id` int(11) NOT NULL AUTO_INCREMENT,
				`invoice_id` int(11) NOT NULL,
				`status_id` int(11) NOT NULL,
				`payment_mode` varchar(30) NOT NULL,
				`transaction_id` varchar(30) NOT NULL,
				`comment` text NOT NULL,
				`created_date` datetime NOT NULL,
				`modified_date` datetime NOT NULL,
				PRIMARY KEY (`id`),FOREIGN KEY (`invoice_id`) REFERENCES " . DB_PREFIX . "purpletree_vendor_plan_invoice(`invoice_id`),FOREIGN KEY (`status_id`) REFERENCES " . DB_PREFIX . "purpletree_vendor_plan_invoice_status(`status_id`)) CHARACTER SET utf8 COLLATE utf8_unicode_ci
			");
			$this->db->query("CREATE TABLE IF NOT EXISTS `" . DB_PREFIX . "purpletree_vendor_plan_subscription` (
				`id` int(11) NOT NULL AUTO_INCREMENT,
				`seller_id` int(11) NOT NULL,
				`status_id` int(1) NOT NULL,
				`created_date` datetime NOT NULL,
				`modified_date` datetime NOT NULL,
				PRIMARY KEY (`id`)) CHARACTER SET utf8 COLLATE utf8_unicode_ci
			");
			$this->db->query("CREATE TABLE IF NOT EXISTS `" . DB_PREFIX . "purpletree_vendor_commission_invoice_items` (
  							`id` int(11) NOT NULL AUTO_INCREMENT,
							`link_id` int(50) NOT NULL,
  							`order_id` int(50) NOT NULL,
  							`product_id` int(50) NOT NULL,
  							`seller_id` int(50) NOT NULL,
  							`commission_fixed` int(50) NOT NULL DEFAULT '0',
  							`commission_percent` decimal(4,2) NOT NULL DEFAULT '0.00',
  							`commission_shipping` decimal(4,2) NOT NULL DEFAULT '0.00',
  							`total_commission` float(8,2) NOT NULL,
  							PRIMARY KEY (`id`)) CHARACTER SET utf8 COLLATE utf8_unicode_ci
						");
						$this->db->query("CREATE TABLE IF NOT EXISTS `" . DB_PREFIX . "purpletree_vendor_commission_invoice` (
  							`id` int(11) NOT NULL AUTO_INCREMENT,
							`total_amount` decimal(11,2) NOT NULL DEFAULT '0.00',
							`total_commission` decimal(11,2) NOT NULL DEFAULT '0.00',
							`total_pay_amount` decimal(11,2) NOT NULL DEFAULT '0.00',
  							`created_at` date NOT NULL,
  							PRIMARY KEY (`id`)) CHARACTER SET utf8 COLLATE utf8_unicode_ci
						");
					// Pending
			$querry = $this->db->query("SELECT * FROM " . DB_PREFIX . "purpletree_vendor_plan_invoice_status WHERE status_id = 1");
			if($querry->num_rows){} else {
			$this->db->query("INSERT INTO " . DB_PREFIX . "purpletree_vendor_plan_invoice_status SET status_id = '1', created_date = NOW(), modified_date = NOW()");
			
			$status_id = $this->db->getLastId();   
			
			$this->load->model('localisation/language');            
		    $languages = $this->model_localisation_language->getLanguages();
			
			foreach ($languages as $language_id ) {
				$this->db->query("INSERT INTO " . DB_PREFIX . "purpletree_vendor_plan_invoice_status_languge SET status_id = '" . (int)$status_id . "', language_id = '" . (int)$language_id['language_id'] . "', status = 'Pending'");
			}
			}
			// Pending
			// Complete
			$querry1 = $this->db->query("SELECT * FROM " . DB_PREFIX . "purpletree_vendor_plan_invoice_status WHERE status_id = 2");
			if($querry1->num_rows){} else {
			$this->db->query("INSERT INTO " . DB_PREFIX . "purpletree_vendor_plan_invoice_status SET status_id = '2', created_date = NOW(), modified_date = NOW()");
			
			$status_id = $this->db->getLastId();   
			
			$this->load->model('localisation/language');            
		    $languages = $this->model_localisation_language->getLanguages();
			
			foreach ($languages as $language_id ) {
			$this->db->query("INSERT INTO " . DB_PREFIX . "purpletree_vendor_plan_invoice_status_languge SET status_id = '" . (int)$status_id . "', language_id = '" . (int)$language_id['language_id'] . "', status = 'Complete'");
		}
			}
			// Complete
		// Subscription Plan
		       // Start seller blog
					$this->db->query("CREATE TABLE IF NOT EXISTS `" . DB_PREFIX . "purpletree_vendor_blog_post` (
  							`blog_post_id` int(11) NOT NULL AUTO_INCREMENT,
							`seller_id` int(11) NOT NULL,
  							`image` varchar(255) NOT NULL,  							
  							`sort_order` int(11) NOT NULL,
							`status` tinyint(1) NOT NULL,
							`created_at` datetime NOT NULL,
  							`updated_at` datetime NOT NULL, 							
							PRIMARY KEY (`blog_post_id`)) CHARACTER SET utf8 COLLATE utf8_unicode_ci
						");
						
                  $this->db->query("CREATE TABLE IF NOT EXISTS `" . DB_PREFIX . "purpletree_vendor_blog_post_comment` (
  							`blog_comment_id` int(11) NOT NULL AUTO_INCREMENT,
  							`blog_post_id` int(11) NOT NULL,
  							`name` varchar(150) NOT NULL,
  							`email_id` varchar(150) NOT NULL,
  							`text` text NOT NULL,
							`status` tinyint(1) NOT NULL,
							`created_at` datetime NOT NULL,
  							`updated_at` datetime NOT NULL,
  							PRIMARY KEY (`blog_comment_id`)) CHARACTER SET utf8 COLLATE utf8_unicode_ci
						");
						
				$this->db->query("CREATE TABLE IF NOT EXISTS `" . DB_PREFIX . "purpletree_vendor_blog_post_description` (
  							`blog_post_id` int(11) NOT NULL,
  							`language_id` int(11) NOT NULL,
  							`title` varchar(255) NOT NULL,
  							`description` text NOT NULL,
							`meta_title` varchar(255) NOT NULL,
  							`meta_description` varchar(255) NOT NULL,
  							`meta_keyword` varchar(255) NOT NULL,
  							`post_tags` varchar(255) NOT NULL)
							CHARACTER SET utf8 COLLATE utf8_unicode_ci
						");
						// End seller blog
				$this->db->query("CREATE TABLE IF NOT EXISTS `" . DB_PREFIX . "purpletree_vendor_payment_settlement_history` (
  							`id` int(11) NOT NULL AUTO_INCREMENT,
  							`invoice_id` int(11) NOT NULL,
  							`status_id` int(11) NOT NULL,
  							`payment_mode` varchar(50) NOT NULL,
  							`transaction_id` varchar(50) NOT NULL,
  							`comment` text NOT NULL,
							`created_date` datetime NOT NULL,
  							`modified_date` datetime NOT NULL, 	
							PRIMARY KEY (`id`)) CHARACTER SET utf8 COLLATE utf8_unicode_ci
						");	
				$this->db->query("CREATE TABLE IF NOT EXISTS `" . DB_PREFIX . "purpletree_vendor_enquiries` (
					`id` int(11) NOT NULL AUTO_INCREMENT,
					`seller_id` int(11) NOT NULL,
					`contact_from` int(11) NOT NULL,
					`message` varchar(250) NOT NULL,
					`created_at` datetime NOT NULL,
					`updated_at` datetime NOT NULL, 	
					PRIMARY KEY (`id`)) CHARACTER SET utf8 COLLATE utf8_unicode_ci
				");
									

	$this->db->query("CREATE TABLE IF NOT EXISTS `" . DB_PREFIX . "purpletree_vendor_subscription_products` (
				`id` int(11) NOT NULL AUTO_INCREMENT,
				`product_id` int(11) NOT NULL,
				`product_plan_id` int(11) NOT NULL,
				`featured_product_plan_id` int(11) NOT NULL,
				`category_featured_product_plan_id` varchar(255) NOT NULL,
				PRIMARY KEY (`id`)) CHARACTER SET utf8 COLLATE utf8_unicode_ci
		");	
    $this->db->query("CREATE TABLE IF NOT EXISTS `" . DB_PREFIX . "purpletree_vendor_template` (
				`id` int(11) NOT NULL AUTO_INCREMENT,
				`product_id` int(11) NOT NULL,
				`status` tinyint(1) NOT NULL DEFAULT '0',		
				PRIMARY KEY (`id`)) CHARACTER SET utf8 COLLATE utf8_unicode_ci
		");   
/* 	$this->db->query("CREATE TABLE IF NOT EXISTS `" . DB_PREFIX . "purpletree_vendor_allowed_category` (
				`id` int(11) NOT NULL AUTO_INCREMENT,
				`seller_id` int(11) NOT NULL,
				`category_id` varchar(255) NOT NULL,
				`type` tinyint(1) NOT NULL DEFAULT '1',				
				PRIMARY KEY (`id`)) CHARACTER SET utf8 COLLATE utf8_unicode_ci
		"); */	
    $this->db->query("CREATE TABLE IF NOT EXISTS `" . DB_PREFIX . "purpletree_vendor_template_products` (				
				`id` int(11) NOT NULL AUTO_INCREMENT,
				`template_id` int(11) NOT NULL,
				`seller_id` int(11) NOT NULL,
				`quantity` int(4) NOT NULL DEFAULT '0',
				`price` decimal(15,4) NOT NULL DEFAULT '0.0000',
				`stock_status_id` int(11) NOT NULL,
				`subtract` tinyint(1) NOT NULL DEFAULT '1',
				`status` tinyint(1) NOT NULL DEFAULT '0',				
				PRIMARY KEY (`id`)) CHARACTER SET utf8 COLLATE utf8_unicode_ci
		");	
      $this->db->query("CREATE TABLE IF NOT EXISTS `" . DB_PREFIX . "purpletree_vendor_cart` (				
				`id` int(11) NOT NULL AUTO_INCREMENT,
                `cart_id` int(11) NOT NULL,
                `seller_id` int(11) NOT NULL,				
				PRIMARY KEY (`id`)) CHARACTER SET utf8 COLLATE utf8_unicode_ci
		");		

		$this->db->query("CREATE TABLE IF NOT EXISTS `" . DB_PREFIX . "purpletree_vendor_adaptive_paykey` (
							`id` int(11) NOT NULL AUTO_INCREMENT,
							`order_id` int(11) NOT NULL,
							`payment_key` VARCHAR(50) NOT NULL,
							PRIMARY KEY (`id`)) CHARACTER SET utf8 COLLATE utf8_unicode_ci
						");			
			
	
			}
		}
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[$this->model_setting_extension->uninstall('module', $this->request->get['extension']);]]></search>
			<add position="after"><![CDATA[
			/*******  Drop Tables Of Multivendor Extension when module un-installs  *******/
			if($this->request->get['extension']=="purpletree_multivendor"){
				$query = $this->db->query("SHOW TABLES LIKE '" . DB_PREFIX . "purpletree_vendor_stores'");	
				if($query->num_rows==1) 
				{
				$this->db->query("DROP TABLE IF EXISTS ". DB_PREFIX ."purpletree_vendor_cart");
				$this->db->query("DROP TABLE IF EXISTS ". DB_PREFIX ."purpletree_vendor_template");
				/* $this->db->query("DROP TABLE IF EXISTS ". DB_PREFIX ."purpletree_vendor_allowed_category");*/
				$this->db->query("DROP TABLE IF EXISTS ". DB_PREFIX ."purpletree_vendor_template_products");
				$this->db->query("DROP TABLE IF EXISTS ". DB_PREFIX ."purpletree_vendor_downloads");
				$this->db->query("DROP TABLE IF EXISTS ". DB_PREFIX ."purpletree_vendor_shipping");
				$this->db->query("DROP TABLE IF EXISTS ". DB_PREFIX ."purpletree_vendor_stores");
				$this->db->query("DROP TABLE IF EXISTS ". DB_PREFIX ."purpletree_vendor_products");
				$this->db->query("DROP TABLE IF EXISTS ". DB_PREFIX ."purpletree_vendor_orders");
				$this->db->query("DROP TABLE IF EXISTS ". DB_PREFIX ."purpletree_vendor_reviews");
				$this->db->query("DROP TABLE IF EXISTS ".DB_PREFIX."purpletree_vendor_commissions");
				$this->db->query("DROP TABLE IF EXISTS ". DB_PREFIX ."purpletree_vendor_payments");
				$this->db->query("DROP TABLE IF EXISTS ". DB_PREFIX ."purpletree_order_total");
		        $this->db->query("DROP TABLE IF EXISTS ". DB_PREFIX ."purpletree_vendor_orders_history");
		
				$this->db->query("DROP TABLE IF EXISTS ". DB_PREFIX ."purpletree_vendor_contact");
					
					//subscription plan_description
				
					$this->db->query("DROP TABLE IF EXISTS ". DB_PREFIX ."purpletree_vendor_plan_description");
					
					$this->db->query("DROP TABLE IF EXISTS ". DB_PREFIX ."purpletree_vendor_seller_plan");
					
					$this->db->query("DROP TABLE IF EXISTS ". DB_PREFIX ."purpletree_vendor_plan_invoice_item");
					
					$this->db->query("DROP TABLE IF EXISTS ". DB_PREFIX ."purpletree_vendor_plan_invoice_history");
					
					$this->db->query("DELETE FROM " . DB_PREFIX . "seo_url WHERE query LIKE '%seller_store_id%'");
					$this->db->query("DROP TABLE IF EXISTS ". DB_PREFIX ."purpletree_vendor_categories_commission");
						
					$this->db->query("DROP TABLE IF EXISTS ". DB_PREFIX ."purpletree_vendor_plan_invoice");
					
					$this->db->query("DROP TABLE IF EXISTS ". DB_PREFIX ."purpletree_vendor_plan");
					
					$this->db->query("DROP TABLE IF EXISTS ". DB_PREFIX ."purpletree_vendor_plan_invoice_status_languge");
					
					$this->db->query("DROP TABLE IF EXISTS ". DB_PREFIX ."purpletree_vendor_plan_invoice_status");
					$this->db->query("DROP TABLE IF EXISTS ". DB_PREFIX ."purpletree_vendor_plan_subscription");
					//Start Seller blog
					$this->db->query("DROP TABLE IF EXISTS ". DB_PREFIX ."purpletree_vendor_blog_post_description");
                     $this->db->query("DELETE FROM ". DB_PREFIX ."seo_url WHERE query LIKE 'blog_post%'");	
					$this->db->query("DROP TABLE IF EXISTS ". DB_PREFIX ."purpletree_vendor_blog_post_comment");
					$this->db->query("DROP TABLE IF EXISTS ". DB_PREFIX ."purpletree_vendor_blog_post");                				
				//End seller blog
					$this->db->query("DROP TABLE IF EXISTS ". DB_PREFIX ."purpletree_vendor_commission_invoice_items");
					$this->db->query("DROP TABLE IF EXISTS ". DB_PREFIX ."purpletree_vendor_commission_invoice");
					$this->db->query("DROP TABLE IF EXISTS ". DB_PREFIX ."purpletree_vendor_payment_settlement_history");
					$this->db->query("DROP TABLE IF EXISTS ". DB_PREFIX ."purpletree_vendor_subscription_products");
					$this->db->query("DROP TABLE IF EXISTS ". DB_PREFIX ."pts_vendor_shipping");
					$this->db->query("DROP TABLE IF EXISTS ". DB_PREFIX ."purpletree_vendor_social_links");
					$this->db->query("DROP TABLE IF EXISTS ". DB_PREFIX ."purpletree_vendor_adaptive_paykey");
					
					
					
				}
			}
			]]></add>
		</operation>
	</file>
	<file path="system/library/cart/user.php">
		<operation error="log" info="create new fields metal and price_extra in table product if not exists">
			<search><![CDATA[$user_query = $this->db->query("SELECT * FROM " . DB_PREFIX . "user WHERE user_id = '" . (int)$this->session->data['user_id'] . "' AND status = '1'");]]></search>
			<add position="after"><![CDATA[
			$field_query = $this->db->query("SHOW COLUMNS FROM `" . DB_PREFIX . "product` LIKE 'metal'");
			if (!$field_query->num_rows) {
			$this->db->query("ALTER TABLE `" . DB_PREFIX . "product`  ADD `metal` INT(1) NOT NULL DEFAULT '0' AFTER `product_id`");
			}
			
			$field_query = $this->db->query("SHOW COLUMNS FROM `" . DB_PREFIX . "product` LIKE 'price_extra'");
			if (!$field_query->num_rows) {
			$this->db->query("ALTER TABLE `" . DB_PREFIX . "product`  ADD `price_extra` DECIMAL(15,4) NOT NULL DEFAULT '0.00' AFTER `price`");
			}
			
			$field_query = $this->db->query("SHOW COLUMNS FROM `" . DB_PREFIX . "product` LIKE 'price_extra_type'");
			if (!$field_query->num_rows) {
			$this->db->query("ALTER TABLE `" . DB_PREFIX . "product`  ADD `price_extra_type` INT(1) NOT NULL DEFAULT '0' AFTER `price`");
			}
			]]></add>
		</operation>
	</file>
	<file path="catalog/controller/common/footer.php">
		<operation error="skip">
			<search><![CDATA[public function index() {]]></search>
			<add position="after"><![CDATA[
					$data['seller_chat'] = '';
			if(NULL !== $this->config->get('module_purpletree_multivendor_status')){
			if($this->config->get('module_purpletree_multivendor_status')){
				if(NULL !== $this->config->get('module_purpletree_multivendor_allow_live_chat')) {
				if($this->config->get('module_purpletree_multivendor_allow_live_chat')) {	
				if(isset($this->session->data['seller_sto_page'])){
					$seller_store_idd = $this->session->data['seller_sto_page'];
					  $query = $this->db->query("SELECT `store_live_chat_enable` ,`store_live_chat_code` FROM " . DB_PREFIX . "purpletree_vendor_stores WHERE `id` = '" . (int)$seller_store_idd . "'");
					    if ($query->num_rows) {
							if($query->row['store_live_chat_enable']) {
								if($query->row['store_live_chat_code'] != '') {
										unset($this->session->data['seller_sto_page']);
									$data['seller_chat'] = '1';
								}
							}
						}
				}
				}
				}
			}
			}
			]]></add>
		</operation>
	</file>
	<file path="catalog/controller/extension/module/account.php">
		<operation error="skip">
			<search><![CDATA[public function index() {]]></search>
			<add position="after"><![CDATA[$data['sellercontact'] = $this->url->link('extension/account/purpletree_multivendor/sellercontact/customerContactlist', '', true);]]></add>
		</operation>
	</file>
	<file path="admin/controller/startup/permission.php">
		<operation error="skip">
			<search><![CDATA['extension/openbay']]></search>
			<add position="after"><![CDATA[,'extension/purpletree_multivendor']]></add>
		</operation>
	</file>
	
		<file path="admin/model/catalog/download.php">
		<operation error="skip">
		<search><![CDATA[public function deleteDownload($download_id) {]]></search>
				<add position="after"><![CDATA[
$this->db->query("DELETE FROM " . DB_PREFIX . "purpletree_vendor_downloads WHERE download_id = '" . (int)$download_id . "'");
				]]></add>
			</operation>
			<operation error="skip">
		<search><![CDATA[$download_id = $this->db->getLastId();]]></search>
				<add position="after"><![CDATA[
$this->db->query("INSERT INTO " . DB_PREFIX . "purpletree_vendor_downloads SET download_id='" .(int)$download_id. "', seller_id='".(int)$data['seller_id']."'");
				]]></add>
			</operation>
			<operation error="skip">
		<search><![CDATA[public function editDownload($download_id, $data) {]]></search>
				<add position="after"><![CDATA[
$this->db->query("UPDATE " . DB_PREFIX . "purpletree_vendor_downloads SET seller_id ='" . (int)$data['seller_id'] . "' WHERE download_id = '" . (int)$download_id . "'");
				]]></add>
			</operation>
			<operation error="skip">
		<search><![CDATA[public function getDownloads($data = array()) {]]></search>
				<add position="before"><![CDATA[
	public function getDownloadSellerid($download_id) {
		$query = $this->db->query("SELECT pvd.seller_id,pvs.store_name FROM " . DB_PREFIX . "purpletree_vendor_downloads pvd LEFT JOIN " . DB_PREFIX . "purpletree_vendor_stores pvs ON (pvs.seller_id = pvd.seller_id) WHERE pvd.download_id = '" . (int)$download_id . "'");

		if($query->num_rows > 0) {
			return $query->row;
		} else {
			return "";
		}
	}
				]]></add>
			</operation>
	</file>
		<file path="admin/view/template/catalog/download_list.twig">
		<operation error="skip">
		<search><![CDATA[<td class="text-right">{{ column_action }}</td>]]></search>
				<add position="before"><![CDATA[
					<td class="text-right">{{ column_store }}</td>
				]]></add>
			</operation>
			<operation error="skip">
		<search><![CDATA[<td class="text-right">{{ download.date_added }}</td>]]></search>
				<add position="after"><![CDATA[
					<td class="text-right">{{ download.seller }}</td>
				]]></add>
			</operation>
		</file>
		<file path="admin/view/template/catalog/download_form.twig">
		<operation error="skip">
		<search><![CDATA[{{ footer }}]]></search>
				<add position="before"><![CDATA[<style>
.catdivdrop ul{
	overflow: auto;
	max-height: 100px;
	width: 30%;
}
</style>]]></add>
			</operation>
			<operation error="skip">
		<search><![CDATA[<form action="{{ action }}" method="post" enctype="multipart/form-data" id="form-download" class="form-horizontal">]]></search>
				<add position="after"><![CDATA[
						<div class="form-group required">
						    <label class="col-sm-2 control-label" for="input-filter_name">{{ column_store }}</label>
						    <div class="col-sm-10 catdivdrop">
						      <input type="hidden" name="seller_id" value="{{ seller_id }}" class="form-control ptsnewcss" />
						       <input type="text" name="filter_name" value="{% if seller_id or seller_id=='0' %}{{ filter_name }}{% endif %}" placeholder="{{ column_store }}" id="input-name" class="form-control" />
							 {% if error_filter_name %}
                            <div class="text-danger">{{ error_filter_name }}</div>
                            {% endif %}</div>
						  </div>
				]]></add>
			</operation>
			<operation error="skip">
		<search><![CDATA[$('#button-upload').on('click', function() {]]></search>
				<add position="before"><![CDATA[
						$('input[name=\'filter_name\']').autocomplete({
							'source': function(request, response) {
							$.ajax({
								url: 'index.php?route=extension/purpletree_multivendor/shipping/autocompleteseller&user_token={{ user_token }}',
								dataType: 'json',	
									success: function(json) {
										response($.map(json, function(item) {
											return {
												label: item['name'],
												value: item['vendor_id']
											}
										}));
									}
							});
								$('input[name=\'seller_id\']').val('');

							},
							'select': function(item) {
							$('input[name=\'filter_name\']').val(item['label']);
							$('input[name=\'seller_id\']').val(item['value']);
							}	
							});
				]]></add>
			</operation>
		</file>
			
		<file path="admin/controller/catalog/download.php">
		<operation error="skip">
		<search><![CDATA[if (isset($this->request->post['download_description'])) {]]></search>
				<add position="before"><![CDATA[
				//seller
		$seller = $this->model_catalog_download->getDownloadSellerid($data['download_id']);
		$sellerName = $this->language->get('na');
		$sellerId    =0;
		if (isset($this->request->post['filter_name'])) {
					$data['filter_name'] = $this->request->post['filter_name'];		
		} elseif (!empty($download_info)) {
			if($seller != '') {
						$sellerName = $seller['store_name'];
					}
			$data['filter_name'] = $sellerName;
		} else {
			$data['filter_name'] = '';
		}
		if (isset($this->request->post['seller_id'])) {
				$data['seller_id'] = $this->request->post['seller_id'];
		} elseif (!empty($download_info)) {
						if($seller != '') {
							$sellerId = $seller['seller_id'];
					}
					$data['seller_id']  = $sellerId;
		} else {
			$data['seller_id'] = '';
		}
		// seller
				]]></add>
			</operation>
			<operation error="skip">
		<search><![CDATA[if (isset($this->error['filename'])) {]]></search>
				<add position="before"><![CDATA[
						// seller
				if (isset($this->error['filter_name'])) {
			$data['error_filter_name'] = $this->error['filter_name'];
		} else {
			$data['error_filter_name'] = '';
		}
		//seller
				]]></add>
			</operation>
			<operation error="skip">
		<search><![CDATA[if (!is_file(DIR_DOWNLOAD . $this->request->post['filename'])) {]]></search>
				<add position="before"><![CDATA[
				//seller
		if (utf8_strlen($this->request->post['filter_name']) == '') {
			$this->error['filter_name'] = $this->language->get('error_filter_name');
		}
		if(!isset($this->request->post['seller_id']) || $this->request->post['seller_id'] == '') {
			$this->error['filter_name'] = $this->language->get('error_filter_name');
		}
		//seller
				]]></add>
			</operation>
			<operation error="skip">
		<search><![CDATA[$data['downloads'][] = array(]]></search>
				<add position="before"><![CDATA[
				$this->load->language('customer/ptscustomer');
					$seller = $this->model_catalog_download->getDownloadSellerid($result['download_id']);
					$sellerName = '';
					if($seller != '') {
						$sellerName = $seller['store_name'];
					}
				]]></add>
			</operation>
			<operation error="skip">
		<search><![CDATA[$data['downloads'][] = array(]]></search>
				<add position="after"><![CDATA[
					'seller'        => $sellerName,
				]]></add>
			</operation>
			<operation error="skip">
		<search><![CDATA[$this->load->language('catalog/download');]]></search>
				<add position="after"><![CDATA[
					$this->load->language('customer/ptscustomer');
				]]></add>
			</operation>
</file>
		
	<file path="admin/controller/catalog/product.php">
			<operation error="skip">
			<search><![CDATA[$product_total = $this->model_catalog_product->getTotalProducts($filter_data);]]></search>
				<add position="after" offset="2"><![CDATA[
		$resultsTemplates = $this->model_catalog_product->getTemplateprod();
		$templapr = array();
		$templacount = 0;
		if(!empty($resultsTemplates)){
			foreach($resultsTemplates as $reslttem) {
				$templapr[] = $reslttem['product_id'];
			}
		}
				]]></add>
			</operation>		
			<operation error="skip">
			<search><![CDATA[if (is_file(DIR_IMAGE . $result['image'])) {]]></search>
				<add position="before"><![CDATA[
if(!in_array($result['product_id'],$templapr)) {
				]]></add>
			</operation>			
			<operation error="skip">
			<search><![CDATA['edit'       => $this->url->link('catalog/product/edit', 'user_token=' . $this->session->data['user_token'] . '&product_id=' . $result['product_id'] . $url, true)]]></search>
				<add position="after" offset="1"><![CDATA[
		} else {
			$templacount++;
		}
				]]></add>
			</operation>			
			<operation error="skip">
			<search><![CDATA[$pagination = new Pagination();]]></search>
				<add position="before"><![CDATA[
$product_total = $product_total - $templacount;
				]]></add>
			</operation>		
			<operation error="skip">
		<search><![CDATA[$this->load->language('catalog/product');]]></search>
				<add position="after"><![CDATA[
					$this->load->language('customer/ptscustomer');
				]]></add>
			</operation>
			<operation error="skip">
			<search><![CDATA[$data['cancel'] = $this->url->link('catalog/product', 'user_token=' . $this->session->data['user_token'] . $url, true);]]></search>
			<add position="after"><![CDATA[
				/*** Load multivendor vendor model ***/
				$this->load->model('extension/purpletree_multivendor/vendor');
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[$data['cancel'] = $this->url->link('catalog/product', 'user_token=' . $this->session->data['user_token'] . $url);]]></search>
			<add position="after"><![CDATA[
				/*** Load multivendor vendor model ***/
				$this->load->model('extension/purpletree_multivendor/vendor');
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[$product_info = $this->model_catalog_product->getProduct($this->request->get['product_id']);]]></search>
			<add position="after"><![CDATA[
				/*** Get seller associated with this product ***/
				$product_seller = $this->model_extension_purpletree_multivendor_vendor->getProductSeller($this->request->get['product_id']);
				$product_assign_plan = $this->model_catalog_product->getSellerProductPlan($this->request->get['product_id']);
				$seller_pro1 = $this->model_extension_purpletree_multivendor_vendor->getProductSeller($this->request->get['product_id']);
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[$data['tab_openbay']]]></search>
			<add position="before"><![CDATA[
				$data['tab_vendor'] = $this->language->get('tab_vendor');
		
			$data['error_vendor'] = $this->language->get('error_vendor');
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[$this->load->model('catalog/recurring');]]></search>
			<add position="before"><![CDATA[
			/** get vendor name for this product if any **/
				if (isset($this->request->post['vendor'])) {
					$data['vendor'] = $this->request->post['vendor'];
				} elseif (!empty($product_seller)) {
					$data['vendor'] = (int)$product_seller['seller_id'];
				} else {
					$data['vendor'] = '';
				}
			    if (isset($this->request->post['product_plan_id'])) {
					$data['product_plan_id'] = $this->request->post['product_plan_id'];
				} elseif (!empty($product_assign_plan)) {
					$data['product_plan_id'] = $product_assign_plan['product_plan_id'];
				} else {
					$data['product_plan_id'] = '';
				}
				
				if (isset($this->request->post['featured_product_plan_id'])) {
					$data['featured_product_plan_id'] = $this->request->post['featured_product_plan_id'];
				} elseif (!empty($product_assign_plan)) {
					$data['featured_product_plan_id'] = $product_assign_plan['featured_product_plan_id'];
				} else {
					$data['featured_product_plan_id'] = '';
				}
				
				if (isset($this->request->post['category_featured_product_plan_id'])) {
					$data['category_featured_product_plan_id'] = $this->request->post['category_featured_product_plan_id'];
				} elseif (!empty($product_assign_plan)) {
					$data['category_featured_product_plan_id'] = $product_assign_plan['category_featured_product_plan_id'];
				} else {
					$data['category_featured_product_plan_id'] = '';
				}
				/** get all vendors **/
				$data['vendors'] = $this->model_extension_purpletree_multivendor_vendor->getVendors();
			]]></add>
		</operation>
				<operation error="skip">
			<search><![CDATA[public function autocomplete() {]]></search>
			<add position="before"><![CDATA[
	public function getSellerPlan() {
		$json = array();
		$this->load->language('catalog/product');
		if (isset($this->request->get['seller_id'])) {
			
			if (isset($this->request->get['seller_id'])) {
				$seller_id = $this->request->get['seller_id'];
			} else {
				$seller_id = '';
			}

			$this->load->model('catalog/product');

			$result = $this->model_catalog_product->getSellerSubscriptionPlan($seller_id);
			if(!empty($result)){
				foreach($result as $key=>$value){
						$json[]=array(
						'plan_id'=>$value['plan_id'],
						'plan_name'=>$value['plan_name']
						);			
				}
			}
		}
		
		$this->response->addHeader('Content-Type: application/json');
		$this->response->setOutput(json_encode($json));
	}
			]]></add>
		</operation>	
		<operation error="skip">
			<search><![CDATA[$this->load->model('catalog/recurring');]]></search>
			<add position="before"><![CDATA[
				$data['module_purpletree_multivendor_subscription_plans'] = $this->config->get('module_purpletree_multivendor_subscription_plans');
				$data['module_purpletree_multivendor_multiple_subscription_plan_active'] = $this->config->get('module_purpletree_multivendor_multiple_subscription_plan_active');
			]]></add>
		</operation>	
		<operation error="skip">
			<search><![CDATA[$data['location'] = '';]]></search>
			<add position="after" offset="2"><![CDATA[
		$seller_id=0;
		if(isset($seller_pro1['seller_id'])){
		$seller_id = $seller_pro1['seller_id'];
		}
		$this->load->model('extension/purpletree_multivendor/vendor');
		if (isset($this->request->get['product_id'])){
			$data['hidetab'] = $this->model_extension_purpletree_multivendor_vendor->getAdmintempProductId($this->request->get['product_id']);			
		}		
		$data['product_plan_info'] = $this->model_catalog_product->getSellerSubscriptionPlan($seller_id);
        $this->load->language('customer/ptscustomer');
        $product_plan_name='';
		$featured_product_plan_name='';
		$category_featured_product_plan_name='';
		if(isset($this->request->get['product_id'])){
			$product_plan_name= $this->model_extension_purpletree_multivendor_vendor->productPlanName($this->request->get['product_id']);
			$featured_product_plan_name= $this->model_extension_purpletree_multivendor_vendor->featuredProductPlanName($this->request->get['product_id']);
			$category_featured_product_plan_name= $this->model_extension_purpletree_multivendor_vendor->categoryFeaturedProductPlanName($this->request->get['product_id']);
		}
		if (isset($this->request->post['product_plan_id'])) {
			$data['product_plan_id'] = $this->request->post['product_plan_id'];
		} elseif ($product_plan_name) {
			$data['product_plan_id'] =$this->model_extension_purpletree_multivendor_vendor->featuredProductPlanName($this->request->get['product_id']);
		} else {
			$data['product_plan_id'] = '';
		}
		if (isset($this->request->post['featured_product_plan_id'])) {
			$data['featured_product_plan_id'] = $this->request->post['featured_product_plan_id'];
		} elseif ($product_plan_name) {
			$data['featured_product_plan_id'] =$this->model_extension_purpletree_multivendor_vendor->featuredProductPlanName($this->request->get['product_id']);
		} else {
			$data['featured_product_plan_id'] = '';
		}
		if (isset($this->request->post['category_featured_product_plan_id'])) {
			$data['category_featured_product_plan_id'] = $this->request->post['category_featured_product_plan_id'];
		} elseif ($product_plan_name) {
			$data['category_featured_product_plan_id'] =$this->model_extension_purpletree_multivendor_vendor->categoryFeaturedProductPlanName($this->request->get['product_id']);
		} else {
			$data['category_featured_product_plan_id'] = '';
		}
			]]></add>
		</operation>		
	</file>

	<file path="admin/view/template/catalog/product_form.twig">
		<operation error="skip">
			<search><![CDATA[<li><a href="#tab-design" data-toggle="tab">{{ tab_design }}</a></li>]]></search>
			<add position="after"><![CDATA[
			<!-- Vendor Tab-->
				<li><a href="#tab-vendor" data-toggle="tab">{{ tab_vendor }}</a></li>
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[</form>]]></search>
			<add position="before" offset="1"><![CDATA[
			<!-- Vendor Tab-->
				<div class="tab-pane" id="tab-vendor">
				<div class="form-group">
				<label class="col-sm-2 control-label" for="input-vendor">{{ tab_vendor }}</label>
				<div class="col-sm-10">
				<select name="vendor" id="input-vendor" class="form-control">
					<option value="0">{{ text_none }}</option>
					{% for vendr in vendors %}
					{% if vendor == vendr.seller_id %}
					<option value="{{ vendr.seller_id }}" selected="selected">{{ vendr.name }}</option>
					{% else %}
					<option value="{{ vendr.seller_id }}">{{ vendr.name }}</option>
					{% endif %}
					{% endfor %}
				  </select>
				</div>
              </div>
			{% if module_purpletree_multivendor_subscription_plans %}
			  {% if module_purpletree_multivendor_multiple_subscription_plan_active %}
			<div class="pts-form-group">
			 <div class="subscription form-group" style="display:none">
				<label class="col-sm-2 control-label" for="subscription-plan">{{ text_subscription_plan_product }}</label>
				<div class="col-sm-10">
				<select name="product_plan_id" id="input-subscription_plan" class="form-control">
					<option value="0">{{ text_none }}</option>
					 {% for plans in product_plan_info %} 
				      <option  value="{{ plans.plan_id }}" {% if plans.plan_id == product_plan_id %} selected="selected" {% endif %} >{{ plans.plan_name }}</option>
					{% endfor %} 
				</select>
				</div>
			  </div>
            </div>
			  {% endif %}
			 {% endif %}	
			{% if module_purpletree_multivendor_subscription_plans %}
			{% if module_purpletree_multivendor_multiple_subscription_plan_active %}
			<div class="pts-form-group">
			 <div class="subscription form-group" style="display:none">
				<label class="col-sm-2 control-label" for="subscription-plan">{{ text_featured_product_for_category }}</label>
				<div class="col-sm-10">
				<select name="featured_product_plan_id" id="input-featured_product_plan_id" class="form-control">
					<option value="0">{{ text_none }}</option>
					 {% for plans in product_plan_info %} 
				      <option  value="{{ plans.plan_id }}" {% if plans.plan_id == featured_product_plan_id %} selected="selected" {% endif %} >{{ plans.plan_name }}</option>
					{% endfor %} 
				</select>
				</div>
			  </div>
            </div>
			 {% endif %}
			 {% endif %}	
			 {% if module_purpletree_multivendor_subscription_plans %}
			  {% if module_purpletree_multivendor_multiple_subscription_plan_active %}
				<div class="pts-form-group">
				 <div class="subscription form-group" style="display:none">
					<label class="col-sm-2 control-label" for="subscription-plan">{{ text_featured_product_for_carousel }}</label>
					<div class="col-sm-10">
					<select name="category_featured_product_plan_id" id="input-category_featured_product_plan_id" class="form-control">
						<option value="0">{{ text_none }}</option>
						 {% for plans in product_plan_info %} 
						  <option  value="{{ plans.plan_id }}" {% if plans.plan_id == category_featured_product_plan_id %} selected="selected" {% endif %} >{{ plans.plan_name }}</option>
						{% endfor %} 
					</select>
					</div>
				  </div>
				</div>
			  {% endif %}
			 {% endif %}
            </div>
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[<label class="col-sm-2 control-label" for="input-price">{{ entry_price }}</label>]]></search>
			<add position="before" offset="1"><![CDATA[
				{% if not hidetab %}
			]]></add>
		</operation>		
		<operation error="skip">
			<search><![CDATA[<label class="col-sm-2 control-label" for="input-tax-class">{{ entry_tax_class }}</label>]]></search>
			<add position="before" offset="1"><![CDATA[
				{% endif %}
			]]></add>
		</operation>				
		<operation error="skip">
			<search><![CDATA[<label class="col-sm-2 control-label" for="input-quantity">{{ entry_quantity }}</label>]]></search>
			<add position="before" offset="1"><![CDATA[
				{% if not hidetab %}
			]]></add>
		</operation>		
		<operation error="skip">
			<search><![CDATA[<label class="col-sm-2 control-label" for="input-minimum"><span data-toggle="tooltip" title="{{ help_minimum }}">{{ entry_minimum }}</span></label>]]></search>
			<add position="before" offset="1"><![CDATA[
				{% endif %}
			]]></add>
		</operation>		
		<operation error="skip">
			<search><![CDATA[<label class="col-sm-2 control-label" for="input-subtract">{{ entry_subtract }}</label>]]></search>
			<add position="before" offset="1"><![CDATA[
				{% if not hidetab %}
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[<label class="col-sm-2 control-label">{{ entry_shipping }}</label>]]></search>
			<add position="before" offset="1"><![CDATA[
				{% endif %}
			]]></add>
		</operation>		
		<operation error="skip">
			<search><![CDATA[<li><a href="#tab-recurring" data-toggle="tab">{{ tab_recurring }}</a></li>]]></search>
			<add position="after" offset="0"><![CDATA[
				{% if not hidetab %}
			]]></add>
		</operation>		
		<operation error="skip">
			<search><![CDATA[<li><a href="#tab-image" data-toggle="tab">{{ tab_image }}</a></li>]]></search>
			<add position="before" offset="0"><![CDATA[
				{% endif %}
			]]></add>
		</operation>		
				<operation error="skip">
			<search><![CDATA[// Manufacturer]]></search>
			<add position="before"><![CDATA[
  var seller_id = $('select[id=\'input-vendor\']').val();
	  if(seller_id!=0){
		$('.subscription').css('display','block');   
	  }
		$('select[id="input-vendor"]').on('change', function(){
			var seller_id = $(this).val();
			if(seller_id == "0") {
				$('.subscription').css('display','none');
			} else {
				$('.subscription').css('display','block');
								$('#input-subscription_plan').empty();
				$('#input-subscription_plan').append($('<option value="">---None---</option>'));
				
				$('#input-featured_product_plan_id').empty();
				$('#input-featured_product_plan_id').append($('<option value="">---None---</option>'));
				
				$('#input-category_featured_product_plan_id').empty();
				$('#input-category_featured_product_plan_id').append($('<option value="">---None---</option>'));
		$.ajax({
			url: 'index.php?route=catalog/product/getSellerPlan&user_token={{ user_token }}&seller_id='+seller_id,
			dataType: 'json',
			success: function(json) {
				
				$.each(json,function(key,result){
				 $('#input-subscription_plan').append($('<option></option>').val(result['plan_id']).html(result['plan_name']));
				 
				 $('#input-featured_product_plan_id').append($('<option></option>').val(result['plan_id']).html(result['plan_name']));
				 
				 $('#input-category_featured_product_plan_id').append($('<option></option>').val(result['plan_id']).html(result['plan_name']));
				});

			},
			error: function(xhr, ajaxOptions, thrownError) {
				alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
			}
	    }); 
				
    }
})

			]]></add>
		</operation>
	</file>
	<file path="admin/model/catalog/product.php">
		<operation error="skip">
			<search><![CDATA[if (isset($data['product_attribute'])) {]]></search>
			<add position="before"><![CDATA[
			/** update product status according to mv config setting **/
				if (isset($data['vendor']) && !empty($data['vendor'])) {
					if($this->config->get('module_purpletree_multivendor_product_approval')){
						$is_approved = 0;
						$data['status'] = 0;
						$this->db->query("UPDATE " . DB_PREFIX . "product SET status = '0' WHERE product_id = '" . (int)$product_id . "'");
					} else{
						$is_approved = 1;
					}
		$is_featured = 0;
		if(isset($data['is_featured'])){
		  $is_featured = $data['is_featured'];
		} elseif(isset($data['featured_product_plan_id'])){
			if($data['featured_product_plan_id'] > 0) {
			$is_featured = 1;
			}
		}
		$is_category_featured = 0;
		if(isset($data['is_category_featured'])){
		  $is_category_featured = $data['is_category_featured'];
		}
		elseif(isset($data['category_featured_product_plan_id'])){
			if($data['category_featured_product_plan_id'] > 0) {
			$is_category_featured = 1;
			}
		}
		$this->db->query("INSERT INTO " . DB_PREFIX . "purpletree_vendor_products SET product_id = '" . (int)$product_id."', seller_id = '".(int)$data['vendor']."', is_approved ='".(int)$is_approved."',is_featured ='".(int)$is_featured."',is_category_featured ='".(int)$is_category_featured."', created_at =NOW(), updated_at =NOW()");
		         if(isset($data['product_plan_id'])){
						
					}else{
						$data['product_plan_id'] = 0;
					}
					if(isset($data['featured_product_plan_id'])){
						
					}else{
						$data['featured_product_plan_id'] = 0;
					}
					if(isset($data['category_featured_product_plan_id'])){
						
					}else{
						$data['category_featured_product_plan_id'] = 0;
					}
		$this->db->query("INSERT INTO " . DB_PREFIX . "purpletree_vendor_subscription_products SET product_id = '" . (int)$product_id . "',product_plan_id = '" . (int)$data['product_plan_id']. "',featured_product_plan_id = '" . (int)$data['featured_product_plan_id']. "',category_featured_product_plan_id = '" . (int)$data['category_featured_product_plan_id']. "'");
					
	}
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[if (!empty($data['product_attribute'])) {]]></search>
			<add position="before"><![CDATA[
			/** update or insert into seller products **/
				if (isset($data['product_plan_id'])) {
				$query= $this->db->query("SELECT * FROM " . DB_PREFIX . "purpletree_vendor_subscription_products WHERE product_id = '".(int)$product_id."'");
				if($query->num_rows>0){
				$this->db->query("UPDATE " . DB_PREFIX . "purpletree_vendor_subscription_products SET product_plan_id = '" . (int)$data['product_plan_id'] . "' WHERE product_id = '".(int)$product_id."'");
				}
			}
			
			$is_featured = 0;
			if (isset($data['featured_product_plan_id'])) {
			if($data['featured_product_plan_id'] > 0) {
			$is_featured = 1;
			}
				$query= $this->db->query("SELECT * FROM " . DB_PREFIX . "purpletree_vendor_subscription_products WHERE product_id = '".(int)$product_id."'");
				if($query->num_rows>0){
				$this->db->query("UPDATE " . DB_PREFIX . "purpletree_vendor_subscription_products SET featured_product_plan_id = '" . (int)$data['featured_product_plan_id'] . "' WHERE product_id = '".(int)$product_id."'");
				}
			}
			
		$is_category_featured = 0;
		if (isset($data['category_featured_product_plan_id'])) {
		if($data['category_featured_product_plan_id'] > 0) {
			 $is_category_featured = 1;
			}
				$query= $this->db->query("SELECT * FROM " . DB_PREFIX . "purpletree_vendor_subscription_products WHERE product_id = '".(int)$product_id."'");
				if($query->num_rows>0){
				$this->db->query("UPDATE " . DB_PREFIX . "purpletree_vendor_subscription_products SET category_featured_product_plan_id = '" . (int)$data['category_featured_product_plan_id'] . "' WHERE product_id = '".(int)$product_id."'");
				}
			}
				if (isset($data['vendor'])  && !empty($data['vendor'])) {
				if(isset($data['product_plan_id'])){
						
					}else{
						$data['product_plan_id'] = 0;
					}
					if(isset($data['featured_product_plan_id'])){
						
					}else{
						$data['featured_product_plan_id'] = 0;
					}
					if(isset($data['category_featured_product_plan_id'])){
						
					}else{
						$data['category_featured_product_plan_id'] = 0;
					}
					$query = $this->db->query("SELECT seller_id FROM " . DB_PREFIX . "purpletree_vendor_products WHERE product_id='".(int)$product_id."'");
					$query1 = $this->db->query("SELECT * FROM " . DB_PREFIX . "purpletree_vendor_subscription_products WHERE product_id='".(int)$product_id."'");
					
					if(!$query1->num_rows) {
					$this->db->query("INSERT INTO " . DB_PREFIX . "purpletree_vendor_subscription_products SET product_id = '" . (int)$product_id . "',product_plan_id = '" . (int)$data['product_plan_id']. "',featured_product_plan_id = '" . (int)$data['featured_product_plan_id']. "',category_featured_product_plan_id = '" . (int)$data['category_featured_product_plan_id']. "'");		
					}
					if($query->num_rows > 0) {
						$this->db->query("UPDATE " . DB_PREFIX . "purpletree_vendor_products SET seller_id = '" . (int)$data['vendor'] . "', updated_at =NOW(),is_category_featured ='".(int)$is_category_featured."',is_featured ='".(int)$is_featured."' WHERE product_id = '".(int)$product_id."'");
					} else {
						if($this->config->get('purpletree_multivendor_product_approval')){
							$is_approved = 0;
							$this->db->query("UPDATE " . DB_PREFIX . "product SET status = '0' WHERE product_id = '" . (int)$product_id . "'");
						} else{
							$is_approved = 1;
						}
						$this->db->query("INSERT INTO " . DB_PREFIX . "purpletree_vendor_products SET product_id = '" . (int)$product_id . "', seller_id = '" . (int)$data['vendor'] . "',is_category_featured ='".(int)$is_category_featured."',is_featured ='".(int)$is_featured."', created_at =NOW(), updated_at =NOW(), is_approved = '".(int)$is_approved."'");
						
					}
				} else {
					$query = $this->db->query("DELETE FROM " . DB_PREFIX . "purpletree_vendor_products WHERE product_id='".(int)$product_id."'");
					
						$query = $this->db->query("DELETE FROM " . DB_PREFIX . "purpletree_vendor_subscription_products WHERE product_id='".(int)$product_id."'");
				}
				
			]]></add>
		</operation>
		<operation error="skip">
		<search><![CDATA[public function getTotalProductsByLayoutId($layout_id) {]]></search>
		<add position="before"><![CDATA[
	  public function getSellerSubscriptionPlan($seller_id) {	
		$status='status';
		if($this->config->get('module_purpletree_multivendor_multiple_subscription_plan_active')){
		$status='new_status';	
	  }
       $sql = "SELECT pvsp.plan_id,pvpd.plan_name FROM " . DB_PREFIX . "purpletree_vendor_seller_plan pvsp LEFT JOIN  " . DB_PREFIX . "purpletree_vendor_plan_subscription pvps ON(pvsp.seller_id=pvps.seller_id) LEFT JOIN " . DB_PREFIX . "purpletree_vendor_plan_description pvpd ON(pvsp.plan_id=pvpd.plan_id) LEFT JOIN " . DB_PREFIX . "purpletree_vendor_plan pvp ON(pvp.plan_id=pvpd.plan_id) WHERE pvsp.seller_id='".(int)$seller_id."' AND pvsp.".$status."=1 AND pvps.status_id=1 AND pvpd.language_id='" . (int)$this->config->get('config_language_id') . "' AND pvp.status=1";
		$query = $this->db->query($sql);
			if($query->num_rows>0){
					return $query->rows;
			}else {
				return NULL;
			}
	}
	public function getSellerProductPlan($product_id) {	
       $sql = "SELECT product_plan_id,featured_product_plan_id,category_featured_product_plan_id FROM " . DB_PREFIX . "purpletree_vendor_subscription_products WHERE product_id='".(int)$product_id."'";
		$query = $this->db->query($sql);
			if($query->num_rows>0){
					return $query->row;
			}else {
				return NULL;
			}
	}

			]]></add>
		</operation>
		<operation error="skip">
		<search><![CDATA[public function getTotalProductsByLayoutId($layout_id) {]]></search>
		<add position="before"><![CDATA[
						public function getTemplateprod() {
		$query = $this->db->query("SELECT product_id FROM " . DB_PREFIX . "purpletree_vendor_template");
			if($query->num_rows>0){
		return $query->rows;
			}
	}
			]]></add>
		</operation>
	</file>
	<file path="catalog/controller/account/account.php">
	<operation error="skip">
			<search><![CDATA[public function index() {]]></search>
			<add position="after"><![CDATA[
			if($this->config->get('module_purpletree_multivendor_hide_user_menu')){
				$data['purpletree_module_status'] =$this->config->get('module_purpletree_multivendor_status');
				$store_detail = $this->customer->isSeller();		
				if(isset($data['purpletree_module_status'])){
					if(isset($store_detail['store_status']) && $store_detail['store_status'] == 1 && ($store_detail['multi_store_id'] == $this->config->get('config_store_id'))){	
						$this->response->redirect($this->url->link('extension/account/purpletree_multivendor/dashboardicons','', true));
				   }
				 }
			 }
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[if (isset($this->session->data['success'])) {]]></search>
			<add position="before"><![CDATA[
				if (isset($this->session->data['error_warning'])) {
					$data['error_warning'] = $this->session->data['error_warning'];

					unset($this->session->data['error_warning']);
				}
			]]></add>
		</operation>
	</file>
		<file path="catalog/view/theme/*/template/account/account.twig">
		<operation error="skip">
			<search><![CDATA[ {% if success %}]]></search>
			<add position="before"><![CDATA[
			{% if error_warning %}
			 <div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> {{ error_warning }}</div>
			 {% endif %}
			]]></add>
		</operation>
	</file>
		<file path="catalog/controller/extension/module/account.php">
		<operation error="skip">
			<search><![CDATA[$data['recurring'] = $this->url->link('account/recurring', '', true);]]></search>
			<add position="after"><![CDATA[
				$this->load->language('account/ptsregister');
				$data['sellercontact'] = $this->url->link('extension/account/purpletree_multivendor/sellercontact/customerContactlist', '', true);
				$data['sellercontact_module'] =$this->config->get('module_purpletree_multivendor_seller_contact');	
		$data['purpletree_module_status'] =$this->config->get('module_purpletree_multivendor_status');	
			]]></add>
		</operation>
		
		<operation error="skip">
			<search><![CDATA[return $this->load->view('extension/module/account', $data);]]></search>
			<add position="replace"><![CDATA[
				$store_detail = $this->customer->isSeller();
				if(!isset($store_detail['store_status'])){
					return $this->load->view('extension/module/account', $data);
				 }
				if(isset($store_detail['store_status'])){
					if(isset($store_detail['multi_store_id']) && $store_detail['multi_store_id'] == $this->config->get('config_store_id')){
						if($this->config->get('module_purpletree_multivendor_hide_user_menu')){ } else{
					
					return $this->load->view('extension/module/account', $data);
					}
					}else{
					  return $this->load->view('extension/module/account', $data);	
					}
				
				}
			]]></add>
		</operation>
	</file>
	<file path="catalog/view/theme/*/template/extension/module/account.twig">
		<operation error="skip">
			<search><![CDATA[ <a href="{{ newsletter }}" class="list-group-item">{{ text_newsletter }}</a>]]></search>
			<add position="before"><![CDATA[
			{% if sellercontact_module==1 and purpletree_module_status==1 %}
			<a href="{{ sellercontact }}" class="list-group-item">{{  text_seller_contact1 }}</a>
				{% endif %}
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[return $this->load->view('extension/module/account', $data);]]></search>
			<add position="replace"><![CDATA[
			if($this->config->get('module_purpletree_multivendor_hide_user_menu')){ } else{
			
				return $this->load->view('extension/module/account', $data);
		    }
			]]></add>
		</operation>
	</file>
	<file path="catalog/view/theme/journal2/template/extension/module/account.twig">       
		<operation error="skip">
			<search><![CDATA[ <a href="{{ newsletter }}" class="list-group-item">{{ text_newsletter }}</a>]]></search>
			<add position="before"><![CDATA[
			{% if sellercontact_module==1 and purpletree_module_status==1 %}
			<li style="list-style:none"><a href="{{ sellercontact }}" class="list-group-item">{{  text_seller_contact1 }}</a></li>
				{% endif %}
			]]></add>
		</operation>	
		<operation error="skip">
			<search><![CDATA[ 
			<a href="{{ sellercontact }}" class="list-group-item">{{  text_seller_contact1 }}</a> ]]></search>
			<add position="replace"><![CDATA[ ]]></add>
		</operation>	
        <operation error="skip">
			<search><![CDATA[ <li style="list-style:none"> ]]></search>
			<add position="replace"><![CDATA[<li style="list-style:none"><a href="{{ sellercontact }}" class="list-group-item">{{  text_seller_contact1 }}</a>]]></add>
		</operation>
	</file>
	
	<file path="admin/controller/customer/customer.php">
		<operation error="skip">
			<search><![CDATA[$data['user_token'] = $this->session->data['user_token'];]]></search>
			<add position="after"><![CDATA[
				$data['text_confirm_seller'] = $this->language->get('text_confirm_seller');
				$data['module_purpletree_multivendor_status'] = $this->config->get('module_purpletree_multivendor_status');
			$data['module_purpletree_multivendor_become_seller'] = $this->config->get('module_purpletree_multivendor_become_seller');
				$data['text_seller'] = $this->language->get('text_seller');
				$data['text_store_name'] = $this->language->get('text_store_name');
			]]></add>
		</operation>
		
		<operation error="skip">
		<search><![CDATA[$this->load->language('customer/customer');]]></search>
				<add position="after"><![CDATA[
				$this->load->language('customer/ptscustomer');
				]]></add>
			</operation>
		<operation error="skip">
			<search><![CDATA[$this->model_customer_customer->addCustomer($this->request->post);]]></search>
			<add position="replace"><![CDATA[		
			/** add seller **/
					$customer_id = $this->model_customer_customer->addCustomer($this->request->post);
			if($this->request->post['become_seller']==1){			
			     $livecheck = 1;
		      if (!$this->customer->validateSeller($livecheck)) {
				$this->load->language('purpletree_multivendor/ptsmultivendor');
				$this->session->data['error_warning'] = $this->language->get('error_license');
				$this->response->redirect($this->url->link('customer/customer', 'user_token=' . $this->session->data['user_token'] . $url, true));
			     }
			     $store_name = trim($this->request->post['seller_storename']);
					$this->load->model('extension/purpletree_multivendor/vendor');
							$file ='';
							$this->model_extension_purpletree_multivendor_vendor->addSeller($customer_id,$store_name, $this->request->post['become_seller'],$file);
				
			}
				
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[$this->model_customer_customer->editCustomer($this->request->get['customer_id'], $this->request->post);]]></search>
			<add position="after"><![CDATA[		
			/** edit seller **/
					$customer_id = $this->request->get['customer_id'];
					if($this->request->post['become_seller']==1){			
			     $livecheck = 1;
		      if (!$this->customer->validateSeller($livecheck)) {
				$this->load->language('purpletree_multivendor/ptsmultivendor');
				$this->session->data['error_warning'] = $this->language->get('error_license');
				$this->response->redirect($this->url->link('customer/customer', 'user_token=' . $this->session->data['user_token'] . $url, true));
			     }
					$store_name = trim($this->request->post['seller_storename']);
					$this->load->model('extension/purpletree_multivendor/vendor');
							$file ='';
							$this->model_extension_purpletree_multivendor_vendor->editSeller($customer_id,$store_name, $this->request->post['become_seller'],$file);
							
				}
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[$customer_info = $this->model_customer_customer->getCustomer($this->request->get['customer_id']);]]></search>
			<add position="after"><![CDATA[
			/** get seller store information **/
			$this->load->model('extension/purpletree_multivendor/stores');
			$seller_info = $this->model_extension_purpletree_multivendor_stores->getStoreDetail($this->request->get['customer_id']);
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[protected function validateForm() {]]></search>
			<add position="after"><![CDATA[
			$c_id = '';
			if(isset($this->request->get['customer_id'])) {
				$c_id = $this->request->get['customer_id'];
			}
			$this->load->model('extension/purpletree_multivendor/vendor');
			if($this->request->post['become_seller']){
			if(!$this->customer->validateSeller()) {
				$this->error['warning1'] = $this->language->get('error_license');
			}	
			$this->load->language('customer/ptscustomer');
			if ((utf8_strlen($this->request->post['seller_storename']) < 5) || (utf8_strlen(trim($this->request->post['seller_storename'])) > 50)) {
			$this->error['seller_store'] = $this->language->get('error_storename');
		} 		
				     $this->load->model('extension/purpletree_multivendor/stores');				
            $store_info1 = $this->model_extension_purpletree_multivendor_stores->getStoreNameByStoreName($this->request->post['seller_storename']);
		 
		if(isset($this->request->get['customer_id'])) {
			if ($store_info1 && ($this->request->get['customer_id'] != $store_info1['seller_id'] && strtoupper(trim($this->request->post['seller_storename']))==strtoupper($store_info1['store_name']))) {
				$this->error['seller_store'] = $this->language->get('error_exist_storename');
				$this->error['warning'] = $this->language->get('error_warning');
		}
		} 	else {
        if ($store_info1 && (strtoupper(trim($this->request->post['seller_storename']))==strtoupper($store_info1['store_name']))) {
				$this->error['seller_store'] = $this->language->get('error_exist_storename');
				$this->error['warning'] = $this->language->get('error_warning');
		}
		}		
			
			
		}
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[if (isset($this->request->post['customer_group_id'])) {]]></search>
			<add position="before"><![CDATA[
			/***  get become seller status and seller store name **/
			if (isset($this->request->post['become_seller'])) {
			$data['become_seller'] = $this->request->post['become_seller'];
		} elseif (!empty($seller_info)) {
			$data['become_seller'] = $seller_info['store_status'];
		} else {
			$data['become_seller'] = '';
			}
 		
		$data['become_seller_base'] = '';
		if (!empty($seller_info)) {
			$data['become_seller_base'] = $seller_info['store_status'];
		}
		if (isset($this->request->post['seller_storename'])) {
			$data['seller_storename'] = $this->request->post['seller_storename'];
		} elseif (!empty($seller_info)) {
			$data['seller_storename'] = $seller_info['store_name'];
		} else {
			$data['seller_storename'] = '';
		}
		
		
		]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[if (isset($this->error['address'])) {]]></search>
			<add position="before"><![CDATA[if (isset($this->error['seller_store'])) {
				$data['error_sellerstore'] = $this->error['seller_store'];
			} else {
				$data['error_sellerstore'] = '';
			}
			if (isset($this->error['warning1'])) {
			$data['error_warning1'] = $this->error['warning1'];
			} else {
				$data['error_warning1'] = '';
			}
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[$data['error_warning'] = $this->error['warning'];]]></search>
			<add position="after"><![CDATA[}elseif(isset($this->session->data['error_warning'])){
			$data['error_warning'] = $this->session->data['error_warning'];
			unset($this->session->data['error_warning']);
			]]></add>
		</operation>
	</file>
	<file path="admin/view/template/customer/customer_form.twig">
		<operation error="skip">
			<search><![CDATA[<label class="col-sm-2 control-label" for="input-safe">{{ entry_safe }}</label>]]></search>
			<add position="replace" index="1" offset="12"><![CDATA[
			<label class="col-sm-2 control-label" for="input-safe">{{ entry_safe }}</label>
                          <div class="col-sm-10">
                            <select name="safe" id="input-safe" class="form-control">
                              {% if safe %}
                              <option value="1" selected="selected">{{ text_yes }}</option>
                              <option value="0">{{ text_no }}</option>
                              {% else %}
                              <option value="1">{{ text_yes }}</option>
                              <option value="0" selected="selected">{{ text_no }}</option>
                              {% endif %}
                            </select>
                          </div>
				</div>
				{% if module_purpletree_multivendor_status %}
				<div class="form-group">
				<label class="col-sm-2 control-label">{{ text_seller }}</label>
				<div class="col-sm-10">
				<label class="radio-inline">
                <input type="radio" name="become_seller" value="0" checked="checked" id="add_document"/>
                {{ text_no }}</label>
				<label class="radio-inline">
                <input type="radio" name="become_seller" value="1" {{ ((become_seller=="1")?'checked="checked"':'') }} id="remove_document"/>
                {{ text_yes }}</label>
				</div> 
			</div>
			<div class="form-group">
				<label class="col-sm-2 control-label">{{ text_store_name }}</label>
				<div class="col-sm-10">
                <input type="text" name="seller_storename" value="{{ seller_storename }}" class="form-control"  />
				 {% if error_sellerstore %}
              <div class="text-danger">{{ error_sellerstore }}</div>
              {% endif %}
            </div>
            </div>
			{% endif %}
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[<button type="submit" form="form-customer" data-toggle="tooltip" title="{{ button_save }}" class="btn btn-primary"><i class="fa fa-save"></i></button>]]></search>
			<add position="replace" index="0" offset="0"><![CDATA[<button type="button" onclick="checkdata()" data-toggle="tooltip" title="{{ button_save }}" class="btn btn-primary"><i class="fa fa-save"></i></button>		
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[{% if error_warning %}]]></search>
			<add position="before"><![CDATA[
				{% if error_warning1 %}
				<div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> {{ error_warning1 }}
				  <button type="button" class="close" data-dismiss="alert">&times;</button>
				</div>
				{% endif %}
			]]></add>
		</operation>
		
		<operation error="skip">
				<search><![CDATA[{{ footer }]]></search>
				<add position="before"><![CDATA[
				 <script>
				  function checkdata(){			
						 
				       {% if become_seller_base != '' %}
						if($('#add_document').is(':checked')) {  
								confirm('{{ text_confirm_seller }}') ? $('#form-customer').submit() : false;
						} else {
							$('#form-customer').submit();
						}
				  {% else %}
					$('#form-customer').submit();
				  {% endif %}
  
                  }
				 </script>
				]]></add>					
			</operation>				
	</file>
	
		<file path="catalog/model/extension/d_quickcheckout/order.php">   
		 <operation error="skip">
			<search><![CDATA[public function addOrder($data) {]]></search>
			<add position="after"><![CDATA[
			$total = 0;	
			$seller_sub_total = array();
			$seller_final_total = array();
			$seller_tax_data = array();
			$seller_total_tax = array();
			$tax_data = array();
			$seller = array();
			$seller_shipping = array();
			]]></add>
		</operation>
		
		<operation error="skip">
			<search><![CDATA[public function updateOrder($order_id, $data) {]]></search>
			<add position="after"><![CDATA[
			$total = 0;	
			$seller_sub_total = array();
			$seller_final_total = array();
			$seller_tax_data = array();
			$seller_total_tax = array();
			$tax_data = array();
			$seller = array();
			$seller_shipping = array();
			]]></add>
		</operation>
		
		 <operation error="skip">
			<search><![CDATA[$this->db->query("DELETE FROM " . DB_PREFIX . "order_option WHERE order_id = '" . (int) $order_id . "'");]]></search>
			<add position="after"><![CDATA[
			$this->db->query("DELETE FROM " . DB_PREFIX . "purpletree_vendor_orders WHERE order_id = '" . (int)$order_id . "'");
			$this->db->query("DELETE FROM " . DB_PREFIX . "purpletree_vendor_commissions WHERE order_id = '" . (int)$order_id . "'");
			]]></add>
		 </operation>
		 
		 <operation error="skip">
			<search><![CDATA[$this->db->query("DELETE FROM " . DB_PREFIX . "order_voucher WHERE order_id = '" . (int) $order_id . "'");]]></search>
			<add position="after"><![CDATA[
			$this->db->query("DELETE FROM " . DB_PREFIX . "purpletree_order_total WHERE order_id = '" . (int)$order_id . "'");
			]]></add>
		</operation>
		 
		 <operation error="skip">
			<search><![CDATA[public function addOrder($data) {]]></search>
			<add position="before"><![CDATA[
			public function getProductCategory($productid){
		
		$sql = "SELECT category_id FROM " . DB_PREFIX . "product_to_category where 	product_id = '".(int)$productid."'"; 
		
		  $query = $this->db->query($sql);
		  
		  return $query->rows;  
		}
			public function getVendorOrderProducts($order_id) {
		$query = $this->db->query("SELECT * FROM " . DB_PREFIX . "purpletree_vendor_orders WHERE order_id = '" . (int)$order_id . "'");
		
		return $query->rows;
	}
			public function getMatrixShippingCharge($address,$totalweight,$seller_id){

			 $sql = "SELECT * FROM " . DB_PREFIX . "purpletree_vendor_shipping pvss WHERE pvss.seller_id =".$seller_id." AND pvss.shipping_country = '".$address['shipping_country_id']."'";
			 if(!is_numeric($address['shipping_postcode'])) {
			 $sql .= " AND pvss.zipcode_from = '".$address['shipping_postcode']."' AND pvss.zipcode_to = '".$address['shipping_postcode']."'";
			 }
			 $shippingqery = $this->db->query($sql)->rows;
			if(!empty($shippingqery)) {
				$shipprice = array();
				foreach($shippingqery as $shipp) {
					if($totalweight >= $shipp['weight_from'] && $totalweight <= $shipp['weight_to']) {
						 if(is_numeric($address['shipping_postcode'])) {
							 if($address['shipping_postcode'] >= $shipp['zipcode_from'] && $address['shipping_postcode'] <= $shipp['zipcode_to']) {
								$shipprice[] = $shipp['shipping_price'];
							 }
						 } else {
							$shipprice[] = $shipp['shipping_price'];
						 }
					}
				}

				if(!empty($shipprice)) {
					return max($shipprice);
				}
					
			}
		}
	public function getoptionsweight($product){
		$productsql = "SELECT weight,weight_class_id FROM ".DB_PREFIX."product WHERE product_id =".$product['product_id']."";
				$productquery = $this->db->query($productsql)->row;
				$totweight = $productquery['weight'];
			if(!empty($product['option'])) {
				foreach($product['option'] as $productsoptin) {
					//echo "c";
					$productsql1 = "SELECT pov.weight,pov.weight_prefix,p.weight_class_id FROM ".DB_PREFIX."product p JOIN ". DB_PREFIX ."product_option_value pov ON(pov.product_id = p.product_id) WHERE pov.product_option_value_id = '".$productsoptin['product_option_value_id']."' AND pov.product_option_id = '".$productsoptin['product_option_id']."' AND pov.product_id = '".$product['product_id']."' AND pov.option_id = '".$productsoptin['option_id']."' AND pov.option_value_id = '".$productsoptin['option_value_id']."'";
					$productquery1 = $this->db->query($productsql1)->row;
					if(!empty($productquery1)){
						if ($productquery1['weight_prefix'] == '+') {
							$totweight += $totweight+($productquery1['weight'] * $product['quantity']);	
						} elseif ($product_option_value_info['weight_prefix'] == '-') {
							$totweight -= $totweight-($productquery1['weight'] * $product['quantity']);
						}
					}
				}
			} else {
					$totweight = $totweight * $product['quantity'];
			}
		$totalweight = $this->weight->convert($totweight, $productquery['weight_class_id'], $this->config->get('config_weight_class_id'));
		return $totalweight;
	}			
	public function getsellershipping($seller_shipping,$product,$address) {

		if($seller_shipping['seller_id'] == '0'){
	
				$shipping_purpletree_shipping_type = (null !== $this->config->get('shipping_purpletree_shipping_type'))? $this->config->get('shipping_purpletree_shipping_type') : 'pts_flat_rate_shipping';
			$shipping_purpletree_shipping_order_type = (null !== $this->config->get('shipping_purpletree_shipping_order_type'))? $this->config->get('shipping_purpletree_shipping_order_type') : 'pts_product_wise';
			$shipping_purpletree_shipping_charge = (null !== $this->config->get('shipping_purpletree_shipping_charge'))? $this->config->get('shipping_purpletree_shipping_charge') : '0';

		} else {
		$shipping_purpletree_shipping_type 			= $seller_shipping['store_shipping_type'] != '' ? $seller_shipping['store_shipping_type'] : 'pts_flat_rate_shipping';
		$shipping_purpletree_shipping_order_type 	= $seller_shipping['store_shipping_order_type'] != '' ? $seller_shipping['store_shipping_order_type'] : 'pts_product_wise';
		$shipping_purpletree_shipping_charge 		= $seller_shipping['store_shipping_charge'] != '' ? $seller_shipping['store_shipping_charge'] : '0';
		}
		$total = 0;
		$totalweight = $this->getoptionsweight($product);
		$getMatrixShippingCharge = $this->getMatrixShippingCharge($address,$totalweight,$seller_shipping['seller_id']);
		// if Matric shipping
		
		if($shipping_purpletree_shipping_type == 'pts_matrix_shipping'){
			if($address['shipping_postcode'] != '') {
				if($shipping_purpletree_shipping_order_type == 'pts_product_wise'){
					if($getMatrixShippingCharge) {
						$total = $getMatrixShippingCharge;
					}
				} 
			}					
		} // if Matric shipping
		// if Flexible shipping
		elseif($shipping_purpletree_shipping_type  == 'pts_flexible_shipping'){
			if($address['shipping_postcode'] != '') {
				if($shipping_purpletree_shipping_order_type == 'pts_product_wise'){
					if($getMatrixShippingCharge) {
						 $total = $getMatrixShippingCharge;
					} else {
						 $total = $shipping_purpletree_shipping_charge;
					}
				}
			} else {
				if($shipping_purpletree_shipping_order_type == 'pts_product_wise'){
					 $total = $shipping_purpletree_shipping_charge;
				}
			}
		} // if Flexible shipping
		// if Flat Rate shipping
			else {
			if($shipping_purpletree_shipping_order_type == 'pts_product_wise'){
				 $total = $shipping_purpletree_shipping_charge;
			}
		}
		
		// if Flat Rate shipping
		return $total;	
	}
	public function getsellershipping1($seller_shipping,$product,$address) {
		if($seller_shipping['seller_id'] == '0'){
			$shipping_purpletree_shipping_type = (null !== $this->config->get('shipping_purpletree_shipping_type'))? $this->config->get('shipping_purpletree_shipping_type') : 'pts_flat_rate_shipping';
			$shipping_purpletree_shipping_order_type = (null !== $this->config->get('shipping_purpletree_shipping_order_type'))? $this->config->get('shipping_purpletree_shipping_order_type') : 'pts_product_wise';
			$shipping_purpletree_shipping_charge = (null !== $this->config->get('shipping_purpletree_shipping_charge'))? $this->config->get('shipping_purpletree_shipping_charge') : '0';

		} else {
		$shipping_purpletree_shipping_type 			= $seller_shipping['store_shipping_type'] != '' ? $seller_shipping['store_shipping_type'] : 'pts_flat_rate_shipping';
		$shipping_purpletree_shipping_order_type 	= $seller_shipping['store_shipping_order_type'] != '' ? $seller_shipping['store_shipping_order_type'] : 'pts_product_wise';
		$shipping_purpletree_shipping_charge 		= $seller_shipping['store_shipping_charge'] != '' ? $seller_shipping['store_shipping_charge'] : '0';
		}
		$weightt = 0;
		// if Matric shipping
		if($shipping_purpletree_shipping_type == 'pts_matrix_shipping'){
			if($address['shipping_postcode'] != '') {
				if($shipping_purpletree_shipping_order_type == 'pts_order_wise'){
					 $weightt = $this->getoptionsweight($product);;
				}
			}					
		}// if Matric shipping
		// if Flexible shipping
		elseif($shipping_purpletree_shipping_type  == 'pts_flexible_shipping'){
			if($address['shipping_postcode'] != '') {
				if($shipping_purpletree_shipping_order_type == 'pts_order_wise'){
					  $weightt = $this->getoptionsweight($product);;
				}
			} else {
				if($shipping_purpletree_shipping_order_type == 'pts_order_wise'){
				 $weightt = $this->getoptionsweight($product);;
				}
			}
		} // if Flexible shipping
		// if Flat Rate shipping
			else {
			if($shipping_purpletree_shipping_order_type == 'pts_order_wise'){
				 
				  $weightt = $this->getoptionsweight($product);
			}
		}
		
		// if Flat Rate shipping
		return $weightt;	
	}
	]]></add>
		</operation>
		
		<operation error="skip">
			<search><![CDATA[foreach ($data['products'] as $product) {]]></search>
			<add position="before"><![CDATA[
			$store_shipping_type = array();
			]]></add>
		</operation>
		 
		 
		 <operation error="skip">
			<search><![CDATA[$order_product_id = $this->db->getLastId();]]></search>
			<add position="after"><![CDATA[
		 /*** insert into seller orders ****/
			if ($this->config->get('module_purpletree_multivendor_status')) {	
					
					$seller_id = $this->db->query("SELECT pvp.seller_id, pvs.store_shipping_charge,pvs.store_shipping_order_type,pvs.store_shipping_type,pvs.store_commission, p.tax_class_id FROM " . DB_PREFIX . "purpletree_vendor_products pvp JOIN " . DB_PREFIX . "purpletree_vendor_stores pvs ON(pvs.seller_id=pvp.seller_id) JOIN " . DB_PREFIX . "product p ON(p.product_id=pvp.product_id) WHERE pvp.product_id='".(int)$product['product_id']."' AND pvp.is_approved=1")->row;
					if($this->config->get('module_purpletree_multivendor_seller_product_template')){
					if(empty($seller_id['seller_id'])) {
						$sseller_id = $product['seller_id'];
						$seller_id = $this->db->query("SELECT pvs.seller_id, pvs.store_shipping_charge,pvs.store_shipping_order_type,pvs.store_shipping_type,pvs.store_commission, p.tax_class_id FROM " . DB_PREFIX . "purpletree_vendor_template_products pvtp JOIN " . DB_PREFIX . "purpletree_vendor_stores pvs ON(pvs.seller_id=pvtp.seller_id) JOIN " . DB_PREFIX . "purpletree_vendor_template pvt ON(pvt.id=pvtp.template_id) JOIN " . DB_PREFIX . "product p ON(p.product_id=pvt.product_id) WHERE pvt.product_id='".(int)$product['product_id']."' AND pvs.seller_id=".$sseller_id."")->row;
					}
					}
					if(!empty($seller_id['seller_id'])) {
						
						$this->db->query("INSERT INTO " . DB_PREFIX . "purpletree_vendor_orders SET order_id ='".(int)$order_id."', seller_id = '".(int)$seller_id['seller_id']."', product_id ='".(int)$product['product_id']."', shipping = '".(float)$seller_id['store_shipping_charge']."', quantity = '" . (int)$product['quantity'] . "', unit_price = '" . (float)$product['price'] . "', total_price = '" . (float)$product['total'] . "', created_at =NOW(), updated_at = NOW()");
						
						
						$this->db->query("INSERT INTO " . DB_PREFIX . "purpletree_vendor_commissions SET order_id = '" . (int)$order_id . "', product_id ='".(int)$product['product_id']."', seller_id = '" . (int)$seller_id['seller_id'] . "', commission_shipping = '0', commission_fixed = '0', commission_percent = '0', commission = '0', status = 'Pending', created_at = NOW(), updated_at = NOW()");
						
						if(!isset($seller_sub_total[$seller_id['seller_id']])){
						$seller_sub_total[$seller_id['seller_id']] = $product['total'];
						} else {
							$seller_sub_total[$seller_id['seller_id']] += $product['total'];
						}
						
						if(!isset($seller_final_total[$seller_id['seller_id']])){
							$seller_final_total[$seller_id['seller_id']] = $this->tax->calculate($product['price'], $seller_id['tax_class_id'], $this->config->get('config_tax')) * $product['quantity'];
						} else {
							$seller_final_total[$seller_id['seller_id']] += $this->tax->calculate($product['price'], $seller_id['tax_class_id'], $this->config->get('config_tax')) * $product['quantity'];
						}
						
						$tax_rates = $this->tax->getRates($product['price'], $seller_id['tax_class_id']);
			
						foreach ($tax_rates as $tax_rate) {
							if (!isset($seller_tax_data[$seller_id['seller_id']][$tax_rate['tax_rate_id']])) {
								$seller_tax_data[$seller_id['seller_id']][$tax_rate['tax_rate_id']] = ($tax_rate['amount'] * $product['quantity']);
							} else {
								$seller_tax_data[$seller_id['seller_id']][$tax_rate['tax_rate_id']] += ($tax_rate['amount'] * $product['quantity']);
							}
						}
				$shipping_purpletree_shipping_order_type 			= $seller_id['store_shipping_order_type'] != '' ? $seller_id['store_shipping_order_type']:'pts_product_wise' ;
				$shipping_purpletree_shipping_type 			= $seller_id['store_shipping_type'] != '' ? $seller_id['store_shipping_type']:'pts_flat_rate_shipping' ;
				$shipping_purpletree_shipping_charge 		= $seller_id['store_shipping_charge'] != '' ? $seller_id['store_shipping_charge'] : '0';
						$getsellershipping = $this->getsellershipping($seller_id,$product,$data);
						$getsellershipping1 = $this->getsellershipping1($seller_id,$product,$data);
						if(!isset($seller_shipping[$seller_id['seller_id']])){
							$seller_shipping[$seller_id['seller_id']] = $getsellershipping;
							$seller_shipping1[$seller_id['seller_id']] = $getsellershipping1;
						} else {
							$seller_shipping[$seller_id['seller_id']] += $getsellershipping;
							$seller_shipping1[$seller_id['seller_id']] += $getsellershipping1;
						}
					} else {
						$seller_id = array();
						$seller_id['seller_id'] = 0;
						$getsellershipping = $this->getsellershipping($seller_id,$product,$data);
						$getsellershipping1 = $this->getsellershipping1($seller_id,$product,$data);
						if(!isset($seller_shipping[$seller_id['seller_id']])){
							$seller_shipping[$seller_id['seller_id']] = $getsellershipping;
							$seller_shipping1[$seller_id['seller_id']] = $getsellershipping1;
						} else {
							$seller_shipping[$seller_id['seller_id']] += $getsellershipping;
							$seller_shipping1[$seller_id['seller_id']] += $getsellershipping1;
						}
				$shipping_purpletree_shipping_order_type = (null !== $this->config->get('shipping_purpletree_shipping_order_type'))? $this->config->get('shipping_purpletree_shipping_order_type') : 'pts_product_wise';
				$shipping_purpletree_shipping_type = (null !== $this->config->get('shipping_purpletree_shipping_type'))? $this->config->get('shipping_purpletree_shipping_type') : 'pts_flat_rate_shipping';
				$shipping_purpletree_shipping_charge = (null !== $this->config->get('shipping_purpletree_shipping_charge'))? $this->config->get('shipping_purpletree_shipping_charge') : '0';
					} 
				$store_shipping_type[$seller_id['seller_id']] = $shipping_purpletree_shipping_type;
				$store_shipping_charge[$seller_id['seller_id']] = $shipping_purpletree_shipping_charge;
				$store_shipping_order_type[$seller_id['seller_id']] = $shipping_purpletree_shipping_order_type;
				}
			]]></add>
		</operation>
		
		<operation error="skip">
			<search><![CDATA[foreach ($data['vouchers'] as $voucher) {]]></search>
			<add position="before"><![CDATA[
					if(!empty($seller_shipping1)) {
			foreach($seller_shipping1 as $sellerid => $totalweight) {
				if($store_shipping_order_type[$sellerid] == 'pts_order_wise')  {
					$getMatrixShippingCharge1 = $this->getMatrixShippingCharge($data,$totalweight,$sellerid);
					if($store_shipping_type[$sellerid] == 'pts_matrix_shipping') {
						if($data['shipping_postcode'] != '') {
							if($getMatrixShippingCharge1) {
								$seller_shipping[$sellerid] += $getMatrixShippingCharge1;
							}
						} 
					} elseif($store_shipping_type[$sellerid] == 'pts_flexible_shipping') {
						if($getMatrixShippingCharge1) {
							$seller_shipping[$sellerid] += $getMatrixShippingCharge1;
						} else {
							$seller_shipping[$sellerid] += $store_shipping_charge[$sellerid];
						}
					} elseif($store_shipping_type[$sellerid] == 'pts_flat_rate_shipping') {
							$seller_shipping[$sellerid] += $store_shipping_charge[$sellerid];
					}
				}
			}
		}
					$this->load->language('extension/total/total');
			/**************************************** For seller tax*******************************/
		if(! empty($seller_tax_data))
		{
			foreach($seller_tax_data as $key=>$value){
				foreach ($value as $key1 => $value1) {
					if ($value1 > 0) {
						$tax_detail[$key][] = array(
							'code'       => 'tax',
							'title'      => $this->tax->getRateName($key1),
							'value'      => $value1,
							'sort_order' => $this->config->get('total_tax_sort_order')
						);
						if(!isset($seller_total_tax[$key])){
							$seller_total_tax[$key] = $value1;
						} else {
							$seller_total_tax[$key] +=$value1 ;
						}
					}
				}
			} 
			}
			/**************************************** For seller shipping*******************************/
			$this->load->language('account/ptsregister');
			if($this->config->get('shipping_purpletree_shipping_status')){
			if($data['shipping_code'] == 'purpletree_shipping.purpletree_shipping') {
				foreach($seller_shipping as $key=>$value) {
					if ($value > 0) {
						$shippingtitle = $this->language->get('text_seller_shipping_total');
						if($key == 0) {
						$shippingtitle = $this->language->get('text_admin_shipping_total');
						}
						$tax_detail[$key][] = array(
							'code'       => 'seller_shipping',
							'title'      => $shippingtitle,
							'value'      => $value,
							'sort_order' => '2'
						);
					}
				}	
			}
			}
		
			/**************************************** For seller total*******************************/
			
			foreach($seller_final_total as $key=>$value) {
				if(!isset($seller_total_tax[$key])){
					$seller_total_tax[$key]=0;
				}
				if(!$this->config->get('shipping_purpletree_shipping_status')){
						$seller_shipping[$key]=0;
				}
				//echo $data['shipping_code'];
				if($data['shipping_code'] != 'purpletree_shipping.purpletree_shipping') {
						$seller_shipping[$key]=0;
				}
				if ($value > 0) { 
					$tax_detail[$key][] = array(
						'code'       => 'total',
						'title'      => $this->language->get('text_total'),
						'value'      => max(0, ($seller_sub_total[$key]+$seller_total_tax[$key]+$seller_shipping[$key])),
						'sort_order' => $this->config->get('total_total_sort_order')
					);
				}
			}
				
			/**************************************** For seller sub-total*******************************/
			foreach($seller_sub_total as $key=>$value) {
				if ($value > 0) {
					$tax_detail[$key][] = array(
						'code'       => 'sub_total',
						'title'      => $this->language->get('text_sub_total'),
						'value'      => $value,
						'sort_order' => $this->config->get('sub_total_sort_order')
					);
				}
			}
			//echo "<pre>";
			//print_r($tax_detail);
		if (isset($tax_detail)) {
			foreach ($tax_detail as $key=>$value) {
				foreach($value as $data_1){
					$this->db->query("INSERT INTO " . DB_PREFIX . "purpletree_order_total SET order_id = '" . (int)$order_id . "', seller_id = '".(int)$key."', code = '" . $this->db->escape($data_1['code']) . "', title = '" . $this->db->escape($data_1['title']) . "', `value` = '" . (float)$data_1['value'] . "', sort_order = '" . (int)$data_1['sort_order'] . "'");
				}
			}
		}
			]]></add>
		</operation>
</file>
	<file path="catalog/model/journal3/order.php">
		<operation error="skip">
			<search><![CDATA[private function addOrder($data) {]]></search>
			<add position="after"><![CDATA[
			$total = 0;	
			$seller_sub_total = array();
			$seller_final_total = array();
			$seller_tax_data = array();
			$seller_total_tax = array();
			$tax_data = array();
			$seller = array();
			$seller_shipping = array();
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[private function editOrder($order_id, $data) {]]></search>
			<add position="after"><![CDATA[
			$total = 0;	
			$seller_sub_total = array();
			$seller_final_total = array();
			$seller_tax_data = array();
			$seller_total_tax = array();
			$tax_data = array();
			$seller = array();
			$seller_shipping = array();
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[$this->db->query("DELETE FROM " . DB_PREFIX . "order_option WHERE order_id = '" . (int)$order_id . "'");]]></search>
			<add position="after"><![CDATA[
			$this->db->query("DELETE FROM " . DB_PREFIX . "purpletree_vendor_orders WHERE order_id = '" . (int)$order_id . "'");
			$this->db->query("DELETE FROM " . DB_PREFIX . "purpletree_vendor_commissions WHERE order_id = '" . (int)$order_id . "'");
			]]></add>
		</operation>
				<operation error="skip">
			<search><![CDATA[$this->db->query("DELETE FROM " . DB_PREFIX . "order_voucher WHERE order_id = '" . (int)$order_id . "'");]]></search>
			<add position="after"><![CDATA[
			$this->db->query("DELETE FROM " . DB_PREFIX . "purpletree_order_total WHERE order_id = '" . (int)$order_id . "'");
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[private function addOrder($data) {]]></search>
			<add position="before"><![CDATA[
			public function getProductCategory($productid){
		
		$sql = "SELECT category_id FROM " . DB_PREFIX . "product_to_category where 	product_id = '".(int)$productid."'"; 
		
		  $query = $this->db->query($sql);
		  
		  return $query->rows;  
		}
			public function getVendorOrderProducts($order_id) {
		$query = $this->db->query("SELECT * FROM " . DB_PREFIX . "purpletree_vendor_orders WHERE order_id = '" . (int)$order_id . "'");
		
		return $query->rows;
	}
			public function getMatrixShippingCharge($address,$totalweight,$seller_id){

			 $sql = "SELECT * FROM " . DB_PREFIX . "purpletree_vendor_shipping pvss WHERE pvss.seller_id =".$seller_id." AND pvss.shipping_country = '".$address['shipping_country_id']."'";
			 if(!is_numeric($address['shipping_postcode'])) {
			 $sql .= " AND pvss.zipcode_from = '".$address['shipping_postcode']."' AND pvss.zipcode_to = '".$address['shipping_postcode']."'";
			 }
			 $shippingqery = $this->db->query($sql)->rows;
			if(!empty($shippingqery)) {
				$shipprice = array();
				foreach($shippingqery as $shipp) {
					if($totalweight >= $shipp['weight_from'] && $totalweight <= $shipp['weight_to']) {
						 if(is_numeric($address['shipping_postcode'])) {
							 if($address['shipping_postcode'] >= $shipp['zipcode_from'] && $address['shipping_postcode'] <= $shipp['zipcode_to']) {
								$shipprice[] = $shipp['shipping_price'];
							 }
						 } else {
							$shipprice[] = $shipp['shipping_price'];
						 }
					}
				}

				if(!empty($shipprice)) {
					return max($shipprice);
				}
					
			}
		}
	public function getoptionsweight($product){
		$productsql = "SELECT weight,weight_class_id FROM ".DB_PREFIX."product WHERE product_id =".$product['product_id']."";
				$productquery = $this->db->query($productsql)->row;
				$totweight = $productquery['weight'];
			if(!empty($product['option'])) {
				foreach($product['option'] as $productsoptin) {
					//echo "c";
					$productsql1 = "SELECT pov.weight,pov.weight_prefix,p.weight_class_id FROM ".DB_PREFIX."product p JOIN ". DB_PREFIX ."product_option_value pov ON(pov.product_id = p.product_id) WHERE pov.product_option_value_id = '".$productsoptin['product_option_value_id']."' AND pov.product_option_id = '".$productsoptin['product_option_id']."' AND pov.product_id = '".$product['product_id']."' AND pov.option_id = '".$productsoptin['option_id']."' AND pov.option_value_id = '".$productsoptin['option_value_id']."'";
					$productquery1 = $this->db->query($productsql1)->row;
					if(!empty($productquery1)){
						if ($productquery1['weight_prefix'] == '+') {
							$totweight += $totweight+($productquery1['weight'] * $product['quantity']);	
						} elseif ($product_option_value_info['weight_prefix'] == '-') {
							$totweight -= $totweight-($productquery1['weight'] * $product['quantity']);
						}
					}
				}
			} else {
					$totweight = $totweight * $product['quantity'];
			}
		$totalweight = $this->weight->convert($totweight, $productquery['weight_class_id'], $this->config->get('config_weight_class_id'));
		return $totalweight;
	}			
	public function getsellershipping($seller_shipping,$product,$address) {

		if($seller_shipping['seller_id'] == '0'){
	
				$shipping_purpletree_shipping_type = (null !== $this->config->get('shipping_purpletree_shipping_type'))? $this->config->get('shipping_purpletree_shipping_type') : 'pts_flat_rate_shipping';
			$shipping_purpletree_shipping_order_type = (null !== $this->config->get('shipping_purpletree_shipping_order_type'))? $this->config->get('shipping_purpletree_shipping_order_type') : 'pts_product_wise';
			$shipping_purpletree_shipping_charge = (null !== $this->config->get('shipping_purpletree_shipping_charge'))? $this->config->get('shipping_purpletree_shipping_charge') : '0';

		} else {
		$shipping_purpletree_shipping_type 			= $seller_shipping['store_shipping_type'] != '' ? $seller_shipping['store_shipping_type'] : 'pts_flat_rate_shipping';
		$shipping_purpletree_shipping_order_type 	= $seller_shipping['store_shipping_order_type'] != '' ? $seller_shipping['store_shipping_order_type'] : 'pts_product_wise';
		$shipping_purpletree_shipping_charge 		= $seller_shipping['store_shipping_charge'] != '' ? $seller_shipping['store_shipping_charge'] : '0';
		}
		$total = 0;
		$totalweight = $this->getoptionsweight($product);
		$getMatrixShippingCharge = $this->getMatrixShippingCharge($address,$totalweight,$seller_shipping['seller_id']);
		// if Matric shipping
		
		if($shipping_purpletree_shipping_type == 'pts_matrix_shipping'){
			if($address['shipping_postcode'] != '') {
				if($shipping_purpletree_shipping_order_type == 'pts_product_wise'){
					if($getMatrixShippingCharge) {
						$total = $getMatrixShippingCharge;
					}
				} 
			}					
		} // if Matric shipping
		// if Flexible shipping
		elseif($shipping_purpletree_shipping_type  == 'pts_flexible_shipping'){
			if($address['shipping_postcode'] != '') {
				if($shipping_purpletree_shipping_order_type == 'pts_product_wise'){
					if($getMatrixShippingCharge) {
						 $total = $getMatrixShippingCharge;
					} else {
						 $total = $shipping_purpletree_shipping_charge;
					}
				}
			} else {
				if($shipping_purpletree_shipping_order_type == 'pts_product_wise'){
					 $total = $shipping_purpletree_shipping_charge;
				}
			}
		} // if Flexible shipping
		// if Flat Rate shipping
			else {
			if($shipping_purpletree_shipping_order_type == 'pts_product_wise'){
				 $total = $shipping_purpletree_shipping_charge;
			}
		}
		
		// if Flat Rate shipping
		return $total;	
	}
	public function getsellershipping1($seller_shipping,$product,$address) {
		if($seller_shipping['seller_id'] == '0'){
			$shipping_purpletree_shipping_type = (null !== $this->config->get('shipping_purpletree_shipping_type'))? $this->config->get('shipping_purpletree_shipping_type') : 'pts_flat_rate_shipping';
			$shipping_purpletree_shipping_order_type = (null !== $this->config->get('shipping_purpletree_shipping_order_type'))? $this->config->get('shipping_purpletree_shipping_order_type') : 'pts_product_wise';
			$shipping_purpletree_shipping_charge = (null !== $this->config->get('shipping_purpletree_shipping_charge'))? $this->config->get('shipping_purpletree_shipping_charge') : '0';

		} else {
		$shipping_purpletree_shipping_type 			= $seller_shipping['store_shipping_type'] != '' ? $seller_shipping['store_shipping_type'] : 'pts_flat_rate_shipping';
		$shipping_purpletree_shipping_order_type 	= $seller_shipping['store_shipping_order_type'] != '' ? $seller_shipping['store_shipping_order_type'] : 'pts_product_wise';
		$shipping_purpletree_shipping_charge 		= $seller_shipping['store_shipping_charge'] != '' ? $seller_shipping['store_shipping_charge'] : '0';
		}
		$weightt = 0;
		// if Matric shipping
		if($shipping_purpletree_shipping_type == 'pts_matrix_shipping'){
			if($address['shipping_postcode'] != '') {
				if($shipping_purpletree_shipping_order_type == 'pts_order_wise'){
					 $weightt = $this->getoptionsweight($product);;
				}
			}					
		}// if Matric shipping
		// if Flexible shipping
		elseif($shipping_purpletree_shipping_type  == 'pts_flexible_shipping'){
			if($address['shipping_postcode'] != '') {
				if($shipping_purpletree_shipping_order_type == 'pts_order_wise'){
					  $weightt = $this->getoptionsweight($product);;
				}
			} else {
				if($shipping_purpletree_shipping_order_type == 'pts_order_wise'){
				 $weightt = $this->getoptionsweight($product);;
				}
			}
		} // if Flexible shipping
		// if Flat Rate shipping
			else {
			if($shipping_purpletree_shipping_order_type == 'pts_order_wise'){
				 
				  $weightt = $this->getoptionsweight($product);
			}
		}
		
		// if Flat Rate shipping
		return $weightt;	
	}
	]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[if (isset($data['products'])) {]]></search>
			<add position="after"><![CDATA[
			$store_shipping_type = array();
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[$order_product_id = $this->db->getLastId();]]></search>
			<add position="after"><![CDATA[
		 /*** insert into seller orders ****/
			if ($this->config->get('module_purpletree_multivendor_status')) {	
					
					$seller_id = $this->db->query("SELECT pvp.seller_id, pvs.store_shipping_charge,pvs.store_shipping_order_type,pvs.store_shipping_type,pvs.store_commission, p.tax_class_id FROM " . DB_PREFIX . "purpletree_vendor_products pvp JOIN " . DB_PREFIX . "purpletree_vendor_stores pvs ON(pvs.seller_id=pvp.seller_id) JOIN " . DB_PREFIX . "product p ON(p.product_id=pvp.product_id) WHERE pvp.product_id='".(int)$product['product_id']."' AND pvp.is_approved=1")->row;
					if($this->config->get('module_purpletree_multivendor_seller_product_template')){
					if(empty($seller_id['seller_id'])) {
						$sseller_id = $product['seller_id'];
						$seller_id = $this->db->query("SELECT pvs.seller_id, pvs.store_shipping_charge,pvs.store_shipping_order_type,pvs.store_shipping_type,pvs.store_commission, p.tax_class_id FROM " . DB_PREFIX . "purpletree_vendor_template_products pvtp JOIN " . DB_PREFIX . "purpletree_vendor_stores pvs ON(pvs.seller_id=pvtp.seller_id) JOIN " . DB_PREFIX . "purpletree_vendor_template pvt ON(pvt.id=pvtp.template_id) JOIN " . DB_PREFIX . "product p ON(p.product_id=pvt.product_id) WHERE pvt.product_id='".(int)$product['product_id']."' AND pvs.seller_id=".$sseller_id."")->row;
					}
					}
					if(!empty($seller_id['seller_id'])) {
						
						$this->db->query("INSERT INTO " . DB_PREFIX . "purpletree_vendor_orders SET order_id ='".(int)$order_id."', seller_id = '".(int)$seller_id['seller_id']."', product_id ='".(int)$product['product_id']."', shipping = '".(float)$seller_id['store_shipping_charge']."', quantity = '" . (int)$product['quantity'] . "', unit_price = '" . (float)$product['price'] . "', total_price = '" . (float)$product['total'] . "', created_at =NOW(), updated_at = NOW()");
						
						
						$this->db->query("INSERT INTO " . DB_PREFIX . "purpletree_vendor_commissions SET order_id = '" . (int)$order_id . "', product_id ='".(int)$product['product_id']."', seller_id = '" . (int)$seller_id['seller_id'] . "', commission_shipping = '0', commission_fixed = '0', commission_percent = '0', commission = '0', status = 'Pending', created_at = NOW(), updated_at = NOW()");
						
						if(!isset($seller_sub_total[$seller_id['seller_id']])){
						$seller_sub_total[$seller_id['seller_id']] = $product['total'];
						} else {
							$seller_sub_total[$seller_id['seller_id']] += $product['total'];
						}
						
						if(!isset($seller_final_total[$seller_id['seller_id']])){
							$seller_final_total[$seller_id['seller_id']] = $this->tax->calculate($product['price'], $seller_id['tax_class_id'], $this->config->get('config_tax')) * $product['quantity'];
						} else {
							$seller_final_total[$seller_id['seller_id']] += $this->tax->calculate($product['price'], $seller_id['tax_class_id'], $this->config->get('config_tax')) * $product['quantity'];
						}
						
						$tax_rates = $this->tax->getRates($product['price'], $seller_id['tax_class_id']);
			
						foreach ($tax_rates as $tax_rate) {
							if (!isset($seller_tax_data[$seller_id['seller_id']][$tax_rate['tax_rate_id']])) {
								$seller_tax_data[$seller_id['seller_id']][$tax_rate['tax_rate_id']] = ($tax_rate['amount'] * $product['quantity']);
							} else {
								$seller_tax_data[$seller_id['seller_id']][$tax_rate['tax_rate_id']] += ($tax_rate['amount'] * $product['quantity']);
							}
						}
				$shipping_purpletree_shipping_order_type 			= $seller_id['store_shipping_order_type'] != '' ? $seller_id['store_shipping_order_type']:'pts_product_wise' ;
				$shipping_purpletree_shipping_type 			= $seller_id['store_shipping_type'] != '' ? $seller_id['store_shipping_type']:'pts_flat_rate_shipping' ;
				$shipping_purpletree_shipping_charge 		= $seller_id['store_shipping_charge'] != '' ? $seller_id['store_shipping_charge'] : '0';
						$getsellershipping = $this->getsellershipping($seller_id,$product,$data);
						$getsellershipping1 = $this->getsellershipping1($seller_id,$product,$data);
						if(!isset($seller_shipping[$seller_id['seller_id']])){
							$seller_shipping[$seller_id['seller_id']] = $getsellershipping;
							$seller_shipping1[$seller_id['seller_id']] = $getsellershipping1;
						} else {
							$seller_shipping[$seller_id['seller_id']] += $getsellershipping;
							$seller_shipping1[$seller_id['seller_id']] += $getsellershipping1;
						}
					} else {
						$seller_id = array();
						$seller_id['seller_id'] = 0;
						$getsellershipping = $this->getsellershipping($seller_id,$product,$data);
						$getsellershipping1 = $this->getsellershipping1($seller_id,$product,$data);
						if(!isset($seller_shipping[$seller_id['seller_id']])){
							$seller_shipping[$seller_id['seller_id']] = $getsellershipping;
							$seller_shipping1[$seller_id['seller_id']] = $getsellershipping1;
						} else {
							$seller_shipping[$seller_id['seller_id']] += $getsellershipping;
							$seller_shipping1[$seller_id['seller_id']] += $getsellershipping1;
						}
				$shipping_purpletree_shipping_order_type = (null !== $this->config->get('shipping_purpletree_shipping_order_type'))? $this->config->get('shipping_purpletree_shipping_order_type') : 'pts_product_wise';
				$shipping_purpletree_shipping_type = (null !== $this->config->get('shipping_purpletree_shipping_type'))? $this->config->get('shipping_purpletree_shipping_type') : 'pts_flat_rate_shipping';
				$shipping_purpletree_shipping_charge = (null !== $this->config->get('shipping_purpletree_shipping_charge'))? $this->config->get('shipping_purpletree_shipping_charge') : '0';
					} 
				$store_shipping_type[$seller_id['seller_id']] = $shipping_purpletree_shipping_type;
				$store_shipping_charge[$seller_id['seller_id']] = $shipping_purpletree_shipping_charge;
				$store_shipping_order_type[$seller_id['seller_id']] = $shipping_purpletree_shipping_order_type;
				}
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[if (isset($data['vouchers'])) {]]></search>
			<add position="before"><![CDATA[
					if(!empty($seller_shipping1)) {
			foreach($seller_shipping1 as $sellerid => $totalweight) {
				if($store_shipping_order_type[$sellerid] == 'pts_order_wise')  {
					$getMatrixShippingCharge1 = $this->getMatrixShippingCharge($data,$totalweight,$sellerid);
					if($store_shipping_type[$sellerid] == 'pts_matrix_shipping') {
						if($data['shipping_postcode'] != '') {
							if($getMatrixShippingCharge1) {
								$seller_shipping[$sellerid] += $getMatrixShippingCharge1;
							}
						} 
					} elseif($store_shipping_type[$sellerid] == 'pts_flexible_shipping') {
						if($getMatrixShippingCharge1) {
							$seller_shipping[$sellerid] += $getMatrixShippingCharge1;
						} else {
							$seller_shipping[$sellerid] += $store_shipping_charge[$sellerid];
						}
					} elseif($store_shipping_type[$sellerid] == 'pts_flat_rate_shipping') {
							$seller_shipping[$sellerid] += $store_shipping_charge[$sellerid];
					}
				}
			}
		}
					$this->load->language('extension/total/total');
			/**************************************** For seller tax*******************************/
		if(! empty($seller_tax_data))
		{
			foreach($seller_tax_data as $key=>$value){
				foreach ($value as $key1 => $value1) {
					if ($value1 > 0) {
						$tax_detail[$key][] = array(
							'code'       => 'tax',
							'title'      => $this->tax->getRateName($key1),
							'value'      => $value1,
							'sort_order' => $this->config->get('total_tax_sort_order')
						);
						if(!isset($seller_total_tax[$key])){
							$seller_total_tax[$key] = $value1;
						} else {
							$seller_total_tax[$key] +=$value1 ;
						}
					}
				}
			} 
			}
			/**************************************** For seller shipping*******************************/
			$this->load->language('account/ptsregister');
			if($this->config->get('shipping_purpletree_shipping_status')){
			if($data['shipping_code'] == 'purpletree_shipping.purpletree_shipping') {
				foreach($seller_shipping as $key=>$value) {
					if ($value > 0) {
						$shippingtitle = $this->language->get('text_seller_shipping_total');
						if($key == 0) {
						$shippingtitle = $this->language->get('text_admin_shipping_total');
						}
						$tax_detail[$key][] = array(
							'code'       => 'seller_shipping',
							'title'      => $shippingtitle,
							'value'      => $value,
							'sort_order' => '2'
						);
					}
				}	
			}
			}
		
			/**************************************** For seller total*******************************/
			
			foreach($seller_final_total as $key=>$value) {
				if(!isset($seller_total_tax[$key])){
					$seller_total_tax[$key]=0;
				}
				if(!$this->config->get('shipping_purpletree_shipping_status')){
						$seller_shipping[$key]=0;
				}
				//echo $data['shipping_code'];
				if($data['shipping_code'] != 'purpletree_shipping.purpletree_shipping') {
						$seller_shipping[$key]=0;
				}
				if ($value > 0) { 
					$tax_detail[$key][] = array(
						'code'       => 'total',
						'title'      => $this->language->get('text_total'),
						'value'      => max(0, ($seller_sub_total[$key]+$seller_total_tax[$key]+$seller_shipping[$key])),
						'sort_order' => $this->config->get('total_total_sort_order')
					);
				}
			}
				
			/**************************************** For seller sub-total*******************************/
			foreach($seller_sub_total as $key=>$value) {
				if ($value > 0) {
					$tax_detail[$key][] = array(
						'code'       => 'sub_total',
						'title'      => $this->language->get('text_sub_total'),
						'value'      => $value,
						'sort_order' => $this->config->get('sub_total_sort_order')
					);
				}
			}
			//echo "<pre>";
			//print_r($tax_detail);
		if (isset($tax_detail)) {
			foreach ($tax_detail as $key=>$value) {
				foreach($value as $data_1){
					$this->db->query("INSERT INTO " . DB_PREFIX . "purpletree_order_total SET order_id = '" . (int)$order_id . "', seller_id = '".(int)$key."', code = '" . $this->db->escape($data_1['code']) . "', title = '" . $this->db->escape($data_1['title']) . "', `value` = '" . (float)$data_1['value'] . "', sort_order = '" . (int)$data_1['sort_order'] . "'");
				}
			}
		}
			]]></add>
		</operation>
	</file>
	<file path="catalog/controller/checkout/confirm.php">
	 <operation error="skip">
			<search><![CDATA[$order_data['products'][] = array(]]></search>
			<add position="before"><![CDATA[$seller_id = $this->cart->getvendorcart($product['cart_id']);]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA['reward'     => $product['reward']]]></search>
			<add position="replace"><![CDATA['reward'     => $product['reward'],]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA['reward'     => $product['reward'],]]></search>
			<add position="after"><![CDATA['seller_id'  => $seller_id]]></add>
		</operation>
	</file>
	<file path="catalog/model/checkout/order.php">
		<operation error="skip">
			<search><![CDATA[public function addOrder($data) {]]></search>
			<add position="after"><![CDATA[
			$total = 0;	
			$seller_sub_total = array();
			$seller_final_total = array();
			$seller_tax_data = array();
			$seller_total_tax = array();
			$tax_data = array();
			$seller = array();
			$seller_shipping = array();
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[public function editOrder($order_id, $data) {]]></search>
			<add position="after"><![CDATA[
			$total = 0;	
			$seller_sub_total = array();
			$seller_final_total = array();
			$seller_tax_data = array();
			$seller_total_tax = array();
			$tax_data = array();
			$seller = array();
			$seller_shipping = array();
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[$this->db->query("DELETE FROM " . DB_PREFIX . "order_option WHERE order_id = '" . (int)$order_id . "'");]]></search>
			<add position="after"><![CDATA[
			$this->db->query("DELETE FROM " . DB_PREFIX . "purpletree_vendor_orders WHERE order_id = '" . (int)$order_id . "'");
			$this->db->query("DELETE FROM " . DB_PREFIX . "purpletree_vendor_commissions WHERE order_id = '" . (int)$order_id . "'");
			]]></add>
		</operation>
				<operation error="skip">
			<search><![CDATA[$this->db->query("DELETE FROM " . DB_PREFIX . "order_voucher WHERE order_id = '" . (int)$order_id . "'");]]></search>
			<add position="after"><![CDATA[
			$this->db->query("DELETE FROM " . DB_PREFIX . "purpletree_order_total WHERE order_id = '" . (int)$order_id . "'");
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[public function addOrder($data) {]]></search>
			<add position="before"><![CDATA[
			public function getProductCategory($productid){
		
		$sql = "SELECT category_id FROM " . DB_PREFIX . "product_to_category where 	product_id = '".(int)$productid."'"; 
		
		  $query = $this->db->query($sql);
		  
		  return $query->rows;  
		}
		public function getTemplateId($product_id) {
			$query = $this->db->query("SELECT pvt.id as id FROM " . DB_PREFIX . "purpletree_vendor_template pvt  WHERE pvt.product_id ='". (int)$product_id ."'");
			 if($query->num_rows){		
				return $query->row['id'];
			 }else{
				 return null;
			 }
		
	}
			public function getVendorOrderProducts($order_id) {
		$query = $this->db->query("SELECT * FROM " . DB_PREFIX . "purpletree_vendor_orders WHERE order_id = '" . (int)$order_id . "'");
		
		return $query->rows;
	}
			public function getMatrixShippingCharge($address,$totalweight,$seller_id){

			 $sql = "SELECT * FROM " . DB_PREFIX . "purpletree_vendor_shipping pvss WHERE pvss.seller_id =".$seller_id." AND pvss.shipping_country = '".$address['shipping_country_id']."'";
			 if(!is_numeric($address['shipping_postcode'])) {
			 $sql .= " AND pvss.zipcode_from = '".$address['shipping_postcode']."' AND pvss.zipcode_to = '".$address['shipping_postcode']."'";
			 }
			 $shippingqery = $this->db->query($sql)->rows;
			if(!empty($shippingqery)) {
				$shipprice = array();
				foreach($shippingqery as $shipp) {
					if($totalweight >= $shipp['weight_from'] && $totalweight <= $shipp['weight_to']) {
						 if(is_numeric($address['shipping_postcode'])) {
							 if($address['shipping_postcode'] >= $shipp['zipcode_from'] && $address['shipping_postcode'] <= $shipp['zipcode_to']) {
								$shipprice[] = $shipp['shipping_price'];
							 }
						 } else {
							$shipprice[] = $shipp['shipping_price'];
						 }
					}
				}

				if(!empty($shipprice)) {
					return max($shipprice);
				}
					
			}
		}
	public function getoptionsweight($product){
		$productsql = "SELECT weight,weight_class_id FROM ".DB_PREFIX."product WHERE product_id =".$product['product_id']."";
				$productquery = $this->db->query($productsql)->row;
				$totweight = $productquery['weight'];
			if(!empty($product['option'])) {
				foreach($product['option'] as $productsoptin) {
					//echo "c";
					$productsql1 = "SELECT pov.weight,pov.weight_prefix,p.weight_class_id FROM ".DB_PREFIX."product p JOIN ". DB_PREFIX ."product_option_value pov ON(pov.product_id = p.product_id) WHERE pov.product_option_value_id = '".$productsoptin['product_option_value_id']."' AND pov.product_option_id = '".$productsoptin['product_option_id']."' AND pov.product_id = '".$product['product_id']."' AND pov.option_id = '".$productsoptin['option_id']."' AND pov.option_value_id = '".$productsoptin['option_value_id']."'";
					$productquery1 = $this->db->query($productsql1)->row;
					if(!empty($productquery1)){
						if ($productquery1['weight_prefix'] == '+') {
							$totweight += $totweight+($productquery1['weight'] * $product['quantity']);	
						} elseif ($product_option_value_info['weight_prefix'] == '-') {
							$totweight -= $totweight-($productquery1['weight'] * $product['quantity']);
						}
					}
				}
			} else {
					$totweight = $totweight * $product['quantity'];
			}
		$totalweight = $this->weight->convert($totweight, $productquery['weight_class_id'], $this->config->get('config_weight_class_id'));
		return $totalweight;
	}			
	public function getsellershipping($seller_shipping,$product,$address) {

		if($seller_shipping['seller_id'] == '0'){
	
				$shipping_purpletree_shipping_type = (null !== $this->config->get('shipping_purpletree_shipping_type'))? $this->config->get('shipping_purpletree_shipping_type') : 'pts_flat_rate_shipping';
			$shipping_purpletree_shipping_order_type = (null !== $this->config->get('shipping_purpletree_shipping_order_type'))? $this->config->get('shipping_purpletree_shipping_order_type') : 'pts_product_wise';
			$shipping_purpletree_shipping_charge = (null !== $this->config->get('shipping_purpletree_shipping_charge'))? $this->config->get('shipping_purpletree_shipping_charge') : '0';

		} else {
		$shipping_purpletree_shipping_type 			= $seller_shipping['store_shipping_type'] != '' ? $seller_shipping['store_shipping_type'] : 'pts_flat_rate_shipping';
		$shipping_purpletree_shipping_order_type 	= $seller_shipping['store_shipping_order_type'] != '' ? $seller_shipping['store_shipping_order_type'] : 'pts_product_wise';
		$shipping_purpletree_shipping_charge 		= $seller_shipping['store_shipping_charge'] != '' ? $seller_shipping['store_shipping_charge'] : '0';
		}
		$total = 0;
		$totalweight = $this->getoptionsweight($product);
		$getMatrixShippingCharge = $this->getMatrixShippingCharge($address,$totalweight,$seller_shipping['seller_id']);
		// if Matric shipping
		
		if($shipping_purpletree_shipping_type == 'pts_matrix_shipping'){
			if($address['shipping_postcode'] != '') {
				if($shipping_purpletree_shipping_order_type == 'pts_product_wise'){
					if($getMatrixShippingCharge) {
						$total = $getMatrixShippingCharge;
					}
				} 
			}					
		} // if Matric shipping
		// if Flexible shipping
		elseif($shipping_purpletree_shipping_type  == 'pts_flexible_shipping'){
			if($address['shipping_postcode'] != '') {
				if($shipping_purpletree_shipping_order_type == 'pts_product_wise'){
					if($getMatrixShippingCharge) {
						 $total = $getMatrixShippingCharge;
					} else {
						 $total = $shipping_purpletree_shipping_charge;
					}
				}
			} else {
				if($shipping_purpletree_shipping_order_type == 'pts_product_wise'){
					 $total = $shipping_purpletree_shipping_charge;
				}
			}
		} // if Flexible shipping
		// if Flat Rate shipping
			else {
			if($shipping_purpletree_shipping_order_type == 'pts_product_wise'){
				 $total = $shipping_purpletree_shipping_charge;
			}
		}
		
		// if Flat Rate shipping
		return $total;	
	}
	public function getsellershipping1($seller_shipping,$product,$address) {
		if($seller_shipping['seller_id'] == '0'){
			$shipping_purpletree_shipping_type = (null !== $this->config->get('shipping_purpletree_shipping_type'))? $this->config->get('shipping_purpletree_shipping_type') : 'pts_flat_rate_shipping';
			$shipping_purpletree_shipping_order_type = (null !== $this->config->get('shipping_purpletree_shipping_order_type'))? $this->config->get('shipping_purpletree_shipping_order_type') : 'pts_product_wise';
			$shipping_purpletree_shipping_charge = (null !== $this->config->get('shipping_purpletree_shipping_charge'))? $this->config->get('shipping_purpletree_shipping_charge') : '0';

		} else {
		$shipping_purpletree_shipping_type 			= $seller_shipping['store_shipping_type'] != '' ? $seller_shipping['store_shipping_type'] : 'pts_flat_rate_shipping';
		$shipping_purpletree_shipping_order_type 	= $seller_shipping['store_shipping_order_type'] != '' ? $seller_shipping['store_shipping_order_type'] : 'pts_product_wise';
		$shipping_purpletree_shipping_charge 		= $seller_shipping['store_shipping_charge'] != '' ? $seller_shipping['store_shipping_charge'] : '0';
		}
		$weightt = 0;
		// if Matric shipping
		if($shipping_purpletree_shipping_type == 'pts_matrix_shipping'){
			if($address['shipping_postcode'] != '') {
				if($shipping_purpletree_shipping_order_type == 'pts_order_wise'){
					 $weightt = $this->getoptionsweight($product);;
				}
			}					
		}// if Matric shipping
		// if Flexible shipping
		elseif($shipping_purpletree_shipping_type  == 'pts_flexible_shipping'){
			if($address['shipping_postcode'] != '') {
				if($shipping_purpletree_shipping_order_type == 'pts_order_wise'){
					  $weightt = $this->getoptionsweight($product);;
				}
			} else {
				if($shipping_purpletree_shipping_order_type == 'pts_order_wise'){
				 $weightt = $this->getoptionsweight($product);;
				}
			}
		} // if Flexible shipping
		// if Flat Rate shipping
			else {
			if($shipping_purpletree_shipping_order_type == 'pts_order_wise'){
				 
				  $weightt = $this->getoptionsweight($product);
			}
		}
		
		// if Flat Rate shipping
		return $weightt;	
	}
	]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[if (isset($data['products'])) {]]></search>
			<add position="after"><![CDATA[
			$store_shipping_type = array();
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[$order_product_id = $this->db->getLastId();]]></search>
			<add position="after"><![CDATA[
		 /*** insert into seller orders ****/
			if ($this->config->get('module_purpletree_multivendor_status')) {	
					
					$seller_id = $this->db->query("SELECT pvp.seller_id, pvs.store_shipping_charge,pvs.store_shipping_order_type,pvs.store_shipping_type,pvs.store_commission, p.tax_class_id FROM " . DB_PREFIX . "purpletree_vendor_products pvp JOIN " . DB_PREFIX . "purpletree_vendor_stores pvs ON(pvs.seller_id=pvp.seller_id) JOIN " . DB_PREFIX . "product p ON(p.product_id=pvp.product_id) WHERE pvp.product_id='".(int)$product['product_id']."' AND pvp.is_approved=1")->row;
					if($this->config->get('module_purpletree_multivendor_seller_product_template')){
					if(empty($seller_id['seller_id'])) {
						$sseller_id = $product['seller_id'];
						$seller_id = $this->db->query("SELECT pvs.seller_id, pvs.store_shipping_charge,pvs.store_shipping_order_type,pvs.store_shipping_type,pvs.store_commission, p.tax_class_id FROM " . DB_PREFIX . "purpletree_vendor_template_products pvtp JOIN " . DB_PREFIX . "purpletree_vendor_stores pvs ON(pvs.seller_id=pvtp.seller_id) JOIN " . DB_PREFIX . "purpletree_vendor_template pvt ON(pvt.id=pvtp.template_id) JOIN " . DB_PREFIX . "product p ON(p.product_id=pvt.product_id) WHERE pvt.product_id='".(int)$product['product_id']."' AND pvs.seller_id='".$sseller_id."'")->row;
					}
					}
					if(!empty($seller_id['seller_id'])) {
						
						$this->db->query("INSERT INTO " . DB_PREFIX . "purpletree_vendor_orders SET order_id ='".(int)$order_id."', seller_id = '".(int)$seller_id['seller_id']."', product_id ='".(int)$product['product_id']."', shipping = '".(float)$seller_id['store_shipping_charge']."', quantity = '" . (int)$product['quantity'] . "', unit_price = '" . (float)$product['price'] . "', total_price = '" . (float)$product['total'] . "', created_at =NOW(), updated_at = NOW()");
						
						
						$this->db->query("INSERT INTO " . DB_PREFIX . "purpletree_vendor_commissions SET order_id = '" . (int)$order_id . "', product_id ='".(int)$product['product_id']."', seller_id = '" . (int)$seller_id['seller_id'] . "', commission_shipping = '0', commission_fixed = '0', commission_percent = '0', commission = '0', status = 'Pending', created_at = NOW(), updated_at = NOW()");
						
						if(!isset($seller_sub_total[$seller_id['seller_id']])){
						$seller_sub_total[$seller_id['seller_id']] = $product['total'];
						} else {
							$seller_sub_total[$seller_id['seller_id']] += $product['total'];
						}
						
						if(!isset($seller_final_total[$seller_id['seller_id']])){
							$seller_final_total[$seller_id['seller_id']] = $this->tax->calculate($product['price'], $seller_id['tax_class_id'], $this->config->get('config_tax')) * $product['quantity'];
						} else {
							$seller_final_total[$seller_id['seller_id']] += $this->tax->calculate($product['price'], $seller_id['tax_class_id'], $this->config->get('config_tax')) * $product['quantity'];
						}
						
						$tax_rates = $this->tax->getRates($product['price'], $seller_id['tax_class_id']);
			
						foreach ($tax_rates as $tax_rate) {
							if (!isset($seller_tax_data[$seller_id['seller_id']][$tax_rate['tax_rate_id']])) {
								$seller_tax_data[$seller_id['seller_id']][$tax_rate['tax_rate_id']] = ($tax_rate['amount'] * $product['quantity']);
							} else {
								$seller_tax_data[$seller_id['seller_id']][$tax_rate['tax_rate_id']] += ($tax_rate['amount'] * $product['quantity']);
							}
						}
				$shipping_purpletree_shipping_order_type 			= $seller_id['store_shipping_order_type'] != '' ? $seller_id['store_shipping_order_type']:'pts_product_wise' ;
				$shipping_purpletree_shipping_type 			= $seller_id['store_shipping_type'] != '' ? $seller_id['store_shipping_type']:'pts_flat_rate_shipping' ;
				$shipping_purpletree_shipping_charge 		= $seller_id['store_shipping_charge'] != '' ? $seller_id['store_shipping_charge'] : '0';
						$getsellershipping = $this->getsellershipping($seller_id,$product,$data);
						$getsellershipping1 = $this->getsellershipping1($seller_id,$product,$data);
						if(!isset($seller_shipping[$seller_id['seller_id']])){
							$seller_shipping[$seller_id['seller_id']] = $getsellershipping;
							$seller_shipping1[$seller_id['seller_id']] = $getsellershipping1;
						} else {
							$seller_shipping[$seller_id['seller_id']] += $getsellershipping;
							$seller_shipping1[$seller_id['seller_id']] += $getsellershipping1;
						}
					} else {
						$seller_id = array();
						$seller_id['seller_id'] = 0;
						$getsellershipping = $this->getsellershipping($seller_id,$product,$data);
						$getsellershipping1 = $this->getsellershipping1($seller_id,$product,$data);
						if(!isset($seller_shipping[$seller_id['seller_id']])){
							$seller_shipping[$seller_id['seller_id']] = $getsellershipping;
							$seller_shipping1[$seller_id['seller_id']] = $getsellershipping1;
						} else {
							$seller_shipping[$seller_id['seller_id']] += $getsellershipping;
							$seller_shipping1[$seller_id['seller_id']] += $getsellershipping1;
						}
				$shipping_purpletree_shipping_order_type = (null !== $this->config->get('shipping_purpletree_shipping_order_type'))? $this->config->get('shipping_purpletree_shipping_order_type') : 'pts_product_wise';
				$shipping_purpletree_shipping_type = (null !== $this->config->get('shipping_purpletree_shipping_type'))? $this->config->get('shipping_purpletree_shipping_type') : 'pts_flat_rate_shipping';
				$shipping_purpletree_shipping_charge = (null !== $this->config->get('shipping_purpletree_shipping_charge'))? $this->config->get('shipping_purpletree_shipping_charge') : '0';
					} 
				$store_shipping_type[$seller_id['seller_id']] = $shipping_purpletree_shipping_type;
				$store_shipping_charge[$seller_id['seller_id']] = $shipping_purpletree_shipping_charge;
				$store_shipping_order_type[$seller_id['seller_id']] = $shipping_purpletree_shipping_order_type;
				}
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[if (isset($data['vouchers'])) {]]></search>
			<add position="before"><![CDATA[
					if(!empty($seller_shipping1)) {
			foreach($seller_shipping1 as $sellerid => $totalweight) {
				if($store_shipping_order_type[$sellerid] == 'pts_order_wise')  {
					$getMatrixShippingCharge1 = $this->getMatrixShippingCharge($data,$totalweight,$sellerid);
					if($store_shipping_type[$sellerid] == 'pts_matrix_shipping') {
						if($data['shipping_postcode'] != '') {
							if($getMatrixShippingCharge1) {
								$seller_shipping[$sellerid] += $getMatrixShippingCharge1;
							}
						} 
					} elseif($store_shipping_type[$sellerid] == 'pts_flexible_shipping') {
						if($getMatrixShippingCharge1) {
							$seller_shipping[$sellerid] += $getMatrixShippingCharge1;
						} else {
							$seller_shipping[$sellerid] += $store_shipping_charge[$sellerid];
						}
					} elseif($store_shipping_type[$sellerid] == 'pts_flat_rate_shipping') {
							$seller_shipping[$sellerid] += $store_shipping_charge[$sellerid];
					}
				}
			}
		}
					$this->load->language('extension/total/total');
			/**************************************** For seller tax*******************************/
		if(! empty($seller_tax_data))
		{
			foreach($seller_tax_data as $key=>$value){
				foreach ($value as $key1 => $value1) {
					if ($value1 > 0) {
						$tax_detail[$key][] = array(
							'code'       => 'tax',
							'title'      => $this->tax->getRateName($key1),
							'value'      => $value1,
							'sort_order' => $this->config->get('total_tax_sort_order')
						);
						if(!isset($seller_total_tax[$key])){
							$seller_total_tax[$key] = $value1;
						} else {
							$seller_total_tax[$key] +=$value1 ;
						}
					}
				}
			} 
			}
			/**************************************** For seller shipping*******************************/
			$this->load->language('account/ptsregister');
			if($this->config->get('shipping_purpletree_shipping_status')){
			if($data['shipping_code'] == 'purpletree_shipping.purpletree_shipping') {
				foreach($seller_shipping as $key=>$value) {
					if ($value > 0) {
						$shippingtitle = $this->language->get('text_seller_shipping_total');
						if($key == 0) {
						$shippingtitle = $this->language->get('text_admin_shipping_total');
						}
						$tax_detail[$key][] = array(
							'code'       => 'seller_shipping',
							'title'      => $shippingtitle,
							'value'      => $value,
							'sort_order' => '2'
						);
					}
				}	
			}
			}
		
			/**************************************** For seller total*******************************/
			
			foreach($seller_final_total as $key=>$value) {
				if(!isset($seller_total_tax[$key])){
					$seller_total_tax[$key]=0;
				}
				if(!$this->config->get('shipping_purpletree_shipping_status')){
						$seller_shipping[$key]=0;
				}
				//echo $data['shipping_code'];
				if($data['shipping_code'] != 'purpletree_shipping.purpletree_shipping') {
						$seller_shipping[$key]=0;
				}
				if ($value > 0) { 
					$tax_detail[$key][] = array(
						'code'       => 'total',
						'title'      => $this->language->get('text_total'),
						'value'      => max(0, ($seller_sub_total[$key]+$seller_total_tax[$key]+$seller_shipping[$key])),
						'sort_order' => $this->config->get('total_total_sort_order')
					);
				}
			}
				
			/**************************************** For seller sub-total*******************************/
			foreach($seller_sub_total as $key=>$value) {
				if ($value > 0) {
					$tax_detail[$key][] = array(
						'code'       => 'sub_total',
						'title'      => $this->language->get('text_sub_total'),
						'value'      => $value,
						'sort_order' => $this->config->get('sub_total_sort_order')
					);
				}
			}
			//echo "<pre>";
			//print_r($tax_detail);
		if (isset($tax_detail)) {
			foreach ($tax_detail as $key=>$value) {
				foreach($value as $data_1){
					$this->db->query("INSERT INTO " . DB_PREFIX . "purpletree_order_total SET order_id = '" . (int)$order_id . "', seller_id = '".(int)$key."', code = '" . $this->db->escape($data_1['code']) . "', title = '" . $this->db->escape($data_1['title']) . "', `value` = '" . (float)$data_1['value'] . "', sort_order = '" . (int)$data_1['sort_order'] . "'");
				}
			}
		}
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[$this->db->query("UPDATE `" . DB_PREFIX . "order` SET order_status_id = '" . (int)$order_status_id . "', date_modified = NOW() WHERE order_id = '" . (int)$order_id . "'");]]></search>
			<add position="before"><![CDATA[
			// Update the DB with the new statuses
			/*** update seller order and add order history ***/
			//Commission on Order Status Change
			//Commission on Order Status Change
			$order_products = $this->getVendorOrderProducts($order_id);
				foreach ($order_products as $order_product) {
				if($this->config->get('module_purpletree_multivendor_seller_product_template')){
				    $ppproduct_id = $order_product['product_id'];
					$ssseller_id  = $order_product['seller_id'];
					$productqntity  = $order_product['quantity'];
					$template_idd = $this->getTemplateId($ppproduct_id);
					
					$this->db->query("UPDATE " . DB_PREFIX . "purpletree_vendor_template_products SET quantity = (quantity - " . (int)$productqntity . ") WHERE template_id = '" . (int)$template_idd. "'  AND seller_id = '" . (int)$ssseller_id. "' AND subtract = '1'");
					}
						$dsds1 = "SELECT `seller_id`,`order_status_id` FROM `" . DB_PREFIX . "purpletree_vendor_orders_history` WHERE order_id = '" . (int)$order_id . "' && seller_id = '" . (int)$order_product['seller_id'] . "' order by `id` DESC";
						$query1112 = $this->db->query($dsds1);
						$sdsds11 = $query1112->row;
						if(empty($sdsds11)) {
							$this->db->query("INSERT INTO " . DB_PREFIX . "purpletree_vendor_orders_history SET order_id = '" . (int)$order_id . "', seller_id ='". (int)$order_product['seller_id'] ."', order_status_id = '" . (int)$order_status_id . "', notify = '" . (int)$notify . "', comment = '" . $this->db->escape($comment) . "', created_at = NOW()");
							$ordststid = $order_status_id;
						} else {
							$ordststid = $sdsds11['order_status_id'];
						}
							$this->db->query("UPDATE `" . DB_PREFIX . "purpletree_vendor_orders` SET order_status_id = '" . (int)$ordststid . "', updated_at = NOW() WHERE order_id = '" . (int)$order_id . "' && product_id = '" . (int)$order_product['product_id'] . "'");
			if (null !== $this->config->get('module_purpletree_multivendor_commission_status') && $this->config->get('module_purpletree_multivendor_commission_status') != $order_status_id) {
                    $this->db->query("UPDATE " . DB_PREFIX . "purpletree_vendor_commissions SET commission_shipping = '0', commission_fixed = '0', commission_percent = '0', commission = '0', status = 'Order Cancelled', updated_at = NOW() WHERE order_id = '" . (int)$order_id . "'  AND product_id = '" . (int)$order_product['product_id'] . "'");
                }
			} 
			if (null !== $this->config->get('module_purpletree_multivendor_commission_status') && $this->config->get('module_purpletree_multivendor_commission_status') == $order_status_id) {
				$sellerorders = $this->db->query("SELECT * FROM `" . DB_PREFIX . "purpletree_vendor_orders` WHERE order_id = '" . (int)$order_id . "'");
				
				$shipcommsvirtial = '0';
				$dsdsds = array();
				if(!empty($sellerorders->rows)) {
					foreach($sellerorders->rows as $sellerorder) {
						$sql1111 = "SELECT `store_commission` FROM `" . DB_PREFIX . "purpletree_vendor_stores` WHERE seller_id = '" . (int)$sellerorder['seller_id'] . "'";
						$totalshipingorder = '0';
								$getShippingOrderTotal = $this->db->query("SELECT `value` FROM `" . DB_PREFIX . "purpletree_order_total` WHERE order_id = '" . (int)$order_id . "' AND seller_id = '" . (int)$sellerorder['seller_id'] . "' AND code ='seller_shipping'");
						if($getShippingOrderTotal->num_rows){
							$totalshipingorder = $getShippingOrderTotal->row['value'];
						}
				
						$query = $this->db->query($sql1111);
						$seller_commission = $query->row;
						if($sellerorder['order_status_id'] == $this->config->get('module_purpletree_multivendor_commission_status')) {
							 //category_commission
				        $productid = $sellerorder['product_id'];	
						$catids =$this->getProductCategory($productid );
						$commission_cat = array();
						$catttt = array();
						 $shippingcommision = 0;
							 if($totalshipingorder != 0) {
								 if (null !== $this->config->get('module_purpletree_multivendor_shipping_commission')) {
									 if(!array_key_exists($sellerorder['seller_id'],$dsdsds)) {
									 $shippingcommision = (($this->config->get('module_purpletree_multivendor_shipping_commission')*$totalshipingorder)/100);
									 $dsdsds[$sellerorder['seller_id']] = $shippingcommision;
									 }
								 }
							 }
						if(!empty($catids)){
							foreach($catids as $cat) {
								$sql = "SELECT * FROM " . DB_PREFIX . "purpletree_vendor_categories_commission where category_id = '".(int)$cat['category_id']."'";
								$query = $this->db->query($sql);
								$commission_cat[] = $query->rows;
							}
								
						}
						$commission = -1;
						$commission1 = -1;
						$comipercen = 0;
						$comifixs = 0;
						
						if(!empty($commission_cat)) {
						 foreach($commission_cat as $catts) {
						 foreach($catts as $catt) {
								$comifix = 0;
							 if(isset($catt['commison_fixed']) && $catt['commison_fixed'] != '') {
								$comifix = $catt['commison_fixed'];
							 }
								$comiper = 0;
							 if(isset($catt['commission']) && $catt['commission'] != '') {
								$comiper = $catt['commission'];
							 }
							
							 if (null !== $this->config->get('module_purpletree_multivendor_seller_group') && $this->config->get('module_purpletree_multivendor_seller_group') == 1) {
								$sqlgrop = "Select `customer_group_id` from `" . DB_PREFIX . "customer` where customer_id= ".$sellerorder['seller_id']." ";
								$querygrop = $this->db->query($sqlgrop);
								$sellergrp = $querygrop->row;
								if($catt['seller_group'] == $sellergrp['customer_group_id']) {
									$commipercent = (($comiper*$sellerorder['total_price'])/100);
									$commission1 = $comifix + $commipercent + $shippingcommision;
									if($commission1 > $commission) {
										$comipercen 		= $comiper;
										$comifixs 			= $comifix;
										$shippingcommision 	= $shippingcommision;
										$commission 		= $commission1;
									}
								}
							 } else {
								 $commipercent = (($comiper*$sellerorder['total_price'])/100);
									$commission1 = $comifix + $commipercent + $shippingcommision;
									if($commission1 > $commission) {
										$comipercen 		= $comiper;
										$comifixs 			= $comifix;
										$shippingcommision 	= $shippingcommision;
										$commission 		= $commission1;
									} 
							 }
						   }
						 }
						}
						if($commission != -1) {
							$commission = $commission;
						}
						//category_commission
						elseif(isset($seller_commission['store_commission']) && ($seller_commission['store_commission'] != NULL || $seller_commission['store_commission'] != '')){
							$comipercen = $seller_commission['store_commission'];
							$commission = (($sellerorder['total_price']*$seller_commission['store_commission'])/100)+$shippingcommision;
						} else {
							$comipercen = $this->config->get('module_purpletree_multivendor_commission');
							$commission = (($sellerorder['total_price']*$this->config->get('module_purpletree_multivendor_commission'))/100)+$shippingcommision;
						}
						$this->db->query("UPDATE " . DB_PREFIX . "purpletree_vendor_commissions SET commission_shipping = '".$shippingcommision."', commission_fixed = '".$comifixs."', commission_percent = '".$comipercen."', commission = '" . (float)$commission . "', status = 'Complete', updated_at = NOW() WHERE order_id = '" . (int)$order_id . "' && product_id ='".(int)$sellerorder['product_id']."' && seller_id = '" . (int)$sellerorder['seller_id'] . "'");
						} else {
							$this->db->query("UPDATE " . DB_PREFIX . "purpletree_vendor_commissions SET commission_shipping = '0', commission_fixed = '0', commission_percent = '0',  commission = '0', status = 'Pending', updated_at = NOW() WHERE order_id = '" . (int)$order_id . "' && product_id ='".(int)$sellerorder['product_id']."' && seller_id = '" . (int)$sellerorder['seller_id'] . "'");
						}
					}
				}
			}
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[$this->db->query("DELETE FROM `" . DB_PREFIX . "order` WHERE order_id = '" . (int)$order_id . "'");]]></search>
			<add position="after"><![CDATA[
			/*** Delete seller order tables ***/
			$this->db->query("DELETE FROM `" . DB_PREFIX . "purpletree_vendor_orders` WHERE order_id = '" . (int)$order_id . "'");
			$this->db->query("DELETE FROM `" . DB_PREFIX . "purpletree_vendor_commissions` WHERE order_id = '" . (int)$order_id . "'");
			$this->db->query("DELETE FROM `" . DB_PREFIX . "purpletree_order_total` WHERE order_id = '" . (int)$order_id . "'");
			$this->db->query("DELETE FROM `" . DB_PREFIX . "purpletree_vendor_orders_history` WHERE order_id = '" . (int)$order_id . "'");
			]]></add>
		</operation>
	</file>		
	<file path="catalog/controller/account/register.php">
			<operation error="skip">
		<search><![CDATA[$this->load->language('account/register');]]></search>
					<add position="after"><![CDATA[
					$this->load->language('account/ptsregister');
				]]></add>
			</operation>
			
		<operation error="skip">
			<search><![CDATA[if (isset($this->error['warning'])) {]]></search>
			<add position="before"><![CDATA[
			$data['module_purpletree_multivendor_status'] = $this->config->get('module_purpletree_multivendor_status');
			$data['module_purpletree_multivendor_become_seller'] = $this->config->get('module_purpletree_multivendor_become_seller');
			if ($this->config->get('module_purpletree_multivendor_become_seller')) {
				$data['text_seller'] = $this->language->get('text_seller');
				$data['text_seller_heading'] = $this->language->get('text_seller_heading');
				$data['text_store_name'] = $this->language->get('text_store_name');
			}
			if (isset($this->request->post['become_seller'])) {
			$data['become_seller'] = $this->request->post['become_seller'];
			} else {
				$data['become_seller'] = '';
			}
			$data['checkj3']= '';
		   if (defined('JOURNAL3_ACTIVE')) {
              $data['checkj3'] = 'JOURNAL3';
            }
	
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[unset($this->session->data['guest']);]]></search>
			<add position="after"><![CDATA[
            if ($this->config->get('module_purpletree_multivendor_become_seller')) {
				if($this->request->post['become_seller']=="1"){	$this->response->redirect($this->url->link('extension/account/purpletree_multivendor/sellerregister', '', true));
				}
	        }
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[private function validate() {]]></search>
			<add position="after"><![CDATA[
			$this->load->model('extension/purpletree_multivendor/vendor');
			 if($this->config->get('module_purpletree_multivendor_become_seller')) { 
			if(isset($this->request->post['become_seller']) && ($this->request->post['become_seller'] == 1)) {
			    if(!$this->customer->validateSeller()) {
				$this->load->language('purpletree_multivendor/ptsmultivendor');
				$this->error['warning1'] = $this->language->get('error_license');
			   }
				$data['become_seller'] = $this->request->post['become_seller'];			
		}
		}
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[if (isset($this->error['confirm'])) {]]></search>
			<add position="before"><![CDATA[
			if (isset($this->error['seller_store'])) {
				$data['error_sellerstore'] = $this->error['seller_store'];
			} else {
				$data['error_sellerstore'] = '';
			}
			if (isset($this->error['warning1'])) {
			$data['error_warning1'] = $this->error['warning1'];
			} else {
				$data['error_warning1'] = '';
			}
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[$data['error_warning'] = $this->error['warning'];]]></search>
			<add position="after"><![CDATA[}elseif(isset($this->session->data['error_warning'])){
			$data['error_warning'] = $this->session->data['error_warning'];
			unset($this->session->data['error_warning']);
			]]></add>
		</operation>
	</file>

	<file path="catalog/view/theme/*/template/account/register.twig">
		<operation error="skip">
			<search><![CDATA[{{ captcha }}]]></search>
			<add position="before" offset="0"><![CDATA[
			
	{% if checkj3 == 'JOURNAL3' %}
        {% if not j3.document.isPopup() %}
			{% if module_purpletree_multivendor_status and module_purpletree_multivendor_become_seller %}
				<fieldset>
				<legend>{{ text_seller_heading }}</legend>
					<div class="form-group clearfix">
					<label class="col-sm-2 control-label">{{ text_seller }}</label>
					<div class="col-sm-10">
					<label class="radio-inline">
					 <input type="radio" {% if become_seller == 1 %} checked="checked" {% endif %} name="become_seller"  value="1" id="add_document" /> 
					{{ text_yes }}</label>
					<label class="radio-inline">
				   <input type="radio" name="become_seller" value="0" checked="checked" id="remove_document"/>
					{{ text_no }}</label>
				</div>
				</div>
				</fieldset>
			 {% endif %}
		  {% endif %}		
		{% else %}
		  {% if module_purpletree_multivendor_status and module_purpletree_multivendor_become_seller %}
			<fieldset>
			<legend>{{ text_seller_heading }}</legend>
				<div class="form-group clearfix">
				<label class="col-sm-2 control-label">{{ text_seller }}</label>
				<div class="col-sm-10">
				<label class="radio-inline">
				 <input type="radio" {% if become_seller == 1 %} checked="checked" {% endif %} name="become_seller"  value="1" id="add_document" /> 
                {{ text_yes }}</label>
				<label class="radio-inline">
               <input type="radio" name="become_seller" value="0" checked="checked" id="remove_document"/>
                {{ text_no }}</label>
            </div>
            </div>
			</fieldset>
			{% endif %}
		 {% endif %}
			]]></add>
		</operation>
	</file>
	<file path="catalog/view/theme/*/template/account/register.twig">
		<operation error="skip">
			<search><![CDATA[$captcha;]]></search>
			<add position="before" offset="0"><![CDATA[
			{% if (purpletree_multivendor_status in not empty) and (purpletree_multivendor_become_seller) is not empty %}
			<fieldset>
			<legend>{{ text_seller_heading }}</legend>
				<div class="pts-form-group clearfix">
				<label class="pts-col-sm-2 pts-control-label">{{ text_seller }}</label>
				<div class="pts-col-sm-10">
				<label class="radio-inline">
				 <input type="radio" {% if become_seller == 1 %} checked="checked" {% endif %} name="become_seller"  value="1" id="add_document" /> 
                {{ text_yes }}</label>
				<label class="radio-inline">
               <input type="radio" name="become_seller" value="0" checked="checked" id="remove_document"/>
                {{ text_no }}</label>
            </div>
            </div>
			<div class="pts-form-group clearfix">
				<label class="pts-col-sm-2 pts-control-label">{{ text_store_name }}</label>
				<div class="pts-col-sm-10">
				 <input type="text" name="seller_storename" value="{{ seller_storename }}" class="form-control"  />
				{% if error_sellerstore %}
              <div class="text-danger">{{ error_sellerstore }}</div>
              {% endif %}
            </div>
            </div>
            </div>
			
			</fieldset>
			{% endif %}
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[{{ column_left }}]]></search>
			<add position="before" offset="0"><![CDATA[
			 {% if error_warning1 %}
			  <div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> {{ error_warning1 }}</div>
			  {% endif %}
			]]></add>
		</operation>
	</file>
	<file path="system/library/cart/cart.php">
	<operation error="skip">
			<search><![CDATA[public function getProducts() {]]></search>
			<add position="before"><![CDATA[
					public function checkid($product_id,$seller_id) {
		$sellerprice = $this->db->query("SELECT pvt.product_id FROM " . DB_PREFIX . "purpletree_vendor_template_products pvtp LEFT JOIN " . DB_PREFIX . "purpletree_vendor_template pvt ON (pvt.id = pvtp.template_id) LEFT JOIN " . DB_PREFIX . "product p ON (pvt.product_id = p.product_id) LEFT JOIN " . DB_PREFIX . "purpletree_vendor_stores pvs ON (pvs.seller_id = pvtp.seller_id) WHERE pvt.product_id = '" . (int)$product_id . "' AND pvtp.seller_id='".$seller_id."'");	
		if ($sellerprice->num_rows > 0){
			return $sellerprice->num_rows;
		}
	}
	public function getTemplate($product_id) {
	
		$query = $this->db->query("SELECT pvt.id FROM ". DB_PREFIX . "purpletree_vendor_template pvt WHERE pvt.product_id ='". (int)$product_id ."'");
	if($query->num_rows) {			
			return true;
     }else{
		 return false;
	 }
		
	}
	public function getvendorcart($cart_id) {
		$query = $this->db->query("SELECT seller_id FROM " . DB_PREFIX . "purpletree_vendor_cart WHERE cart_id='".$cart_id."'");
		if($query->num_rows){
			return $query->row['seller_id'];
		}
	}
	public function getSellerPrice($product_id,$seller_id) {
		$sellerprice = $this->db->query("SELECT pvtp.price AS seller_price FROM " . DB_PREFIX . "purpletree_vendor_template_products pvtp LEFT JOIN " . DB_PREFIX . "purpletree_vendor_template pvt ON (pvt.id = pvtp.template_id) LEFT JOIN " . DB_PREFIX . "purpletree_vendor_stores pvs ON (pvs.seller_id = pvtp.seller_id) WHERE pvt.product_id = '" . (int)$product_id . "' AND pvtp.seller_id='".$seller_id."'");		
		if($sellerprice->num_rows){
			return $sellerprice->row['seller_price'];
		}
	}
			]]></add>
		</operation>	
		<operation error="skip">
			<search><![CDATA[$product_data[] = array(]]></search>
			<add position="before"><![CDATA[				if($this->config->get('module_purpletree_multivendor_seller_product_template')){
			  $seller_id = $this->getvendorcart($cart['cart_id']);
				if(!empty($seller_id)) {
					$sellertemplateproduct = $this->checkid($product_query->row['product_id'],$seller_id);
				}
				if(!empty($sellertemplateproduct)) {
						$sellerprices = $this->getSellerPrice($product_query->row['product_id'],$seller_id);
						if(!empty($sellerprices)) {
								$price           = $sellerprices;
						}
					}
				}
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[public function getSubTotal() {]]></search>
			<add position="before"><![CDATA[
			public function addVendorproduct($cart_id, $seller_id) {
				$query = $this->db->query("SELECT COUNT(*) AS total FROM " . DB_PREFIX . "purpletree_vendor_cart WHERE cart_id = '".(int)$cart_id."'");
				if (!$query->row['total']) {
					$this->db->query("INSERT " . DB_PREFIX . "purpletree_vendor_cart SET cart_id = '".(int)$cart_id."',seller_id = '".(int)$seller_id."'");
				}else{
					$this->db->query("UPDATE " . DB_PREFIX . "purpletree_vendor_cart SET seller_id = '".(int)$seller_id."' WHERE cart_id = '".(int)$cart_id."'");
				}
        	}
			/**** get order total when seller shipping is enabled *****/
		public function getMatrixShippingCharge($address,$totalweight,$seller_id,$aa = 'bb'){

			 $sql = "SELECT * FROM " . DB_PREFIX . "purpletree_vendor_shipping pvss WHERE pvss.seller_id =".$seller_id." AND pvss.shipping_country = '".$address['country_id']."'";
			 if(!is_numeric($address['postcode'])) {
			 $sql .= " AND pvss.zipcode_from = '".$address['postcode']."' AND pvss.zipcode_to = '".$address['postcode']."'";
			 }
			 $shippingqery = $this->db->query($sql)->rows;
			if(!empty($shippingqery)) {
				$shipprice = array();
				foreach($shippingqery as $shipp) {
					if($totalweight >= $shipp['weight_from'] && $totalweight <= $shipp['weight_to']) {
						 if(is_numeric($address['postcode'])) {
							 if($address['postcode'] >= $shipp['zipcode_from'] && $address['postcode'] <= $shipp['zipcode_to']) {
								$shipprice[] = $shipp['shipping_price'];
							 }
						 } else {
							$shipprice[] = $shipp['shipping_price'];
						 }
					}
				}

				if(!empty($shipprice)) {
					return max($shipprice);
				}
					
			}
			return '0';
		}
		public function getSellerShippingCharge($address){
		$total = 'a';
		$orderWiseWeightArray 	= array();
		$weight 				= array();
		$store_shipping_type 	= array();
		$store_shipping_charge  = array();
		foreach ($this->getProducts() as $product) {
			$tot = array();
			$seller_shipping = $this->db->query("SELECT pvs.store_shipping_charge,pvs.store_shipping_order_type,pvs.store_shipping_type,pvs.seller_id FROM " . DB_PREFIX . "purpletree_vendor_stores pvs JOIN " . DB_PREFIX. "purpletree_vendor_products pvp ON(pvp.seller_id=pvs.seller_id) WHERE pvp.product_id = '".$product['product_id']."' AND pvp.is_approved=1")->row;
			//echo $seller_shipping['store_shipping_order_type'];
			//Check Seller id
			if(isset($seller_shipping['seller_id'])){
				$shipping_purpletree_shipping_type 			= $seller_shipping['store_shipping_type'] != '' ? $seller_shipping['store_shipping_type']:'pts_flat_rate_shipping' ;
				$shipping_purpletree_shipping_order_type 	= $seller_shipping['store_shipping_order_type'] != '' ? $seller_shipping['store_shipping_order_type']:'pts_product_wise' ;
				$shipping_purpletree_shipping_charge 		= $seller_shipping['store_shipping_charge'] != '' ? $seller_shipping['store_shipping_charge'] : '0';
			} else {
				$seller_shipping['seller_id'] = 0;
				$shipping_purpletree_shipping_type = (null !== $this->config->get('shipping_purpletree_shipping_type'))? $this->config->get('shipping_purpletree_shipping_type') : 'pts_flat_rate_shipping';
				$shipping_purpletree_shipping_order_type = (null !== $this->config->get('shipping_purpletree_shipping_order_type'))? $this->config->get('shipping_purpletree_shipping_order_type') : 'pts_product_wise';
				$shipping_purpletree_shipping_charge = (null !== $this->config->get('shipping_purpletree_shipping_charge'))? $this->config->get('shipping_purpletree_shipping_charge') : '0';
			}
				$store_shipping_type[$seller_shipping['seller_id']] = $shipping_purpletree_shipping_type;
				$store_shipping_charge[$seller_shipping['seller_id']] = $shipping_purpletree_shipping_charge;
				$totalweight = $this->weight->convert($product['weight'], $product['weight_class_id'], $this->config->get('config_weight_class_id'));
				$getMatrixShippingCharge = $this->getMatrixShippingCharge($address,$totalweight,$seller_shipping['seller_id']);
				// if Matric shipping
				if($shipping_purpletree_shipping_type == 'pts_matrix_shipping'){
					if($address['postcode'] != '') {
						if($shipping_purpletree_shipping_order_type == 'pts_order_wise'){
							 $weightt = $this->weight->convert($product['weight'], $product['weight_class_id'], $this->config->get('config_weight_class_id'));
							 //echo $weightt.'--';
							 $weight[$seller_shipping['seller_id']] = $weightt;
							 if(!isset($orderWiseWeightArray[$seller_shipping['seller_id']])){
								$orderWiseWeightArray[$seller_shipping['seller_id']] = $weight[$seller_shipping['seller_id']];
							 } else {
								$orderWiseWeightArray[$seller_shipping['seller_id']] += $weight[$seller_shipping['seller_id']];
							 }
						} else {
						//if($shipping_purpletree_shipping_order_type == 'pts_product_wise'){
							if($getMatrixShippingCharge) {
							if($total == 'a') {
								$total = '0';
							}
								$tot[$seller_shipping['seller_id']] = $getMatrixShippingCharge;
								$total += $tot[$seller_shipping['seller_id']];
							} else {
								//echo "r3";
								return 'a';
							}
						} 
					} else {
						//echo "r4";
						return 'a';
					}					
				}// if Matric shipping
				// if Flexible shipping
				elseif($shipping_purpletree_shipping_type  == 'pts_flexible_shipping'){
					if($address['postcode'] != '') {
						if($shipping_purpletree_shipping_order_type == 'pts_order_wise'){
							  $weightt = $this->weight->convert($product['weight'], $product['weight_class_id'], $this->config->get('config_weight_class_id'));
							 $weight[$seller_shipping['seller_id']] = $weightt;
							 if(!isset($orderWiseWeightArray[$seller_shipping['seller_id']])){
								$orderWiseWeightArray[$seller_shipping['seller_id']] = $weight[$seller_shipping['seller_id']];
							 } else {
								$orderWiseWeightArray[$seller_shipping['seller_id']] += $weight[$seller_shipping['seller_id']];
							 }
						} else {
						//if($shipping_purpletree_shipping_order_type == 'pts_product_wise'){
							if($getMatrixShippingCharge) {
								$tot[$seller_shipping['seller_id']] = $getMatrixShippingCharge;
								if($total == 'a') {
								$total = '0';
							}
								$total += $tot[$seller_shipping['seller_id']];
							} else {
								$tot[$seller_shipping['seller_id']] = $shipping_purpletree_shipping_charge;
								if($total == 'a') {
								$total = '0';
							}
								$total += $tot[$seller_shipping['seller_id']];
							}
						}
					} else {
						if($shipping_purpletree_shipping_order_type == 'pts_order_wise'){
						  $weightt = $this->weight->convert($product['weight'], $product['weight_class_id'], $this->config->get('config_weight_class_id'));
							 $weight[$seller_shipping['seller_id']] = $weightt;
							 if(!isset($orderWiseWeightArray[$seller_shipping['seller_id']])){
								$orderWiseWeightArray[$seller_shipping['seller_id']] = $weight[$seller_shipping['seller_id']];
							 } else {
								$orderWiseWeightArray[$seller_shipping['seller_id']] += $weight[$seller_shipping['seller_id']];
							 }
						} else {
						//if($shipping_purpletree_shipping_order_type == 'pts_product_wise'){
							$tot[$seller_shipping['seller_id']] = $shipping_purpletree_shipping_charge;
							if($total == 'a') {
								$total = '0';
							}
							$total += $tot[$seller_shipping['seller_id']];
						}
					}
				} // if Flexible shipping
				// if Flat Rate shipping
				//elseif($shipping_purpletree_shipping_type  == 'pts_flat_rate_shipping'){
					else {
					if($shipping_purpletree_shipping_order_type == 'pts_order_wise'){
						 $weightt = $this->weight->convert($product['weight'], $product['weight_class_id'], $this->config->get('config_weight_class_id'));
							 $weight[$seller_shipping['seller_id']] = $weightt;
							 if(!isset($orderWiseWeightArray[$seller_shipping['seller_id']])){
								$orderWiseWeightArray[$seller_shipping['seller_id']] = $weight[$seller_shipping['seller_id']];
							 } else {
								$orderWiseWeightArray[$seller_shipping['seller_id']] += $weight[$seller_shipping['seller_id']];
							 }
					} else {
					//if($shipping_purpletree_shipping_order_type == 'pts_product_wise'){
						$tot[$seller_shipping['seller_id']] = $shipping_purpletree_shipping_charge;
						if($total == 'a') {
								$total = '0';
							}
						$total += $tot[$seller_shipping['seller_id']];
					}
				}
				// if Flat Rate shipping
		}
		if(!empty($orderWiseWeightArray)) {
			foreach($orderWiseWeightArray as $sellerid => $totalweight) {
				$getMatrixShippingCharge1 = $this->getMatrixShippingCharge($address,$totalweight,$sellerid);
				if($store_shipping_type[$sellerid] == 'pts_matrix_shipping') {
					if($address['postcode'] != '') {
						if($getMatrixShippingCharge1) {
						if($total == 'a') {
								$total = '0';
							}
							$total += $getMatrixShippingCharge1;
						} else {
							//echo "r5";							
							return 'a';
						}
					} else {
						//echo "r6";
						return 'a';
					}
				} elseif($store_shipping_type[$sellerid] == 'pts_flexible_shipping') {
					if($getMatrixShippingCharge1) {
					if($total == 'a') {
								$total = '0';
							}
						$total += $getMatrixShippingCharge1;
					} else {
					if($total == 'a') {
								$total = '0';
							}
						$total += $store_shipping_charge[$sellerid];
					}
				} elseif($store_shipping_type[$sellerid] == 'pts_flat_rate_shipping') {
				if($total == 'a') {
								$total = '0';
							}
					$total += $store_shipping_charge[$sellerid];
				}
			}
		}
		return $total;
	}
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[$this->db->query("INSERT " . DB_PREFIX . "cart SET api_id = '" . (isset($this->session->data['api_id']) ? (int)$this->session->data['api_id'] : 0) . "', customer_id = '" . (int)$this->customer->getId() . "', session_id = '" . $this->db->escape($this->session->getId()) . "', product_id = '" . (int)$product_id . "', recurring_id = '" . (int)$recurring_id . "', `option` = '" . $this->db->escape(json_encode($option)) . "', quantity = '" . (int)$quantity . "', date_added = NOW()");]]></search>
			<add position="after"><![CDATA[return $this->db->getLastId();]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[$this->db->query("UPDATE " . DB_PREFIX . "cart SET quantity = (quantity + " . (int)$quantity . ") WHERE api_id = '" . (isset($this->session->data['api_id']) ? (int)$this->session->data['api_id'] : 0) . "' AND customer_id = '" . (int)$this->customer->getId() . "' AND session_id = '" . $this->db->escape($this->session->getId()) . "' AND product_id = '" . (int)$product_id . "' AND recurring_id = '" . (int)$recurring_id . "' AND `option` = '" . $this->db->escape(json_encode($option)) . "'");]]></search>
			<add position="after"><![CDATA[$query = $this->db->query("SELECT cart_id FROM " . DB_PREFIX . "cart WHERE api_id = '" . (isset($this->session->data['api_id']) ? (int)$this->session->data['api_id'] : 0) . "' AND customer_id = '" . (int)$this->customer->getId() . "' AND session_id = '" . $this->db->escape($this->session->getId()) . "' AND product_id = '" . (int)$product_id . "' AND recurring_id = '" . (int)$recurring_id . "' AND `option` = '" . $this->db->escape(json_encode($option)) . "'");
			if($query->num_rows){
				return $query->row['cart_id'];
			}]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[public function remove($cart_id) {]]></search>
			<add position="after"><![CDATA[$this->db->query("DELETE FROM " . DB_PREFIX . "purpletree_vendor_cart WHERE cart_id = '".(int)$cart_id."'");]]></add>
		</operation>
	</file>
<file path="system/library/cart/customer.php">
		<operation error="skip">
			<search><![CDATA[class Customer {]]></search>
			<add position="before"><![CDATA[
			if( !function_exists('apache_request_headers') ) {
///
function apache_request_headers() {
  $arh = array();
  $rx_http = '/\AHTTP_/';
  foreach($_SERVER as $key => $val) {
    if( preg_match($rx_http, $key) ) {
      $arh_key = preg_replace($rx_http, '', $key);
      $rx_matches = array();
      // do some nasty string manipulations to restore the original letter case
      // this should work in most cases
      $rx_matches = explode('_', $arh_key);
      if( count($rx_matches) > 0 and strlen($arh_key) > 2 ) {
        foreach($rx_matches as $ak_key => $ak_val) $rx_matches[$ak_key] = ucfirst($ak_val);
        $arh_key = implode('-', $rx_matches);
      }
      $arh[$arh_key] = $val;
    }
  }
  return( $arh );
}
} ]]></add>
		</operation>
			<operation error="skip">
			<search><![CDATA[public function getRewardPoints() {]]></search>
			<add position="before"><![CDATA[
			/********* Check if customer is a seller also ***********/
			public function isSeller(){
			if ($this->config->get('module_purpletree_multivendor_status')) {
		$query = $this->db->query("SELECT id, store_status, multi_store_id, is_removed FROM " . DB_PREFIX . "purpletree_vendor_stores where seller_id IN (SELECT seller_id FROM " . DB_PREFIX . "purpletree_vendor_stores WHERE customer_id = '" . $this->customer_id . "') AND role LIKE 'ADMIN'");
		return $query->row;
	}
	}
	/**** Validate seller with licence id *******/
		public function isMobileApiCall() {
						header('Access-Control-Allow-Origin:*');
		header('Access-Control-Allow-Methods: GET, PUT, POST, DELETE, OPTIONS');
		header('Access-Control-Max-Age: 286400');
		header('Access-Control-Allow-Credentials: true');
		header('Access-Control-Allow-Headers: xocmerchantid,XOCMERCHANTID,XOCSESSION,xocsession,purpletreemultivendor,Purpletreemultivendor,PURPLETREEMULTIVENDOR');
		if(NULL !== apache_request_headers()){
			foreach(apache_request_headers() as $key =>$value) {
				if($key == 'purpletreemultivendor' || $key == 'Purpletreemultivendor' || $key == 'PURPLETREEMULTIVENDOR') {
			$key = strtolower($key);
					if ($this->config->get('module_purpletree_multivendor_status')) {
						$query = $this->db->query("SELECT * FROM `" . DB_PREFIX . "api` WHERE `username` = '" . $key . "' AND `key` ='" . $value . "'");
						if($query->num_rows) {
							return true;
						}
					}
				}
			}
		}
		return false;
	}
	public function validateSeller($skipcondition = null) {
		if($_SERVER['HTTP_HOST'] == 'localhost') {
			$domain = 'http://'.$_SERVER['SERVER_NAME'].$_SERVER['PHP_SELF'];
		} else {
			$domain = 'http://'.$_SERVER['HTTP_HOST'];
		}
		
		$ip_a = $_SERVER['HTTP_HOST'];
		if(isset($skipcondition)){
		      $domain1 = md5($domain);
			$text = $this->config->get('module_purpletree_multivendor_encypt_text');
			$data_live = $this->config->get('module_purpletree_multivendor_live_validate_text');
			if(($domain1 == $text) && $data_live == 1) {
				return true;
			} else {
				$module	= 'purpletree_multivendor_oc';
				$valuee = $this->config->get('module_purpletree_multivendor_process_data');
				$ip_address = $this->request->server['REMOTE_ADDR'];
				$url = "https://www.process.purpletreesoftware.com/occheckdata.php";
				$handle=curl_init($url);
				curl_setopt($handle, CURLOPT_VERBOSE, true);
				curl_setopt($handle, CURLOPT_RETURNTRANSFER, true);
				curl_setopt($handle, CURLOPT_SSL_VERIFYPEER, false);
				curl_setopt($handle, CURLOPT_POSTFIELDS,
							"process_data=$valuee&domain_name=$domain&ip_address=$ip_address&module_name=$module");
				$result = curl_exec($handle);
				$result1 = json_decode($result);
				if(curl_error($handle))
				{
					echo 'error';
					die;
				}
				if ($result1->status == 'success') {
					$query = $this->db->query("UPDATE " . DB_PREFIX . "setting SET value = '1' WHERE " . DB_PREFIX . "setting.key = 'module_purpletree_multivendor_live_validate_text'");
					
				$query1 = $this->db->query("UPDATE " . DB_PREFIX . "setting SET value = '" .$domain1. "' WHERE " . DB_PREFIX . "setting.key = 'module_purpletree_multivendor_encypt_text'");
				
				return true;
				 } else {
					 return false;
				} 
			}
		}else{
		     //$ip_a = '103.111.47.26:123';
		   	$ip_a = str_replace(array(':', '.'), '', $ip_a);
				if (is_numeric($ip_a)){
					return true;
			}
		
		if (preg_match('(localhost|demo|test)',$domain)) {
			return true;
		} else {
			$domain1 = md5($domain);
			$text = $this->config->get('module_purpletree_multivendor_encypt_text');
			$data_live = $this->config->get('module_purpletree_multivendor_live_validate_text');
			if(($domain1 == $text) && $data_live == 1) {
				return true;
			} else {
				$module	= 'purpletree_multivendor_oc';
				$valuee = $this->config->get('module_purpletree_multivendor_process_data');
				$ip_address = $this->request->server['REMOTE_ADDR'];
				$url = "https://www.process.purpletreesoftware.com/occheckdata.php";
				$handle=curl_init($url);
				curl_setopt($handle, CURLOPT_VERBOSE, true);
				curl_setopt($handle, CURLOPT_RETURNTRANSFER, true);
				curl_setopt($handle, CURLOPT_SSL_VERIFYPEER, false);
				curl_setopt($handle, CURLOPT_POSTFIELDS,
							"process_data=$valuee&domain_name=$domain&ip_address=$ip_address&module_name=$module");
				$result = curl_exec($handle);
				$result1 = json_decode($result);
				if(curl_error($handle))
				{
					echo 'error';
					die;
				}
				if ($result1->status == 'success') {
					$query = $this->db->query("UPDATE " . DB_PREFIX . "setting SET value = '1' WHERE " . DB_PREFIX . "setting.key = 'module_purpletree_multivendor_live_validate_text'");
					
				$query1 = $this->db->query("UPDATE " . DB_PREFIX . "setting SET value = '" .$domain1. "' WHERE " . DB_PREFIX . "setting.key = 'module_purpletree_multivendor_encypt_text'");
				
				return true;
				 } else {
					 return false;
				} 
			}
		}	
		}
		
	}
	]]></add>
		</operation>
	</file>
	<file path="catalog/controller/product/product.php">
		<operation error="skip">
			<search><![CDATA[$this->document->setTitle($product_info['meta_title']);]]></search>
			<add position="before"><![CDATA[
				$this->session->data['ptsmv_current_page_name'] = $product_info['name'];
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[$this->load->language('product/product');]]></search>
			<add position="after"><![CDATA[
			$this->load->language('account/ptsregister');
			$data['text_seller_label'] = $this->language->get('text_seller_label');
			$data['text_seller_review'] = $this->language->get('text_seller_review');
			$data['text_seller_rating'] = $this->language->get('text_seller_rating');
			$data['text_seller_contact'] = $this->language->get('text_seller_contact');]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[$product_id = (int)$this->request->get['product_id'];]]></search>
			<add position="after"><![CDATA[
			if(isset($this->session->data['seller_sto_page'])) {
				unset($this->session->data['seller_sto_page']);
			}
			/******* get seller details to show on product page *******/
			$data['seller_review_status'] = $this->config->get('module_purpletree_multivendor_seller_review');
			$data['seller_detail'] = array();
			$data['module_purpletree_multivendor_allow_live_chat'] = 0;
				if(NULL !== $this->config->get('module_purpletree_multivendor_allow_live_chat')) {
					$data['module_purpletree_multivendor_allow_live_chat'] = $this->config->get('module_purpletree_multivendor_allow_live_chat');
				}
				$data['store_live_chat_enable'] =0;
				$data['store_live_chat_code'] ='';
			if($this->config->get('module_purpletree_multivendor_status')){
				
				$currentpage = $_SERVER["SERVER_NAME"].$_SERVER["REQUEST_URI"];
				$this->session->data['ptsmv_current_page'] = $currentpage;
				
				$this->load->model('extension/purpletree_multivendor/sellerproduct');
				$this->load->model('extension/purpletree_multivendor/vendor');
				$this->load->model('extension/purpletree_multivendor/sellertemplateproduct');
				$minprice = $this->model_extension_purpletree_multivendor_sellertemplateproduct->getMinPrice($product_id);
				if($this->config->get('module_purpletree_multivendor_seller_product_template')){
				if(!empty($minprice)){
				  $data['template_product_status'] = $minprice['subtract_status'];
			    }else{
				  $data['template_product_status'] = 0;
			    }}else{
				   $data['template_product_status'] = 0;
				}
				$seller_detail = $this->model_extension_purpletree_multivendor_sellerproduct->getSellername($product_id);
				if($seller_detail){
				$seller_detailss = $this->model_extension_purpletree_multivendor_vendor->getStoreDetail($seller_detail['seller_id']);
				
				$data['store_live_chat_enable'] = isset($seller_detailss['store_live_chat_enable'])?$seller_detailss['store_live_chat_enable']:0;
				$data['store_live_chat_code'] ='';
				if(isset($seller_detailss['store_live_chat_code'])) {
					
				$data['store_live_chat_code'] = $seller_detailss['store_live_chat_code'];	
					if($data['store_live_chat_code'] != '') {
						$this->session->data['seller_sto_page'] = $seller_detailss['id'];
					}					
				}
					$seller_rating = $this->model_extension_purpletree_multivendor_vendor->getStoreRating($seller_detail['seller_id']);
					$data['seller_detail'] = array(
						'seller_name' => $seller_detail['store_name'],
						'store_id' => $seller_detail['id'],
						'seller_rating' => (isset($seller_rating['rating'])?$seller_rating['rating']:'0'),
						'seller_count' => (isset($seller_rating['count'])?$seller_rating['count']:'0'),
						'seller_href' => $this->url->link('extension/account/purpletree_multivendor/sellerstore/storeview', 'seller_store_id=' . $seller_detail['id']),
						'seller_review_link' => $this->url->link('extension/account/purpletree_multivendor/sellerstore/sellerreview', 'seller_id=' . $seller_detail['seller_id']),
						'seller_contact_link' => $this->url->link('extension/account/purpletree_multivendor/sellercontact/customerReply', 'seller_id=' . $seller_detail['seller_id'])
					);
				}
			}]]></add>
		</operation>
	</file>
			<file path="catalog/view/theme/*/template/product/product.twig">
		<operation error="skip">
			<search><![CDATA[{{ footer }}]]></search>
			<add position="before"><![CDATA[
{% if seller_detail %}
{% if module_purpletree_multivendor_allow_live_chat %}
{% if store_live_chat_enable %}
{% if store_live_chat_code != '' %}
<!--Start of Tawk.to Script-->
<script type="text/javascript">
var Tawk_API=Tawk_API||{}, Tawk_LoadStart=new Date();
(function(){
var s1=document.createElement("script"),s0=document.getElementsByTagName("script")[0];
s1.async=true;
s1.src='https://embed.tawk.to/{{ store_live_chat_code }}/default';
s1.charset='UTF-8';
s1.setAttribute('crossorigin','*');
s0.parentNode.insertBefore(s1,s0);
})();
</script>
<!--End of Tawk.to Script-->
{% endif %}
{% endif %}
{% endif %}
{% endif %}]]></add>
</operation>
			<operation error="skip">
			<search><![CDATA[{% if reward %}]]></search>
			<add position="before"><![CDATA[{% if seller_detail %}
				<li>{{ text_seller_label }} <a href="{{ seller_detail.seller_href }}">{{ seller_detail.seller_name }}</a></li>
				{% if seller_review_status %}
				<li>{% if seller_detail.seller_rating %}
				<div class="rating" style="display:inline !important;">
							{{ text_seller_rating }}&nbsp;&nbsp;&nbsp;
							  {% for i in 1..5 %}
							  {% if seller_detail.seller_rating < i %}
							  <span class="fa fa-stack" style="min-width:0;"><i class="fa fa-star-o fa-stack-1x"></i></span>
							  {% else %}
							  <span class="fa fa-stack" style="min-width:0;"><i class="fa fa-star fa-stack-1x"></i></span>
							 {% endif %}
							  {% endfor %}
							  <a href="{{ seller_detail.seller_review_link }}">{{ seller_detail.seller_count }} {{ text_seller_review }}</a>
							</div>
							{% else %}
							<div class="rating"  style="display:inline !important;">{{ text_seller_rating }}&nbsp;&nbsp;&nbsp;
								{% for i in 1..5 %}
									<span class="fa fa-stack" style="min-width:0;"><i class="fa fa-star-o fa-stack-1x"></i></span>
								{% endfor %}
								<a href="{{ seller_detail.seller_review_link }}">{{ seller_detail.seller_count }} {{ text_seller_review }}</a>
							</div>
							{% endif %}</li>
				{% endif %}
					<li><a href="{{ seller_detail.seller_contact_link }}">{{ text_seller_contact }}</a></li>
			{% endif %}]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[id="button-cart"]]></search>
			<add position="before"><![CDATA[ {% if template_product_status == 1 %}
				{% else %}]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[id="button-cart"]]></search>
			<add position="after"><![CDATA[{% endif %}]]></add>
		</operation>
	</file>
		<file path="catalog/view/theme/journal3/template/product/product.twig">
		<operation error="skip">
			<search><![CDATA[{% if price and not j3.document.isPopup('options') %}]]></search>
			<add position="before"><![CDATA[{% if seller_detail %}
				<li>{{ text_seller_label }} <a href="{{ seller_detail.seller_href }}">{{ seller_detail.seller_name }}</a></li>
				{% if seller_review_status %}
				<li>{% if seller_detail.seller_rating %}
				<div class="rating" style="display:inline !important;">
							{{ text_seller_rating }}&nbsp;&nbsp;&nbsp;
							  {% for i in 1..5 %}
							  {% if seller_detail.seller_rating < i %}
							  <span class="fa fa-stack" style="min-width:0;"><i class="fa fa-star-o fa-stack-1x"></i></span>
							  {% else %}
							  <span class="fa fa-stack" style="min-width:0;"><i class="fa fa-star fa-stack-1x"></i></span>
							 {% endif %}
							  {% endfor %}
							  <a href="{{ seller_detail.seller_review_link }}">{{ seller_detail.seller_count }} {{ text_seller_review }}</a>
							</div>
							{% else %}
							<div class="rating"  style="display:inline !important;">{{ text_seller_rating }}&nbsp;&nbsp;&nbsp;
								{% for i in 1..5 %}
									<span class="fa fa-stack" style="min-width:0;"><i class="fa fa-star-o fa-stack-1x"></i></span>
								{% endfor %}
								<a href="{{ seller_detail.seller_review_link }}">{{ seller_detail.seller_count }} {{ text_seller_review }}</a>
							</div>
							{% endif %}</li>
				{% endif %}
					<li><a href="{{ seller_detail.seller_contact_link }}">{{ text_seller_contact }}</a></li>
			{% endif %}]]></add>
		</operation>
	</file>
	<file path="catalog/controller/checkout/checkout.php">
		<operation error="skip">
			<search><![CDATA[if ($product['minimum'] > $product_total) {]]></search>
			<add position="before"><![CDATA[
			/******* validate seller and check for maximum product limit ********/
			if(!$this->customer->validateSeller()) {
			$this->load->language('purpletree_multivendor/ptsmultivendor');
			$this->session->data['error_warning'] = $this->language->get('error_license');
			$this->response->redirect($this->url->link('checkout/cart'));
			}
			if($this->config->get('module_purpletree_multivendor_status')){
				if ($this->config->get('module_purpletree_multivendor_product_limit') < $product_total) {
				$this->response->redirect($this->url->link('checkout/cart'));
			}
			}
			]]></add>
		</operation>
	</file>	
	<file path="catalog/controller/checkout/cart.php">
		<operation error="skip">
			<search><![CDATA[if ($product['minimum'] > $product_total) {]]></search>
			<add position="before"><![CDATA[
			/********** Check for maximim product limit ************/
			$this->load->language('account/ptsregister');
			if($this->config->get('module_purpletree_multivendor_status')){
				if ($this->config->get('module_purpletree_multivendor_product_limit') < $product_total) {
				$data['error_warning'] = sprintf($this->language->get('error_maximum'), $product['name'], $this->config->get('module_purpletree_multivendor_product_limit'));
			}
			}
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[$data['action'] = $this->url->link('checkout/cart/edit', '', true);]]></search>
			<add position="before"><![CDATA[
			if (isset($this->session->data['error_warning'])) {
				$data['error_warning'] = $this->session->data['error_warning'];

				unset($this->session->data['error_warning']);
			}
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[if (isset($this->request->post['product_id'])) {]]></search>
			<add position="before"><![CDATA[ if(isset($this->request->get['seller_id'])) {
			$seller_id = (int)$this->request->get['seller_id'];
		}]]></add>
		</operation>
			<operation error="skip">
			<search><![CDATA[$this->cart->add($this->request->post['product_id'], $quantity, $option, $recurring_id);]]></search>
			<add position="replace"><![CDATA[$cart_id = $this->cart->add($this->request->post['product_id'], $quantity, $option, $recurring_id);]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[$cart_id = $this->cart->add($this->request->post['product_id'], $quantity, $option, $recurring_id);]]></search>
			<add position="after"><![CDATA[ 	if($this->config->get('module_purpletree_multivendor_seller_product_template')){
			if (isset($seller_id)) {
                  if($seller_id && $cart_id) {
					$cart_id = $this->cart->addVendorproduct($cart_id, $seller_id);
				  }
				 }
				 }]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[$product_info = $this->model_catalog_product->getProduct($product_id);]]></search>
			<add position="before"><![CDATA[
				if($this->config->get('module_purpletree_multivendor_seller_product_template')){
			$template_product = $this->cart->getTemplate($product_id);
		if ($template_product == 1) {
				 if (!isset($seller_id)) {
					$json['error']['template'] = $this->language->get('error_recurring_required');
				 }
				}
       }				]]></add>
		</operation>
	</file>
	<file path="catalog/controller/startup/seo_url.php">
		<operation error="skip">
			<search><![CDATA[if (isset($this->request->get['_route_'])) {]]></search>
			<add position="before"><![CDATA[
			//ocmultivendor SEO
			if ($this->config->get('config_seo_url')) {
				if(isset($this->request->get['route']) && $this->request->get['route'] != 'extension/account/purpletree_multivendor/sellerstore/storeview') {
		$routeee = (explode("extension/account/purpletree_multivendor/",$this->request->get['route']));
				 if (array_key_exists("1",$routeee)) {
					 if(!empty($this->request->get) && $this->request->server['REQUEST_METHOD'] != 'POST') {
							unset($this->request->get['route']);
							$urlappend = '';
							$ccc = 0;
						foreach($this->request->get as $keyy => $valuee) {
							if($ccc == 0) {
								$urlappend .= '?';
							} else {
								$urlappend .= '&';
							}
							$urlappend .= $keyy.'='.$valuee;
							$ccc++;
						}
							header('Location: '.$this->config->get('config_url').'ocmultivendor/'.$routeee[1].$urlappend, true, 301);
							exit;
						}
				 }
		} 
		}
		//ocmultivendor SEO
		]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[if (!isset($this->request->get['route'])) {]]></search>
			<add position="before"><![CDATA[
			//ocmultivendor SEO
			$routeee = (explode("ocmultivendor/",$this->request->get['_route_']));
				 if (array_key_exists("1",$routeee)) {
					 $this->request->get['route'] = 'extension/account/purpletree_multivendor/'.$routeee[1];
				 }
				 //ocmultivendor SEO
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[if ($url[0] == 'category_id') {]]></search>
			<add position="before"><![CDATA[if ($url[0] == 'seller_store_id') {
						$this->request->get['seller_store_id'] = $url[1];
					}
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[if (isset($data['route'])) {]]></search>
			<add position="after"><![CDATA[
			//ocmultivendor SEO
			$route11 = '';
				 $routeee = (explode("extension/account/purpletree_multivendor",$data['route']));
				 if (array_key_exists("1",$routeee)) {
					  $route11 = $routeee[1]; 
				 }
				 //ocmultivendor SEO
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[if ($query->row['query'] && $url[0] != 'information_id' && $url[0] != 'manufacturer_id' && $url[0] != 'category_id' && $url[0] != 'product_id') {]]></search>
			<add position="replace" offset="0"><![CDATA[if ($query->row['query'] && $url[0] != 'information_id' && $url[0] != 'manufacturer_id' && $url[0] != 'category_id' && $url[0] != 'product_id' && $url[0] != 'seller_store_id') {
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[
			 if ($query->row['query'] && $url[0] != 'information_id' && $url[0] != 'manufacturer_id' && $url[0] != 'category_id' && $url[0] != 'product_id' && $url[0] != 'simple_blog_article_id' && $url[0] != 'simple_blog_category_id' && $url[0] != 'simple_blog_author_id') {
			 ]]></search>
						<add position="replace" offset="0"><![CDATA[
			 if ($query->row['query'] && $url[0] != 'information_id' && $url[0] != 'manufacturer_id' && $url[0] != 'category_id' && $url[0] != 'product_id' && $url[0] != 'simple_blog_article_id' && $url[0] != 'simple_blog_category_id' && $url[0] != 'simple_blog_author_id' && $url[0] != 'seller_store_id') {
			 ]]></add>
        </operation>
		<operation error="skip">
			<search><![CDATA[if ($query->row['query'] && $url[0] != 'information_id' && $url[0] != 'video_category_id' && $url[0] != 'support_category_id'  && $url[0] != 'video_id'  && $url[0] != 'knowledge_id' && $url[0] != 'manufacturer_id' && $url[0] != 'category_id' && $url[0] != 'product_id') {]]></search>
						<add position="replace" offset="0"><![CDATA[
						if ($query->row['query'] && $url[0] != 'information_id' && $url[0] != 'video_category_id' && $url[0] != 'support_category_id'  && $url[0] != 'video_id'  && $url[0] != 'knowledge_id' && $url[0] != 'manufacturer_id' && $url[0] != 'category_id' && $url[0] != 'product_id' && $url[0] != 'seller_store_id') {
			 ]]></add>
        </operation>
		<operation error="skip">
			<search><![CDATA[$this->request->get['route'] = 'information/information';]]></search>
			<add position="replace" offset="0"><![CDATA[$this->request->get['route'] = 'information/information';
				}elseif (isset($this->request->get['seller_store_id'])) {
					$this->request->get['route'] = 'extension/account/purpletree_multivendor/sellerstore/storeview';
			]]></add>
		</operation>
		<operation error="skip">
            <search><![CDATA[} elseif ($key == 'path') {]]></search>
             <add position="replace"><![CDATA[} elseif ($data['route'] == 'extension/account/purpletree_multivendor/sellerstore/storeview' && $key == 'seller_store_id') {
                    $query = $this->db->query("SELECT * FROM " . DB_PREFIX . "seo_url WHERE `query` = '" . $this->db->escape($key . '=' . (int)$value) . "' AND store_id = '" . (int)$this->config->get('config_store_id') . "'");

                    if ( $query->num_rows && $query->row['keyword'] ) {
                        $url .=  '/' . $query->row['keyword'];
 
                        unset( $data[$key] );
                    }
					//ocmultivendor SEO
					} elseif ($route11 != '' && $data['route'] != 'extension/account/purpletree_multivendor/sellerstore/storeview') {
						$url .=  '/ocmultivendor' . $route11;
 
                        unset( $data[$key] );
						//ocmultivendor SEO
                } elseif ($key == 'path') {]]></add>
         </operation>
	</file>
	
	<file path="catalog/controller/common/header.php">
		<operation error="skip">
			<search><![CDATA[</head>]]></search>
			<add position="before"><![CDATA[
			<script src="catalog/view/javascript/purpletree/common.js" type="text/javascript"></script>
			]]></add>
         </operation>
			<operation error="skip">
			<search><![CDATA[$data['menu']]]></search>
			<add position="before"><![CDATA[
			/***** Show browse seller link in header ******/
			$this->load->language('account/ptsregister');
			 $data['direction'] = $this->language->get('direction');
			 $data['module_purpletree_multivendor_browse_sellers'] = $this->config->get('module_purpletree_multivendor_browse_sellers');
			 $data['module_purpletree_multivendor_include_jquery'] = $this->config->get('module_purpletree_multivendor_include_jquery');
			$data['text_browse_sellers'] = $this->language->get('text_browse_sellers');
			$data['text_seller_register'] = $this->language->get('text_seller_register');
			$data['seller_panel_link'] = '';
			$data['text_seller_panel'] = $this->language->get('text_seller_panel');
			$data['browse_seller_link'] = $this->url->link('extension/account/purpletree_multivendor/sellers');
			$data['seller_register_link'] = $this->url->link('extension/account/purpletree_multivendor/sellerlogin');
			///// seller panel/////
			$this->load->model('extension/purpletree_multivendor/vendor');

			   $store_detail = $this->model_extension_purpletree_multivendor_vendor->isSeller($this->customer->getId());	
				if($store_detail){
						if($store_detail['is_removed']==1){
							$data['seller_panel_link'] = $this->url->link('extension/account/purpletree_multivendor/sellerstore/becomeseller', '', true);
						} else {
						if($store_detail['store_status']==1 && $store_detail[  'multi_store_id'] == $this->config->get('config_store_id')){
							$data['seller_panel_link'] = $this->url->link('extension/account/purpletree_multivendor/dashboardicons', '', true);
						}elseif($store_detail[  'multi_store_id'] != $this->config->get('config_store_id')){
						  $data['seller_panel_link'] = $this->url->link('extension/account/purpletree_multivendor/sellerlogin');
						   $data['text_seller_panel'] = $this->language->get('text_seller_register');
						} else {
							$data['seller_panel_link'] = $this->url->link('extension/account/purpletree_multivendor/sellerstore/becomeseller', '', true);
						}
						}
				}
			//////End seller panel///
			if ($this->customer->isLogged()) {
			$this->load->model('extension/purpletree_multivendor/vendor');
			   $store_detail = $this->model_extension_purpletree_multivendor_vendor->isSeller($this->customer->getId());	
				if($store_detail){
					$data['sellerlogged'] = 'seller';
				}
		    }
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[public function index() {]]></search>
			<add position="after"><![CDATA[
			$direction = $this->language->get('direction');
			if ($direction=='rtl'){
			$this->document->addStyle('catalog/view/javascript/purpletree/bootstrap/css/bootstrap.min-a.css');
			$this->document->addStyle('catalog/view/theme/default/stylesheet/purpletree/custom-a.css'); 
			}else{
			$this->document->addStyle('catalog/view/javascript/purpletree/bootstrap/css/bootstrap.min.css'); 
			$this->document->addStyle('catalog/view/theme/default/stylesheet/purpletree/custom.css'); 
			}
			//$this->document->addScript('catalog/view/javascript/purpletree/common.js'); 
			
			//count notification 
			$this->load->model('extension/purpletree_multivendor/dashboard');
			$totalorders1 = $this->model_extension_purpletree_multivendor_dashboard->getCountSeen($this->customer->getId());
			$totalenqures1 = $this->model_extension_purpletree_multivendor_dashboard->getCountSeen1($this->customer->getId());
			$data['totalnotification'] = $totalorders1 + $totalenqures1;
			
       ]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[$data['scripts'] = $this->document->getScripts('header');]]></search>
			<add position="after"><![CDATA[
			if($this->config->get('module_purpletree_multivendor_include_jquery')){
			}else{
			array_unshift($data['scripts'] , "catalog/view/javascript/purpletree/jquery/jquery-2.1.1.min.js");
			}
			]]></add>
		</operation>
	</file>
	<file path="catalog/view/theme/*/template/journal2/headers/mega.twig">
		<operation error="skip">
			<search><![CDATA[{{ journal2.settings.get('config_secondary_menu') }}]]></search>
			<add position="before"><![CDATA[
			{% if sellerlogged %}
			<li><a href="{{ seller_panel_link }}"><i class="fa fa-user fas fa user-o" aria-hidden="true"></i><span class=""> {{ text_seller_panel }}</span></a></li>
			{% else %}
			<li><a href="{{ seller_register_link }}"><i class="fa fa-user fas fa user-o" aria-hidden="true"></i><span class=""> {{ text_seller_register }}</span></a></li>
			{% endif %}
			{% if module_purpletree_multivendor_browse_sellers %}
			<li><a href="{{ browse_seller_link }}"><i class="fa fa-users" aria-hidden="true"></i><span class=""> {{ text_browse_sellers }}</span></a></li>
			{% endif %}
			]]></add>
		</operation>
	</file>
	<file path="catalog/view/theme/*/template/journal2/headers/center.twig">
		<operation error="skip">
			<search><![CDATA[{{ journal2.settings.get('config_secondary_menu') }}]]></search>
			<add position="before"><![CDATA[
			{% if sellerlogged %}
			<li><i class="fa fa-user fas fa user-o" aria-hidden="true"></i> <span><a href="{{ seller_panel_link }}">{{ text_seller_panel }}</a></span></li>
			{% else %}
			<li><a href="{{ seller_register_link }}"><i class="fa fa-user fas fa user-o" aria-hidden="true"></i><span class=""> {{ text_seller_register }}</span></a></li>
			{% endif %}
			{% if module_purpletree_multivendor_browse_sellers %}
			<li><a href="{{ browse_seller_link }}"><i class="fa fa-users" aria-hidden="true"></i><span class=""> {{ text_browse_sellers }}</span></a></li>
			{% endif %}
			]]></add>
		</operation>
	</file>
	<file path="catalog/view/theme/journal3/template/journal3/headers/desktop/slim.twig">
		<operation error="skip">
			<search><![CDATA[<div class="language-currency top-menu">]]></search>
			<add position="before"><![CDATA[
			{% if sellerlogged %}
			<li><i class="fa fa-user fas fa user-o" aria-hidden="true"></i> <span><a href="{{ seller_panel_link }}">{{ text_seller_panel }}</a></span></li>
			{% else %}
			<li><i class="fa fa-user fas fa user-o" aria-hidden="true"></i> <span><a href="{{ seller_register_link }}">{{ text_seller_register }}</a></span></li>
			{% endif %}
			{% if module_purpletree_multivendor_browse_sellers %}
			<li><i class="fa fa-users" aria-hidden="true"></i> <span><a href="{{ browse_seller_link }}">{{ text_browse_sellers }}</a></span></li>
			{% endif %}
			]]></add>
		</operation>
	</file>
	<file path="catalog/view/theme/journal3/template/journal3/headers/desktop/mega.twig">
		<operation error="skip">
			<search><![CDATA[<div class="language-currency top-menu">]]></search>
			<add position="before"><![CDATA[
			{% if sellerlogged %}
			<li><i class="fa fa-user fas fa user-o" aria-hidden="true"></i> <span><a href="{{ seller_panel_link }}">{{ text_seller_panel }}</a></span></li>
			{% else %}
			<li><i class="fa fa-user fas fa user-o" aria-hidden="true"></i> <span><a href="{{ seller_register_link }}">{{ text_seller_register }}</a></span></li>
			{% endif %}
			{% if module_purpletree_multivendor_browse_sellers %}
			<li><i class="fa fa-users" aria-hidden="true"></i> <span><a href="{{ browse_seller_link }}">{{ text_browse_sellers }}</a></span></li>
			{% endif %}
			]]></add>
		</operation>
	</file>
	<file path="catalog/view/theme/journal3/template/journal3/headers/desktop/default.twig">
		<operation error="skip">
			<search><![CDATA[<div class="language-currency top-menu">]]></search>
			<add position="before"><![CDATA[
			{% if sellerlogged %}
			<li><i class="fa fa-user fas fa user-o" aria-hidden="true"></i> <span><a href="{{ seller_panel_link }}">{{ text_seller_panel }}</a></span></li>
			{% else %}
			<li><i class="fa fa-user fas fa user-o" aria-hidden="true"></i> <span><a href="{{ seller_register_link }}">{{ text_seller_register }}</a></span></li>
			{% endif %}
			{% if module_purpletree_multivendor_browse_sellers %}
			<li><i class="fa fa-users" aria-hidden="true"></i> <span><a href="{{ browse_seller_link }}">{{ text_browse_sellers }}</a></span></li>
			{% endif %}
			]]></add>
		</operation>
	</file>
	<file path="catalog/view/theme/journal3/template/journal3/headers/desktop/default2.twig">
		<operation error="skip">
			<search><![CDATA[<div class="language-currency top-menu">]]></search>
			<add position="before"><![CDATA[
			{% if sellerlogged %}
			<li><i class="fa fa-user fas fa user-o" aria-hidden="true"></i> <span><a href="{{ seller_panel_link }}">{{ text_seller_panel }}</a></span></li>
			{% else %}
			<li><i class="fa fa-user fas fa user-o" aria-hidden="true"></i> <span><a href="{{ seller_register_link }}">{{ text_seller_register }}</a></span></li>
			{% endif %}
			{% if module_purpletree_multivendor_browse_sellers %}
			<li><i class="fa fa-users" aria-hidden="true"></i> <span><a href="{{ browse_seller_link }}">{{ text_browse_sellers }}</a></span></li>
			{% endif %}
			]]></add>
		</operation>
	</file>
	<file path="catalog/view/theme/journal3/template/journal3/headers/desktop/compact.twig">
		<operation error="skip">
			<search><![CDATA[<div class="language-currency top-menu">]]></search>
			<add position="before"><![CDATA[
			{% if sellerlogged %}
			<li><i class="fa fa-user fas fa user-o" aria-hidden="true"></i> <span><a href="{{ seller_panel_link }}">{{ text_seller_panel }}</a></span></li>
			{% else %}
			<li><i class="fa fa-user fas fa user-o" aria-hidden="true"></i> <span><a href="{{ seller_register_link }}">{{ text_seller_register }}</a></span></li>
			{% endif %}
			{% if module_purpletree_multivendor_browse_sellers %}
			<li><i class="fa fa-users" aria-hidden="true"></i> <span><a href="{{ browse_seller_link }}">{{ text_browse_sellers }}</a></span></li>
			{% endif %}
			]]></add>
		</operation>
	</file>
	<file path="catalog/view/theme/journal3/template/journal3/headers/desktop/classic.twig">
		<operation error="skip">
			<search><![CDATA[<div class="language-currency top-menu">]]></search>
			<add position="before"><![CDATA[
			<div class="top-menu" style="margin-left:100px">
				<ul class="j-menu">
					{% if sellerlogged %}
						<li><a href="{{ seller_panel_link }}"><i class="fa fa-user fas fa user-o" aria-hidden="true"></i> {{ text_seller_panel }}</a></li>
					{% else %}
						<li><a href="{{ seller_register_link }}"><i class="fa fa-user fas fa user-o" aria-hidden="true"></i> {{ text_seller_register }}</a></li>
					{% endif %}
					{% if module_purpletree_multivendor_browse_sellers %}
						<li> <a href="{{ browse_seller_link }}"><i class="fa fa-users" aria-hidden="true"></i> {{ text_browse_sellers }}</a></li>
					{% endif %}
			  </ul>	
		</div>	
			]]></add>
		</operation>
	</file>
			
			<file path="catalog/view/theme/*/template/journal2/headers/compact.twig">
		<operation error="skip">
			<search><![CDATA[<ul class="top-menu">]]></search>
			<add position="after"><![CDATA[
			{% if sellerlogged %} 
			<li><a href="{{ seller_panel_link }}"><i class="fa fa-user fas fa user-o" aria-hidden="true"></i><span class=""> {{ text_seller_panel }}</span></a></li>
			{% else %}
			<li><a href="{{ seller_register_link }}"><i class="fa fa-user fas fa user-o" aria-hidden="true"></i><span class=""> {{ text_seller_register }}</span></a></li>
			{% endif %}
			{% if module_purpletree_multivendor_browse_sellers %}
			<li><a href="{{ browse_seller_link }}"><i class="fa fa-users" aria-hidden="true"></i><span class=""> {{ text_browse_sellers }}</span></a></li>
			{% endif %}
			]]></add>
		</operation>
	</file>
	<file path="catalog/view/theme/*/template/journal2/headers/default.twig">
		<operation error="skip">
			<search><![CDATA[{{ journal2.settings.get('config_secondary_menu') }}]]></search>
			<add position="before"><![CDATA[
			{% if sellerlogged %}
             <li><a href="{{ seller_panel_link }}"><i class="fa fa-user fas fa user-o" aria-hidden="true"></i><span class=""> {{ text_seller_panel }}</span></a></li>
			{% else %}			
			<li><a href="{{ seller_register_link }}"><i class="fa fa-user fas fa user-o" aria-hidden="true"></i><span class=""> {{ text_seller_register }}</span></a></li>
			{% endif %}
			{% if module_purpletree_multivendor_browse_sellers %}
			<li><a href="{{ browse_seller_link }}"><i class="fa fa-users" aria-hidden="true"></i><span class=""> {{ text_browse_sellers }}</span></a></li>
			{% endif %}
			]]></add>
		</operation>
	</file>
	<file path="catalog/view/theme/pav_xstore/template/common/header.twig">
	<operation error="skip">
			<search><![CDATA[</head>]]></search>
			<add position="before"><![CDATA[
			<script src="catalog/view/javascript/purpletree/common.js" type="text/javascript"></script>
			]]></add>
         </operation>
	</file>	
	<file path="catalog/view/theme/amazing/template/common/header2.twig">
	<operation error="skip">
			<search><![CDATA[</head>]]></search>
			<add position="before"><![CDATA[
			<script src="catalog/view/javascript/purpletree/common.js" type="text/javascript"></script>
			]]></add>
         </operation>
	</file>	
	<file path="catalog/view/theme/amazing/template/common/header3.twig">
	<operation error="skip">
			<search><![CDATA[</head>]]></search>
			<add position="before"><![CDATA[
			<script src="catalog/view/javascript/purpletree/common.js" type="text/javascript"></script>
			]]></add>
         </operation>
	</file>	
	<file path="catalog/view/theme/amazing/template/common/header4.twig">
	<operation error="skip">
			<search><![CDATA[</head>]]></search>
			<add position="before"><![CDATA[
			<script src="catalog/view/javascript/purpletree/common.js" type="text/javascript"></script>
			]]></add>
         </operation>
	</file>	
	<file path="catalog/view/theme/amazing/template/common/header5.twig">
	<operation error="skip">
			<search><![CDATA[</head>]]></search>
			<add position="before"><![CDATA[
			<script src="catalog/view/javascript/purpletree/common.js" type="text/javascript"></script>
			]]></add>
         </operation>
	</file>	
	<file path="catalog/view/theme/amazing/template/common/header6.twig">
	<operation error="skip">
			<search><![CDATA[</head>]]></search>
			<add position="before"><![CDATA[
			<script src="catalog/view/javascript/purpletree/common.js" type="text/javascript"></script>
			]]></add>
         </operation>
	</file>
	<file path="catalog/view/theme/so-shoppystore/template/header/header1.twig">
	<operation error="skip">
			<search><![CDATA[<ul class="top-link list-inline">]]></search>
			<add position="after"><![CDATA[
			{% if sellerlogged %}		
			 <li>
				<a style="" class="btn-xs" href="{{ seller_panel_link }}"><i style="" class="fa fa-user fas fa user-o" aria-hidden="true"></i> <span>{{ text_seller_panel }}</span></a>
				</li>
				{% else %}
				<li>
			<a style="" class="btn-xs" class="btn-xs"  href="{{ seller_register_link }}"><i style="" class="fa fa-user fas fa user-o" aria-hidden="true"></i> <span>{{ text_seller_register }}</span></a>
			 </li>
			{% endif %}
			{% if module_purpletree_multivendor_browse_sellers %}
			<li>
			<a  class="btn-xs" href="{{ browse_seller_link }}"><i class="fa fa-users" aria-hidden="true" ></i>
			<span>{{ text_browse_sellers }}</span></a>
			</li>
			{% endif %}
			]]></add>
         </operation>
	</file>	
	<file path="catalog/view/theme/so-shoppystore/template/header/header2.twig">
	<operation error="skip">
			<search><![CDATA[<ul class="top-link list-inline">]]></search>
			<add position="after"><![CDATA[
			{% if sellerlogged %}		
			 <li>
				<a style="" class="btn-xs" href="{{ seller_panel_link }}"><i style="" class="fa fa-user fas fa user-o" aria-hidden="true"></i> <span>{{ text_seller_panel }}</span></a>
				</li>
				{% else %}
				<li>
			<a style="" class="btn-xs" class="btn-xs"  href="{{ seller_register_link }}"><i style="" class="fa fa-user fas fa user-o" aria-hidden="true"></i> <span>{{ text_seller_register }}</span></a>
			 </li>
			{% endif %}
			{% if module_purpletree_multivendor_browse_sellers %}
			<li>
			<a  class="btn-xs" href="{{ browse_seller_link }}"><i class="fa fa-users" aria-hidden="true" ></i>
			<span>{{ text_browse_sellers }}</span></a>
			</li>
			{% endif %}
			]]></add>
         </operation>
	</file>	
	<file path="catalog/view/theme/so-shoppystore/template/header/header3.twig">
	<operation error="skip">
			<search><![CDATA[<ul class="top-link list-inline">]]></search>
			<add position="after"><![CDATA[
			{% if sellerlogged %}		
			 <li>
				<a style="" class="btn-xs" href="{{ seller_panel_link }}"><i style="" class="fa fa-user fas fa user-o" aria-hidden="true"></i> <span>{{ text_seller_panel }}</span></a>
				</li>
				{% else %}
				<li>
			<a style="" class="btn-xs" class="btn-xs"  href="{{ seller_register_link }}"><i style="" class="fa fa-user fas fa user-o" aria-hidden="true"></i> <span>{{ text_seller_register }}</span></a>
			 </li>
			{% endif %}
			{% if module_purpletree_multivendor_browse_sellers %}
			<li>
			<a  class="btn-xs" href="{{ browse_seller_link }}"><i class="fa fa-users" aria-hidden="true" ></i>
			<span>{{ text_browse_sellers }}</span></a>
			</li>
			{% endif %}
			]]></add>
         </operation>
	</file>
	<file path="catalog/view/theme/so-shoppystore/template/header/header4.twig">
	<operation error="skip">
			<search><![CDATA[<ul class="top-link list-inline">]]></search>
			<add position="after"><![CDATA[
			{% if sellerlogged %}		
			 <li>
				<a style="" class="btn-xs" href="{{ seller_panel_link }}"><i style="" class="fa fa-user fas fa user-o" aria-hidden="true"></i> <span>{{ text_seller_panel }}</span></a>
				</li>
				{% else %}
				<li>
			<a style="" class="btn-xs" class="btn-xs"  href="{{ seller_register_link }}"><i style="" class="fa fa-user fas fa user-o" aria-hidden="true"></i> <span>{{ text_seller_register }}</span></a>
			 </li>
			{% endif %}
			{% if module_purpletree_multivendor_browse_sellers %}
			<li>
			<a  class="btn-xs" href="{{ browse_seller_link }}"><i class="fa fa-users" aria-hidden="true" ></i>
			<span>{{ text_browse_sellers }}</span></a>
			</li>
			{% endif %}
			]]></add>
         </operation>
	</file>	
	<file path="catalog/view/theme/so-shoppystore/template/header/header5.twig">
	<operation error="skip">
			<search><![CDATA[<ul class="top-link list-inline">]]></search>
			<add position="after"><![CDATA[
			{% if sellerlogged %}		
			 <li>
				<a style="" class="btn-xs" href="{{ seller_panel_link }}"><i style="" class="fa fa-user fas fa user-o" aria-hidden="true"></i> <span>{{ text_seller_panel }}</span></a>
				</li>
				{% else %}
				<li>
			<a style="" class="btn-xs" class="btn-xs"  href="{{ seller_register_link }}"><i style="" class="fa fa-user fas fa user-o" aria-hidden="true"></i> <span>{{ text_seller_register }}</span></a>
			 </li>
			{% endif %}
			{% if module_purpletree_multivendor_browse_sellers %}
			<li>
			<a  class="btn-xs" href="{{ browse_seller_link }}"><i class="fa fa-users" aria-hidden="true" ></i>
			<span>{{ text_browse_sellers }}</span></a>
			</li>
			{% endif %}
			]]></add>
         </operation>
	</file>
	<file path="catalog/view/theme/amazing/template/common/header.twig">
		<operation error="skip">
			<search><![CDATA[</head>]]></search>
			<add position="before"><![CDATA[
			<script src="catalog/view/javascript/purpletree/common.js" type="text/javascript"></script>
			]]></add>
         </operation>
	   <operation error="skip">
	   <search><![CDATA[{{ currency }}]]></search>
	   <add position="before"><![CDATA[
	            {% if sellerlogged %}				
				<i style="" class="fa fa-user fas fa user-o" aria-hidden="true"></i> <span><a style="" href="{{ seller_panel_link }}">{{ text_seller_panel }}</a></span>
				{% else %}
				<i style="" class="fa fa-user fas fa user-o" aria-hidden="true"></i> <span><a style="" href="{{ seller_register_link }}">{{ text_seller_register }}</a></span>
				{% endif %}
	   			{% if module_purpletree_multivendor_browse_sellers %}
				<i class="fa fa-users" aria-hidden="true" ></i>
				<span><a href="{{ browse_seller_link }}">{{ text_browse_sellers }}</a></span>
				{% endif %}
	   ]]></add>
	   </operation>
	</file>	
	<file path="catalog/view/theme/oxy/template/common/header.twig">
	<operation error="skip">
			<search><![CDATA[</head>]]></search>
			<add position="before"><![CDATA[
			<script src="catalog/view/javascript/purpletree/common.js" type="text/javascript"></script>
			]]></add>
         </operation>
	   <operation error="skip">
	   <search><![CDATA[<li><a href="{{ contact }}"><i class="fa fa-envelope"></i> <span class="hidden-xs">{{ email }}</span></a></li> ]]></search>
	   <add position="after"><![CDATA[
			  			{% if sellerlogged %}
			<li><i class="fa fa-user fas fa user-o" aria-hidden="true"></i> <span><a href="{{ seller_panel_link }}">{{ text_seller_panel }}</a></span></li>
			{% else %}
			<li><i class="fa fa-user fas fa user-o" aria-hidden="true"></i> <span><a href="{{ seller_register_link }}">{{ text_seller_register }}</a></span></li>
			{% endif %}
			{% if module_purpletree_multivendor_browse_sellers %}
			<i class="fa fa-users" aria-hidden="true" ></i>
				<span><a href="{{ browse_seller_link }}">{{ text_browse_sellers }}</a></span>
			{% endif %}
	   ]]></add>
	   </operation>
	</file>
	<file path="catalog/view/theme/so-topdeal/template/header/header4.twig">		
		<operation error="skip">
			<search><![CDATA[<ul class="top-link list-inline">]]></search>
			<add position="after"><![CDATA[
				{% if sellerlogged %}
			<li><i class="fa fa-user fas fa user-o" aria-hidden="true"></i><a href="{{ seller_panel_link }}">{{ text_seller_panel }}</a></li>
			{% else %}
			<li><i class="fa fa-user fas fa user-o" aria-hidden="true"></i> <a href="{{ seller_register_link }}">{{ text_seller_register }}</a></li>
			{% endif %}
			{% if module_purpletree_multivendor_browse_sellers %}
			<li><i class="fa fa-users" aria-hidden="true"></i><a href="{{ browse_seller_link }}">{{ text_browse_sellers }}</a></li>
			{% endif %}
			]]></add>
		</operation>
	</file> 
	<file path="catalog/view/theme/amazing/template/common/header2.twig">
	<operation error="skip">
		 <search><![CDATA[<div class="row" style="margin-top: -5px;">]]></search>
		<add position="after"><![CDATA[
		{% if sellerlogged %}
		<div><i style="color:white;" class="fa fa-user fas fa user-o" aria-hidden="true"></i> <span><a style="color:white;" href="{{ seller_panel_link }}">{{ text_seller_panel }}</a></span></div>
		{% else %}
			<div><i style="color:white;" class="fa fa-user fas fa user-o" aria-hidden="true"></i> <span><a style="color:white;" href="{{ seller_register_link }}">{{ text_seller_register }}</a></span></div>
        {% endif %}			
			{% if module_purpletree_multivendor_browse_sellers %}
               <div> <i style="color:white;" class="fa fa-users" aria-hidden="true" ></i> <span><a style="color:white;" href="{{ browse_seller_link }}">{{ text_browse_sellers }}</a></span></div>
			{% endif %}	
	    ]]></add>
		 </operation> 
	</file>
	<file path="catalog/view/theme/amazing/template/common/header3.twig">
	<operation error="skip">
		 <search><![CDATA[<ul class="topBarNav pull-right">]]></search>
		<add position="after"><![CDATA[
		{% if sellerlogged %} 		
		<i class="fa fa-user fas fa user-o" aria-hidden="true"></i>
				<span><a href="{{ seller_panel_link }}">{{ text_seller_panel }}</a></span>
		{% else %}
				<i class="fa fa-user fas fa user-o" aria-hidden="true"></i>
				<span><a href="{{ seller_register_link }}">{{ text_seller_register }}</a></span>
		{% endif %}
				{% if module_purpletree_multivendor_browse_sellers %}
				<i class="fa fa-users" aria-hidden="true" ></i> <span><a href="{{ browse_seller_link }}">{{ text_browse_sellers }}</a></span>
				{% endif %}		
	    ]]></add>
		 </operation>
	</file>
	<file path="catalog/view/theme/amazing/template/common/header4.twig">
	<operation error="skip">
		 <search><![CDATA[<ul class="topBarNav pull-right">]]></search>
		<add position="after"><![CDATA[
		{% if sellerlogged %}
		<i class="fa fa-user fas fa user-o" aria-hidden="true"></i>
		    <span><a href="{{ seller_panel_link }}">{{ text_seller_panel }}</a></span>
		{% else %}
		    <i class="fa fa-user fas fa user-o" aria-hidden="true"></i>
		    <span><a href="{{ seller_register_link }}">{{ text_seller_register }}</a></span>
			{% endif %}	
			{% if module_purpletree_multivendor_browse_sellers %}
				<i class="fa fa-users" aria-hidden="true" ></i> <span><a href="{{ browse_seller_link }}">{{ text_browse_sellers }}</a></span>
			{% endif %}		
	    ]]></add>
		 </operation>
	</file>
    <file path="catalog/view/theme/so-ladaz/template/header/header1.twig">		
		<operation error="skip">
			<search><![CDATA[<ul class="top-link list-inline">]]></search>
			<add position="after"><![CDATA[
			{% if sellerlogged %}
				<li>
				   <a href="{{ seller_panel_link }}">
					</span> <span class="fa fa-user fas fa user-o"></span>
					<span>{{ text_seller_panel }}</a></li>
				{% else %}
				<li>
					<a href="{{ seller_register_link }}"><span class="fa fa-user fas fa user-o"></span> <span>{{ text_seller_register }}</span> </a>
				</li>
				{% endif %}
				{% if module_purpletree_multivendor_browse_sellers %}
				<li> 
				<a href="{{ browse_seller_link }}"><span class="fa fa-users" aria-hidden="true"></span> <span>{{ text_browse_sellers }}</span></a></li>
			{% endif %}
			]]></add>
		</operation>
	</file>
	<file path="catalog/view/theme/*/template/common/header.twig">	
<operation error="skip">
			<search><![CDATA[</head>]]></search> text_seller_panel 
			<add position="before"><![CDATA[
			<script src="catalog/view/javascript/purpletree/common.js" type="text/javascript"></script>
			]]></add>
         </operation>	
		<operation error="skip">
			<search><![CDATA[<div id="top-links"]]></search>
			<add position="after" offset="1"><![CDATA[
			{% if sellerlogged %}
			<li><i class="fa fa-user fas fa user-o" aria-hidden="true"></i> <span><a href="{{ seller_panel_link }}">{{ text_seller_panel }}
			{% if not totalnotification==0 %}
				<span class="pts-counting-seller-pannel">{{ totalnotification }}</span>
			{% endif %}
			</a></span></li>
			{% else %}
			<li><i class="fa fa-user fas fa user-o" aria-hidden="true"></i> <span><a href="{{ seller_register_link }}">{{ text_seller_register }}</a></span></li>
			{% endif %}
			{% if module_purpletree_multivendor_browse_sellers %}
			<li><i class="fa fa-users" aria-hidden="true"></i> <span><a href="{{ browse_seller_link }}">{{ text_browse_sellers }}</a></span></li>
			{% endif %}
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[<div class="nav float-right">]]></search>
			<add position="after" offset="1"><![CDATA[
			{% if sellerlogged %}
			<li><i class="fa fa-user fas fa user-o" aria-hidden="true"></i> <span><a href="{{ seller_panel_link }}">{{ text_seller_panel }}{% if not totalnotification==0 %}
				<span class="pts-counting-seller-pannel">{{ totalnotification }}</span>
			{% endif %}</a></span></li>
			{% else %}
	    	<li><i class="fa fa-user fas fa user-o" aria-hidden="true"></i> <span><a href="{{ seller_register_link }}">{{ text_seller_register }}</a></span></li>
			{% endif %}
			{% if module_purpletree_multivendor_browse_sellers %}
			<li><i class="fa fa-users" aria-hidden="true"></i> <span><a href="{{ browse_seller_link }}">{{ text_browse_sellers }}</a></span></li>
			{% endif %}
			]]></add>
		</operation>		
	</file>
	<file path="catalog/view/theme/*/template/common/header1.twig">		
		<operation error="skip">
			<search><![CDATA[<ul class="list-inline">]]></search>
			<add position="after" offset="0"><![CDATA[
			{% if sellerlogged %}
			<li><i class="fa fa-user fas fa user-o" aria-hidden="true"></i> <span><a href="{{ seller_panel_link }}">{{ text_seller_panel }}</a></span></li>
			{% else %}
			<li><i class="fa fa-user fas fa user-o" aria-hidden="true"></i> <span><a href="{{ seller_register_link }}">{{ text_seller_register }}</a></span></li>
			{% endif %}
			{% if module_purpletree_multivendor_browse_sellers %}
			<li><i class="fa fa-users" aria-hidden="true"></i> <span><a href="{{ browse_seller_link }}">{{ text_browse_sellers }}</a></span></li>
			{% endif %}
			]]></add>
		</operation>		
	</file>
	<file path="catalog/view/theme/*/template/common/header2.twig">		
		<operation error="skip">
			<search><![CDATA[<ul class="list-inline">]]></search>
			<add position="after" offset="0"><![CDATA[
			{% if sellerlogged %}
			<li><i class="fa fa-user fas fa user-o" aria-hidden="true"></i> <span><a href="{{ seller_panel_link }}">{{ text_seller_panel }}</a></span></li>
			{% else %}
			<li><i class="fa fa-user fas fa user-o" aria-hidden="true"></i> <span><a href="{{ seller_register_link }}">{{ text_seller_register }}</a></span></li>
			{% endif %}
			{% if module_purpletree_multivendor_browse_sellers %}
			<li><i class="fa fa-users" aria-hidden="true"></i> <span><a href="{{ browse_seller_link }}">{{ text_browse_sellers }}</a></span></li>
			{% endif %}
			]]></add>
		</operation>		
	</file>
	<file path="catalog/view/theme/*/template/common/header3.twig">		
		<operation error="skip">
			<search><![CDATA[<ul class="list-inline">]]></search>
			<add position="after" offset="0"><![CDATA[
			{% if sellerlogged %}
			<li><i class="fa fa-user fas fa user-o" aria-hidden="true"></i> <span><a href="{{ seller_panel_link }}">{{ text_seller_panel }}</a></span></li>
			{% else %}
			<li><i class="fa fa-user fas fa user-o" aria-hidden="true"></i> <span><a href="{{ seller_register_link }}">{{ text_seller_register }}</a></span></li>
			{% endif %}
			{% if module_purpletree_multivendor_browse_sellers %}
			<li><i class="fa fa-users" aria-hidden="true"></i> <span><a href="{{ browse_seller_link }}">{{ text_browse_sellers }}</a></span></li>
			{% endif %}
			]]></add>
		</operation>		
	</file>
	<file path="catalog/view/theme/*/template/common/header4.twig">		
		<operation error="skip">
			<search><![CDATA[<ul class="list-inline">]]></search>
			<add position="after" offset="0"><![CDATA[
			{% if sellerlogged %} 
			<li><i class="fa fa-user fas fa user-o" aria-hidden="true"></i> <span><a href="{{ seller_panel_link }}">{{ text_seller_panel }}</a></span></li>
			{% else %}
			<li><i class="fa fa-user fas fa user-o" aria-hidden="true"></i> <span><a href="{{ seller_register_link }}">{{ text_seller_register }}</a></span></li>
			{% endif %}
			{% if module_purpletree_multivendor_browse_sellers %}
			<li><i class="fa fa-users" aria-hidden="true"></i> <span><a href="{{ browse_seller_link }}">{{ text_browse_sellers }}</a></span></li>
			{% endif %}
			]]></add>
		</operation>		
	</file>
	<file path="catalog/view/theme/*/template/common/footer.twig">
		<operation error="skip">
			<search><![CDATA[</body>]]></search>
			<add position="before"><![CDATA[
			<script>
$(document).on('click','.note-insert button',function(){ 
	$('.modal-backdrop.in').css("display","none");
});
$(document).on('click','.note-link button',function(){ 
	$('.modal-backdrop.in').css("display","none");
});
</script>
			]]></add>
		</operation>
				<operation error="skip">
			<search><![CDATA[<!--Start of Tawk.to Script-->]]></search>
			<add position="before"><![CDATA[
		{% if seller_chat == '' %}
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[<!--End of Tawk.to Script-->]]></search>
			<add position="after"><![CDATA[
	{% endif %}
			]]></add>
		</operation>
	</file>

	<file path="catalog/view/theme/*/template/common/footer1.twig">
		<operation error="skip">
			<search><![CDATA[</body>]]></search>
			<add position="before"><![CDATA[
			<script>
$(document).on('click','.note-insert button',function(){ 
	$('.modal-backdrop.in').css("display","none");
});
$(document).on('click','.note-link button',function(){ 
	$('.modal-backdrop.in').css("display","none");
});
</script>
			]]></add>
		</operation>
	</file>
	<file path="catalog/view/theme/*/template/common/footer2.twig">
	
		<operation error="skip">
			<search><![CDATA[</body>]]></search>
			<add position="before"><![CDATA[
			<script>
$(document).on('click','.note-insert button',function(){ 
	$('.modal-backdrop.in').css("display","none");
});
$(document).on('click','.note-link button',function(){ 
	$('.modal-backdrop.in').css("display","none");
});
</script>
			]]></add>
		</operation>
	</file>
	<file path="catalog/view/theme/*/template/common/footer3.twig">
		<operation error="skip">
			<search><![CDATA[</body>]]></search>
			<add position="before"><![CDATA[
			<script>
$(document).on('click','.note-insert button',function(){ 
	$('.modal-backdrop.in').css("display","none");
});
$(document).on('click','.note-link button',function(){ 
	$('.modal-backdrop.in').css("display","none");
});
</script>
			]]></add>
		</operation>
	</file>
	<file path="catalog/view/theme/*/template/common/footer4.twig">
		<operation error="skip">
			<search><![CDATA[</body>]]></search>
			<add position="before"><![CDATA[
			<script>
$(document).on('click','.note-insert button',function(){ 
	$('.modal-backdrop.in').css("display","none");
});
$(document).on('click','.note-link button',function(){ 
	$('.modal-backdrop.in').css("display","none");
});
</script>
			]]></add>
		</operation>
	</file>
	<file path="catalog/view/theme/*/template/common/footer5.twig">
		<operation error="skip">
			<search><![CDATA[</body>]]></search>
			<add position="before"><![CDATA[
			<script>
$(document).on('click','.note-insert button',function(){ 
	$('.modal-backdrop.in').css("display","none");
});
$(document).on('click','.note-link button',function(){ 
	$('.modal-backdrop.in').css("display","none");
});
</script>
			]]></add>
		</operation>
	</file>
	<file path="catalog/view/theme/*/template/common/footer6.twig">
		<operation error="skip">
			<search><![CDATA[</body>]]></search>
			<add position="before"><![CDATA[
			<script>
$(document).on('click','.note-insert button',function(){ 
	$('.modal-backdrop.in').css("display","none");
});
$(document).on('click','.note-link button',function(){ 
	$('.modal-backdrop.in').css("display","none");
});
</script>
			]]></add>
		</operation>
	</file>
	<file path="catalog/view/theme/*/template/account/order_info.twig">
		<operation error="skip">
			<search><![CDATA[<td class="text-left">{{ history.comment }}</td>]]></search>
			<add position="after"><![CDATA[
			<td class="text-left">{{ history.updated_by }}</td>
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[<td class="text-left">{{ column_comment }}</td>]]></search>
			<add position="after"><![CDATA[
			<td class="text-left">{{ column_updated_by }}</td>
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[<td class="text-left">{{ column_date_added }}</td>]]></search>
			<add position="before"><![CDATA[
			<td class="text-left">{{ column_name }}</td>
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[<td class="text-left">{{ history.date_added }}</td>]]></search>
			<add position="before"><![CDATA[
			<td class="text-left">
				<table>
					{% for product in history.product_name %}
						<tr>
							<td class="purpleproductname">{{ product.product_name }}</td>
						</tr>
					{% endfor %}
				</table>
			</td>
			]]></add>
		</operation>
	</file>
	<file path="catalog/view/theme/*/template/account/order_list.twig">
		<operation error="skip">
			<search><![CDATA[<td class="text-left">{{ order.status }}</td>]]></search>
			<add position="replace" offset="0"><![CDATA[
			<td class="text-left pts-table_order_list" style="padding: 0px;">
				<table style="width: 100%;">
					{% for status in order.status %}
					<tr>
						<td class="purpleproductname" style="padding: 5px;">
							<table>
								{% for product in status.product %}
									<tr>
										<td>{{ product.product_name }}</td>
									</tr>
								{% endfor %}
							</table>
						</td>
							<td class="purplstatus" style="text-align:right;padding:11px;">{{ status.order_status }}</td>
					</tr>
				  {% endfor %}
				</table>
			  </td>
			]]></add>
		</operation>
	</file>
	<file path="catalog/view/theme/journal3/template/account/order_list.twig">
		<operation error="skip">
			<search><![CDATA[<td class="text-center">{{ order.status }}</td>]]></search>
			<add position="replace" offset="0"><![CDATA[
			<td class="text-left pts-table_order_list" style="padding: 0px;">
				<table style="width: 100%;">
					{% for status in order.status %}
					<tr>
						<td class="purpleproductname" style="padding: 5px;">
							<table>
								{% for product in status.product %}
									<tr>
										<td>{{ product.product_name }}</td>
									</tr>
								{% endfor %}
							</table>
						</td>
							<td class="purplstatus" style="text-align:right;padding:11px;">{{ status.order_status }}</td>
					</tr>
				  {% endfor %}
				</table>
			  </td>
			]]></add>
		</operation>
	</file>
	<file path="catalog/controller/account/order.php">
		<operation error="skip">
			<search><![CDATA[$data['histories'][] = array(]]></search>
			<add position="replace" offset="1"><![CDATA[
			$product22[0]['product_name'] = "All"; 
			$data['histories'][] = array(
					'date_added' => date($this->language->get('date_format_short'), strtotime($result['date_added'])),
					'product_name' => $product22,
					'updated_by' => "Admin",
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[$data['continue'] = $this->url->link('account/order', '', true);]]></search>
			<add position="before"><![CDATA[
			 usort($data['histories'], function($a, $b) {
			  return ($a['date_added'] < $b['date_added']) ? -1 : 1;
			});
			]]></add>
		</operation>
			<operation error="skip">
			<search><![CDATA[$this->model_account_order->getOrderHistories($this->request->get['order_id']);]]></search>
			<add position="after"><![CDATA[
				$data['column_updated_by'] = "Updated By";
			$resultssellers = 
			$this->model_account_order->getSellerOrderHistories($this->request->get['order_id']);
			foreach ($resultssellers as $result1) {
			$data['histories'][] = array(
					'date_added' => date($this->language->get('date_format_short'), strtotime($result1['created_at'])),
					'product_name' => $this->model_account_order->getSellerOrderProducts($result1['order_id'],$result1['seller_id']),
					'status'     => $result1['status'],
					'comment'    => $result1['notify'] ? nl2br($result1['comment']) : '',
					'updated_by' => $this->model_account_order->getStoreName($result1['seller_id'])
				);
			}
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA['name'       => $result['firstname'] . ' ' . $result['lastname'],]]></search>
			<add position="replace" offset="1"><![CDATA[
			'name'       => $result['firstname'] . ' ' . $result['lastname'],
			'status'     => $this->model_account_order->getUniqueSeller($result['order_id']),
			]]></add>
		</operation>
	</file>
	<file path="catalog/controller/api/order.php">
	   <operation error="skip">
			<search><![CDATA[$order_data['products'][] = array(]]></search>
			<add position="before"><![CDATA[$seller_id = $this->cart->getvendorcart($product['cart_id']);]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA['reward'     => $product['reward']]]></search>
			<add position="replace"><![CDATA['reward'     => $product['reward'],]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA['reward'     => $product['reward'],]]></search>
			<add position="after"><![CDATA['seller_id'  => $seller_id]]></add>
		</operation>
	</file>
	<file path="catalog/model/account/order.php">
		<operation error="skip">
			<search><![CDATA[getOrderHistories]]></search>
			<add position="before"><![CDATA[
						public function getSellerOrderHistories($order_id) {
		$query = $this->db->query("SELECT pvh.order_id, pvh.seller_id, pvh.created_at, os.name AS status, pvh.comment, pvh.notify FROM " . DB_PREFIX . "purpletree_vendor_orders_history pvh LEFT JOIN " . DB_PREFIX . "order_status os ON pvh.order_status_id = os.order_status_id WHERE pvh.order_id = '" . (int)$order_id . "' AND os.language_id = '" . (int)$this->config->get('config_language_id') . "' ORDER BY pvh.id DESC");
		return $query->rows;
	}
	
	public function getUniqueSeller($order_id){
		$query = $this->db->query("SELECT DISTINCT(seller_id) FROM " . DB_PREFIX . "purpletree_vendor_orders_history WHERE order_id='".(int)$order_id."' order by id desc");
		$result = $query->rows;
		$aa = array();
		$aa = $this->getSellerOrderStatus($result, $order_id);
		$dd = array();
		if(!empty($aa)) {
			foreach($aa as $bb) {
			foreach($bb['product'] as $cc) {
				$dd[] = $cc['product_id'];
			}
		}
		}
		
		$query11 = $this->db->query("SELECT '0' AS seller_id,op.product_id,op.name as product_name, os.name AS status FROM " . DB_PREFIX . "order_product op LEFT JOIN " . DB_PREFIX . "order o ON o.order_id = op.order_id LEFT JOIN " . DB_PREFIX . "order_status os ON o.order_status_id = os.order_status_id WHERE op.order_id='" . $order_id . "' GROUP BY op.order_product_id");
		$resul11t = $query11->rows;
			$fdfd = array();
		foreach($resul11t as $ree) {
			if(!empty($aa)) {
				if(!in_array($ree['product_id'],$dd)) {
		$fdfd[$ree['product_id']]['product_name'] = $ree['product_name'];
					foreach($aa as $gg) {
						$aa[0] = array("order_status" =>  $ree['status'],
										"product" => $fdfd
						);
					}
				}
			} else {
		$fdfd[$ree['product_id']]['product_name'] = $ree['product_name'];
				$aa[0] = array("order_status" =>  $ree['status'],
								"seller_id" => '0',
										"product" => $fdfd
						);
			}
		}
		return $aa;
	}
	
	public function getSellerOrderStatus($result, $order_id){
		$order_status = array();
		foreach($result as $result){
			$query = $this->db->query("SELECT pvh.order_id, pvh.seller_id, pvh.created_at, os.name AS status FROM " . DB_PREFIX . "purpletree_vendor_orders_history pvh LEFT JOIN " . DB_PREFIX . "order_status os ON pvh.order_status_id = os.order_status_id WHERE pvh.seller_id='".(int)$result['seller_id']."' AND pvh.order_id='".(int)$order_id."' AND os.language_id = '" . (int)$this->config->get('config_language_id') . "' ORDER BY pvh.id DESC limit 1");
			$result1 = $query->row;
			$order_status[$result['seller_id']] = array(
				'order_status' => $result1['status'],
				'seller_id' => $result['seller_id'],
				'product' => $this->getSellerOrderProducts($order_id, $result['seller_id'])
			);
		}
	
		return $order_status;
	}
	
	public function getSellerOrderProducts($order_id, $seller_id){
		$query = $this->db->query("SELECT pvo.product_id,(SELECT op.name FROM " . DB_PREFIX . "order_product op where op.product_id = pvo.product_id AND op.order_id = pvo.order_id) as product_name FROM " . DB_PREFIX . "purpletree_vendor_orders pvo WHERE pvo.seller_id='".(int)$seller_id."' AND pvo.order_id = '".(int)$order_id."'");
    
		return $query->rows;
	}
		public function getStoreName($seller_id) {
		$query = $this->db->query("SELECT store_name FROM " . DB_PREFIX . "purpletree_vendor_stores WHERE seller_id = " . (int)$seller_id );

		if ($query->num_rows > 0) {
			return $query->row['store_name'];
		} else {
			return null;	
		}
		
	}	
			]]></add>
		</operation>
	</file>
	<file path="catalog/controller/mail/order.php">
		<operation error="skip">
			<search><![CDATA[$emails = explode(',', $this->config->get('config_mail_alert_email'));]]></search>
			<add position="before"><![CDATA[
			// Seller mail
			$this->load->model('extension/purpletree_multivendor/sellerorder');
			$order_seller = $this->model_extension_purpletree_multivendor_sellerorder->getOrderSeller($order_id);
			
			if($order_seller){
				foreach($order_seller as $orderseller){
					
					$this->load->language('mail/order_alert');
					$seller_detail = $this->db->query("SELECT email FROM " .DB_PREFIX."customer WHERE customer_id = '".$orderseller['seller_id']."'")->row;
					// HTML Mail
					$data['text_received'] = $this->language->get('text_received');
					$data['text_order_id'] = $this->language->get('text_order_id');
					$data['text_date_added'] = $this->language->get('text_date_added');
					$data['text_order_status'] = $this->language->get('text_order_status');
					$data['text_product'] = $this->language->get('text_product');
					$data['text_total'] = $this->language->get('text_total');
					$data['text_comment'] = $this->language->get('text_comment');
					
					$data['order_id'] = $order_info['order_id'];
					$data['date_added'] = date($this->language->get('date_format_short'), strtotime($order_info['date_added']));

					$order_status_query = $this->db->query("SELECT * FROM " . DB_PREFIX . "order_status WHERE order_status_id = '" . (int)$order_status_id . "' AND language_id = '" . (int)$this->config->get('config_language_id') . "'");

					if ($order_status_query->num_rows) {
						$data['order_status'] = $order_status_query->row['name'];
					} else {
						$data['order_status'] = '';
					}

					$this->load->model('tool/upload');
					
					$data['products'] = array();

					$order_products = $this->model_extension_purpletree_multivendor_sellerorder->getSellerOrderProducts($order_id, $orderseller['seller_id']);
                    $pushnoticeproducts = '';
                    $productindex = 0;
					foreach ($order_products as $order_product) {
						$option_data = array();
						
						$order_options = $this->model_extension_purpletree_multivendor_sellerorder->getOrderOptions($order_info['order_id'], $order_product['order_product_id']);
						
						foreach ($order_options as $order_option) {
							if ($order_option['type'] != 'file') {
								$value = $order_option['value'];
							} else {
								$upload_info = $this->model_tool_upload->getUploadByCode($order_option['value']);
			
								if ($upload_info) {
									$value = $upload_info['name'];
								} else {
									$value = '';
								}
							}

							$option_data[] = array(
								'name'  => $order_option['name'],
								'value' => (utf8_strlen($value) > 20 ? utf8_substr($value, 0, 20) . '..' : $value)
							);					
						}
							
						$data['products'][] = array(
							'name'     => $order_product['name'],
							'model'    => $order_product['model'],
							'quantity' => $order_product['quantity'],
							'option'   => $option_data,
							'total'    => html_entity_decode($this->currency->format($order_product['total'] + ($this->config->get('config_tax') ? ($order_product['tax'] * $order_product['quantity']) : 0), $order_info['currency_code'], $order_info['currency_value']), ENT_NOQUOTES, 'UTF-8')
						);
						if($productindex == 0 ){
						    $pushnoticeproducts .= $order_product['name'];
						}else{
						    $pushnoticeproducts .= $order_product['name'].',';
						}
						$productindex++;
					}
					
					$data['vouchers'] = array();
					
					$order_vouchers = $this->model_extension_purpletree_multivendor_sellerorder->getOrderVouchers($order_id);

					foreach ($order_vouchers as $order_voucher) {
						$data['vouchers'][] = array(
							'description' => $order_voucher['description'],
							'amount'      => html_entity_decode($this->currency->format($order_voucher['amount'], $order_info['currency_code'], $order_info['currency_value']), ENT_NOQUOTES, 'UTF-8')
						);					
					}

					$data['totals'] = array();
					
					$order_totals = $this->model_extension_purpletree_multivendor_sellerorder->getOrderTotals($order_id, $orderseller['seller_id']);

					foreach ($order_totals as $order_total) {
						$data['totals'][] = array(
							'title' => $order_total['title'],
							'value' => html_entity_decode($this->currency->format($order_total['value'], $order_info['currency_code'], $order_info['currency_value']), ENT_NOQUOTES, 'UTF-8')
						);
					}

					$data['comment'] = strip_tags($order_info['comment']);
                    
                    $data['usercomment'] = "Kindly drop the exact item at the nearest pickup center";
                    
					/*$mail = new Mail($this->config->get('config_mail_engine'));
					$mail->parameter = $this->config->get('config_mail_parameter');
					$mail->smtp_hostname = $this->config->get('config_mail_smtp_hostname');
					$mail->smtp_username = $this->config->get('config_mail_smtp_username');
					$mail->smtp_password = html_entity_decode($this->config->get('config_mail_smtp_password'), ENT_QUOTES, 'UTF-8');
					$mail->smtp_port = $this->config->get('config_mail_smtp_port');
					$mail->smtp_timeout = $this->config->get('config_mail_smtp_timeout');

					$mail->setTo($seller_detail['email']);
					
					$mail->setFrom($this->config->get('config_email'));
					$mail->setSender(html_entity_decode($order_info['store_name'], ENT_QUOTES, 'UTF-8'));
					$mail->setSubject(html_entity_decode(sprintf($this->language->get('text_subject'), $this->config->get('config_name'), $order_info['order_id']), ENT_QUOTES, 'UTF-8'));
					$mail->setText($this->load->view('mail/order_alert', $data));
					$mail->send();*/

                    //added 19/02/2020 ici
            		$bmessg = $this->load->view('mail/order_alert_vendor', $data);
               		$subject = html_entity_decode(sprintf($this->language->get('text_subject'), $this->config->get('config_name'), $order_info['order_id']), ENT_QUOTES, 'UTF-8');
               		$cemail = $seller_detail['email'];
               		$postdata = "email=" . $cemail . "&body=" . $bmessg . "&subject=" . $subject;
		
            		$ch = curl_init();
            		curl_setopt($ch, CURLOPT_URL, "http://www.obejorgroup.com/sendemail.php");
            		curl_setopt ($ch, CURLOPT_FOLLOWLOCATION, 1);
            		curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
            		curl_setopt ($ch, CURLOPT_POST, 1); 
            		curl_setopt ($ch, CURLOPT_POSTFIELDS, $postdata);
            	    curl_exec($ch);
            		curl_close($ch);	
		                
                    //****end************************//
 
					$this->load->model('account/user_push_notification');
                    $data  = [ 
                     	"type"=>'order',
                     	"id"=>$order_info['order_id'],
                     	"date"=>$order_info['date_added']
                    ];
                    $title =  'Order Information';
                    $message = 'Product: '.$pushnoticeproducts.' '.$this->language->get('text_order_status').' '.$order_status_query->row['name'];
                    $imageurl = '';
                    $sendNotification = $this->model_account_user_push_notification->sendSellerPushNotification($orderseller['seller_id'],$message,$title,$data,$imageurl);  //************  to send seller pushnotification on his order ****//
				}
			}
			]]></add>
		</operation>
	</file>
		<file path="catalog/controller/product/category.php">
		

		<operation error="skip">
		<search><![CDATA[class ControllerProductCategory extends Controller {]]></search>
		<add position="before"><![CDATA[
		if (! function_exists('array_column')) {
			function array_column(array $input, $columnKey, $indexKey = null) {
				$array = array();
				foreach ($input as $value) {
					if ( !array_key_exists($columnKey, $value)) {
						trigger_error("Key \"$columnKey\" does not exist in array");
						return false;
					}
					if (is_null($indexKey)) {
						$array[] = $value[$columnKey];
					}
					else {
						if ( !array_key_exists($indexKey, $value)) {
							trigger_error("Key \"$indexKey\" does not exist in array");
							return false;
						}
						if ( ! is_scalar($value[$indexKey])) {
							trigger_error("Key \"$indexKey\" does not contain scalar value");
							return false;
						}
						$array[$value[$indexKey]] = $value[$columnKey];
					}
				}
				return $array;
			}
		}]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[ $results = $this->model_catalog_product->getProducts($filter_data); ]]></search>
			<add position="after"><![CDATA[ $resultsid = array(); ]]></add>
	    </operation>
	    <operation error="skip">
			<search><![CDATA[ public function index() { ]]></search>
			<add position="after"> <![CDATA[$this->document->addStyle('catalog/view/javascript/purpletree/jquery/owl-carousel/owl.carousel.css');
	        $this->document->addScript('catalog/view/javascript/purpletree/jquery/owl-carousel/owl.carousel.min.js');  ]]></add>
			
	</operation>
	<operation error="skip">
			<search><![CDATA[ public function index() { ]]></search>
			<add position="after"><![CDATA[ $resultsid = array(); ]]></add>
	</operation>
	
	<operation error="skip">
			<search><![CDATA[ $data['products'][] = array( ]]></search>
			<add position="before"><![CDATA[ $resultsid[] = $result['product_id']; ]]></add>
	</operation>
	
	<operation error="skip">
			<search><![CDATA[ $this->response->setOutput($this->load->view('product/category', $data)); ]]></search>
			<add position="before"><![CDATA[ //  Start Seller category featured  products
				$this->load->language('account/ptsregister');
            $data['text_seller_featured_products'] = $this->language->get('text_seller_featured_products');
	        $this->load->model('setting/extension');
            $installed_modules = $this->model_setting_extension->getExtensions('module');
			  
		/* get active skin */
		$data['no_Of_product'] = 4;
		if (strpos($this->config->get('config_template'), 'journal2') === 0){
				
			$query = $this->db->query("SELECT * FROM " . DB_PREFIX . "journal2_config WHERE store_id = '0' AND `key` = 'active_skin'");
			$theme['journal2_config']['active_skin'] = $query->num_rows ? $query->row['value'] : 1;		
			if($theme['journal2_config']['active_skin']==1){
				$data['no_Of_product'] = 3;
			}elseif($theme['journal2_config']['active_skin']==2 || $theme['journal2_config']['active_skin']==3 || $theme['journal2_config']['active_skin']==4 || $theme['journal2_config']['active_skin']==5 || $theme['journal2_config']['active_skin']== 6|| $theme['journal2_config']['active_skin']==7 || $theme['journal2_config']['active_skin']==8 || $theme['journal2_config']['active_skin']==9 || $theme['journal2_config']['active_skin']== 12 || $theme['journal2_config']['active_skin']==14 || $theme['journal2_config']['active_skin']==15){
				$data['no_Of_product'] = 4;
			}elseif($theme['journal2_config']['active_skin']==10 || $theme['journal2_config']['active_skin']==11 || $theme['journal2_config']['active_skin']==13){
				$data['no_Of_product'] = 5;
			}
		}
		$data['text_tax'] = $this->language->get('text_tax');
		$data['button_cart'] = $this->language->get('button_cart');
		$data['button_wishlist'] = $this->language->get('button_wishlist');
		$data['button_compare'] = $this->language->get('button_compare');

		$this->load->model('catalog/product');

		$this->load->model('tool/image');

		$data['productss'] = array();			
			
			$productss = $this->model_catalog_category->getCategoryFeatured();			
		

			 if(!empty($productss)) {
			 $prodssarray = array();
			 foreach ($productss as $product) {
				 if(in_array($product['product_id'],$resultsid)){
				  if(!in_array($product['product_id'],$prodssarray)) {
				  $prodssarray[] = $product['product_id'];
				$product_infoo = $this->model_catalog_product->getProduct($product['product_id']);
				$imagee2 = false;
				if (strpos($this->config->get('config_template'), 'journal2') === 0){ 
				    $this->load->model('journal2/product');
				    $additional_imagess = $this->model_catalog_product->getProductImages($product['product_id']);               
					if (count($additional_imagess) > 0) {
                    $imagee2 = $this->model_tool_image->resize($additional_imagess[0]['image'], $this->config->get('config_image_product_width'), $this->config->get('config_image_product_height'));
                }
			   }

				if ($product_infoo) {
					if ($product_infoo['image']) {
						$imagee = $this->model_tool_image->resize($product_infoo['image'], '200' , '200');
						
					} else {
						$imagee = $this->model_tool_image->resize('placeholder.png', '200' , '200');
					}

					if ($this->customer->isLogged() || !$this->config->get('config_customer_price')) {
						$pricee = $this->currency->format($this->tax->calculate($product_infoo['price'], $product_infoo['tax_class_id'], $this->config->get('config_tax')), $this->session->data['currency']);
					} else {
						$pricee = false;
					}

					if ((float)$product_infoo['special']) {
						$speciall = $this->currency->format($this->tax->calculate($product_infoo['special'], $product_infoo['tax_class_id'], $this->config->get('config_tax')), $this->session->data['currency']);
					} else {
						$speciall = false;
					}

					if ($this->config->get('config_tax')) {
						$tax = $this->currency->format((float)$product_infoo['special'] ? $product_infoo['special'] : $product_infoo['price'], $this->session->data['currency']);
					} else {
						$tax = false;
					}

					if ($this->config->get('config_review_status')) {
						$rating = $product_infoo['rating'];
					} else {
						$rating = false;
					}
				$date_end = false;
				$labelss ='';
				if (strpos($this->config->get('config_template'), 'journal2') === 0){
				 $this->load->model('journal2/product');
				 $labelss = (array_search('journal2', array_column($installed_modules, 'code')) !== False)?$this->model_journal2_product->getLabels($product['product_id']):'';
				 }
                if (strpos($this->config->get('config_template'), 'journal2') === 0 && $special && $this->journal2->settings->get('show_countdown', 'never') !== 'never') {
                   // $this->load->model('journal2/product');
                    $date_end = $this->model_journal2_product->getSpecialCountdown($result['product_id']);
                    if ($date_end === '0000-00-00') {
                        $date_end = false;
                    }
                }
            
					 $shortdescription = utf8_substr(strip_tags(html_entity_decode($product_infoo['description'], ENT_QUOTES, 'UTF-8')), 0, $this->config->get($this->config->get('config_theme') . '_product_description_length' )) . '..';
					 
						 if(strlen($shortdescription) > 25){
						   $shortdescription =  substr($shortdescription, 0, 25).'...';
						}
				
					$data['productss'][] = array(
						'product_id'  => $product_infoo['product_id'],
						'thumb'       => $imagee,
						'thumb2'       => $imagee2,
						'name'        => $product_infoo['name'],
						'labels'        => $labelss,
						'description' => $shortdescription,
						'price'       => $pricee,
						'special'     => $speciall,
						'date_end'       => $date_end,
						'tax'         => $tax,
						'rating'      => $rating,
						'href'        => $this->url->link('product/product', 'product_id=' .      $product_infoo['product_id'])
					);
				}
				}
			}
		 }
	}
//  End Seller category featured  products ]]></add>
	</operation>
	
	</file>
	<file path="catalog/model/catalog/category.php">
	<operation error="skip">
			<search><![CDATA[ public function getCategory($category_id) { ]]></search>
			<add position="before"><![CDATA[ 	public function getCategoryFeatured() {
		$products = array();
		
		$query = $this->db->query("SELECT * FROM " . DB_PREFIX . "purpletree_vendor_products pvp WHERE pvp.is_category_featured='1' ORDER BY RAND() DESC LIMIT 0,8" );
			
		if($query->num_rows) {
			$products = $query->rows; 
		}		
		return $products;
		 
	} ]]></add>
	</operation>
	</file>
	<file path="catalog/view/theme/*/template/product/category.twig">
	  <operation error="skip">
			<search><![CDATA[ {% if categories %} ]]></search>
			<add position="before"><![CDATA[ 	  <!-- Start Seller Featured Productsr -->
	{% if productss %}  
	<h3>{{ text_seller_featured_products }}</h3>
	<div class="row">
	<div id="carousel_seller_featured" class="owl-carousel">
	{% for product in productss %}
  <div class="item text-center">
  <div class="pts-product-layout" style="padding:10px;">
    <div class="pts-product-thumb transition">
      <div class="image"><a href="{{ product.href }}"><img src="{{ product.thumb }}" alt="{{ product.name }}" title="{{ product.name }}" class="img-responsive" /></a></div>
      <div class="pts-caption" style="min-height:auto !important">
        <h4><a href="{{ product.href }}">{{ product.name }}</a></h4>
        <p>{{ product.description }}</p>
        {% if product.rating %}
        <div class="rating">
          {% for i in 1..5 %}
          {% if product.rating < i %}
          <span class="fa fa-stack"><i class="fa fa-star-o fa-stack-2x"></i></span>
           {{ else }}
          <span class="fa fa-stack"><i class="fa fa-star fa-stack-2x"></i><i class="fa fa-star-o fa-stack-2x"></i></span>
          {% endif %}
         {% endfor %}
        </div>
       {% endif %}
        {% if product.price %}
        <p class="price">
          {% if not product.special %}
			{{ product.price }}
			{% else %}
          <span class="price-new">{{ product.special }}</span> <span class="price-old">{{ product.price }}</span>
         {% endif %}
           {% if product.tax %}
          <span class="price-tax">{{ text_tax }} {{ product.tax }}</span>
           {% endif %}
        </p>
       {% endif %}
      </div>
     <div class="button-group">
        <button type="button" onclick="cart.add('{{ product.product_id }}');"><i class="fa fa-shopping-cart"></i> <span class="hidden-xs1 hidden-sm1 hidden-md1">{{ button_cart }}</span></button>
        <button type="button" data-toggle="tooltip" title="{{ button_wishlist }}" onclick="wishlist.add('{{ product.product_id }}');"><i class="fa fa-heart"></i></button>
        <button type="button" data-toggle="tooltip" title="{{ button_compare }}" onclick="compare.add('{{ product.product_id }}');"><i class="fa fa-exchange"></i></button>
      </div>
    </div>
  </div>
  </div>
 {% endfor %}
	</div>
	</div>
	{% endif %}
 <!-- End Seller Featured Productsr  -->]]></add>
	  </operation>
	  <operation error="skip">
			<search><![CDATA[ {{ footer }}  ]]></search>
			<add position="before"><![CDATA[<script type="text/javascript"><!--
				$('#carousel_seller_featured').owlCarousel({
					items:{{ no_Of_product }},
					autoPlay: 3000,
					margin:10,
					navigation: true,
					navigationText: ['<i class="fa fa-chevron-left fa-5x"></i>', '<i class="fa fa-chevron-right fa-5x"></i>'],
					pagination: true
				});
				$( document ).ready(function() {
					$('#carousel_seller_featured .owl-item').addClass("product-grid-item {{ journal2.settings.get('product_grid_classes') }} display-{{ journal2.settings.get('product_grid_wishlist_icon_display')}} {{ journal2.settings.get('product_grid_button_block_button')}}");
				});
--></script>]]></add>
	</operation>
   </file>
   	<file path="catalog/controller/journal3/layout.php">
		<operation error="skip">
			<search><![CDATA[if ($data['modules']) {]]></search>
			<add position="before"><![CDATA[
			$modules = $this->model_design_layout->getLayoutModules($layout_id, $POSITION);

				$this->load->model('setting/module');

				foreach ($modules as $module) {
					$part = explode('.', $module['code']);

					if (isset($part[0]) && $this->config->get('module_' . $part[0] . '_status')) {
						$module_data = $this->load->controller('extension/module/' . $part[0]);

						if ($module_data) {
							$data['modules'][] = $module_data;
						}
					}

					if (isset($part[1])) {
						$setting_info = $this->model_setting_module->getModule($part[1]);

					if ($setting_info && $setting_info['status']) {
							$output = $this->load->controller('extension/module/' . $part[0], $setting_info);

							if ($output) {
								$data['modules'][] = $output;
							}
						}
					}
				}
			]]></add>
			</operation>
	</file>
	<file path="catalog/view/theme/journal2/template/product/category.twig">
	 <operation error="skip">
			<search><![CDATA[{% if journal2.settings.get('refine_category') == 'text' and categories %}]]></search>
			<add position="before"><![CDATA[ 	  <!-- Start Seller Featured Productsr -->
	{% if productss %}  
	<h3>{{ text_seller_featured_products }}</h3>
	<div class="row">
	<div id="carousel_seller_featured" class="owl-carousel">
	{% for product in productss %}
       <div class="">
              <div class="product-thumb product-wrapper {% if product.labels and product.labels.outofstock %} outofstock {% endif %}">
                <div class="image {% if journal2.settings.get('show_countdown', 'never') != 'never' and product.date_end %} has-countdown {% endif %}">
                  <a href="{{ product.href }}" {% if product.thumb2 %} class="has-second-image" style="background: url('{{ product.thumb2 }}') no-repeat" {% endif %}>
                    <img class="lazy first-image" width="{{ journal2.settings.get('config_image_width') }}" height="{{ journal2.settings.get('config_image_height') }}" src="{{ journal2.settings.get('product_dummy_image') }}" data-src="{{ product.thumb }}" title="{{ product.name }}" alt="{{ product.name }}"/>
                  </a>
                  {% for label, name in product.labels %}
                    <span class="label-{{ label }}"><b>{{ name }}</b></span>
                  {% endfor %}
                  {% if journal2.settings.get('product_grid_wishlist_icon_position') == 'image' and journal2.settings.get('product_grid_wishlist_icon_display') == 'icon' %}
                    <div class="wishlist"><a onclick="addToWishList('{{ product.product_id }}');" class="hint--top" data-hint="{{ button_wishlist }}"><i class="wishlist-icon"></i><span class="button-wishlist-text">{{ button_wishlist }}</span></a></div>
                    <div class="compare"><a onclick="addToCompare('{{ product.product_id }}');" class="hint--top" data-hint="{{ button_compare }}"><i class="compare-icon"></i><span class="button-compare-text">{{ button_compare }}</span></a></div>
                  {% endif %}
                </div>
                <div class="product-details">
                  <div class="caption">
                    <h4 class="name"><a href="{{ product.href }}">{{ product.name }}</a></h4>
                    <p class="description">{{ product.description }}</p>
                    {% if product.price %}
                      <div class="price">
                        {% if not product.special %}
                          {{ product.price }}
                        {% else %}
                          <span class="price-old">{{ product.price }}</span> <span class="price-new" {% if product.date_end %}data-end-date="{{ product.date_end }}"{% endif %}>{{ product.special }}</span>
                        {% endif %}
                      </div>
                      {% if product.tax %}
                        <span class="price-tax">{{ text_tax }} {{ product.tax }}</span>
                      {% endif %}
                    {% endif %}
                    {% if product.rating %}
                      <div class="rating">
                        {% for i in 1..5 %}
                          {% if product.rating < i %}
                            <span class="fa fa-stack"><i class="fa fa-star-o fa-stack-2x"></i></span>
                          {% else %}
                            <span class="fa fa-stack"><i class="fa fa-star fa-stack-2x"></i><i class="fa fa-star-o fa-stack-2x"></i></span>
                          {% endif %}
                        {% endfor %}
                      </div>
                    {% endif %}
                  </div>
                  <div class="button-group">
                    {% if staticCall('Journal2Utils', 'isEnquiryProduct', [null, product]) %}
                      <div class="cart enquiry-button">
                        <a href="javascript:Journal.openPopup('{{ journal2.settings.get('enquiry_popup_code') }}', '{{ product.product_id }}');" data-clk="addToCart('{{ product.product_id }}');" class="button hint--top" data-hint="{{ journal2.settings.get('enquiry_button_text') }}">{{ journal2.settings.get('enquiry_button_icon') }}<span class="button-cart-text">{{ journal2.settings.get('enquiry_button_text') }}</span></a>
                      </div>
                    {% else %}
                      <div class="cart {% if product.labels and product.labels.outofstock %} outofstock {% endif %}">
                        <a onclick="addToCart('{{ product.product_id }}');" class="button hint--top" data-hint="{{ button_cart }}"><i class="button-left-icon"></i><span class="button-cart-text">{{ button_cart }}</span><i class="button-right-icon"></i></a>
                      </div>
                    {% endif %}
                    <div class="wishlist"><a onclick="addToWishList('{{ product.product_id }}');" class="hint--top" data-hint="{{ button_wishlist }}"><i class="wishlist-icon"></i><span class="button-wishlist-text">{{ button_wishlist }}</span></a></div>
                    <div class="compare"><a onclick="addToCompare('{{ product.product_id }}');" class="hint--top" data-hint="{{ button_compare }}"><i class="compare-icon"></i><span class="button-compare-text">{{ button_compare }}</span></a></div>
                  </div>
                </div>
              </div>
          </div>
        {% endfor %}
	    </div>
	   </div>
	{% endif %}
 <!-- End Seller Featured Productsr  --> ]]></add>
	 </operation>	
   </file>
		<file path="catalog/controller/account/login.php">
		<operation error="skip">
			<search><![CDATA[$this->response->redirect($this->url->link('account/account', '', true));]]></search>
			<add position="before"><![CDATA[
			if($this->config->get('module_purpletree_multivendor_hide_user_menu')){
				$data['purpletree_module_status'] =$this->config->get('module_purpletree_multivendor_status');
				$store_detail = $this->customer->isSeller();		
					if(isset($data['purpletree_module_status'])){
						if(isset($store_detail['store_status']) && $store_detail['store_status'] == 1 && ($store_detail['multi_store_id'] == $this->config->get('config_store_id'))){	
							$this->response->redirect($this->url->link('extension/account/purpletree_multivendor/dashboardicons','', true));
						  }
					}
			 }
			]]></add>
		</operation>
	</file>
	<file path="catalog/view/theme/*/template/account/order_list.tpl">
		<operation error="skip">
			<search><![CDATA[<td class="text-left"><?php echo $order['status']; ?></td>]]></search>
			<add position="replace"><![CDATA[
			
			<td class="text-left pts-table_order_list" style="padding: 0px;">
				<table style="width: 100%;">
				  <?php foreach($order['status'] as $status) { ?>
					<tr>
						<td class="purpleproductname" style="padding: 5px;">
							<table>
								<?php foreach($status['product'] as $product) { ?>
									<tr>
										<td><?php echo $product['product_name']; ?></td>
									</tr>
								<?php } ?>
							</table>
						</td>
						<td class="purplstatus" style="text-align:right;padding:11px;"><?php echo $status['order_status']; ?></td>
					</tr>
				  <?php } ?>
				</table>
			  </td>
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[<td class="text-xs-left"><?php echo $order['status']; ?></td>]]></search>
			<add position="replace"><![CDATA[
			<td class="text-left pts-table_order_list" style="padding: 0px;">
				<table style="width: 100%;">
				  <?php foreach($order['status'] as $status) { ?>
					<tr>
						<td class="purpleproductname" style="padding: 5px;">
							<table>
								<?php foreach($status['product'] as $product) { ?>
									<tr>
										<td><?php echo $product['product_name']; ?></td>
									</tr>
								<?php } ?>
							</table>
						</td>
						<td class="purplstatus" style="text-align:right;padding:11px;"><?php echo $status['order_status']; ?></td>
					</tr>
				  <?php } ?>
				</table>
			  </td>
			]]></add>
		</operation>
	</file>	
	<file path="catalog/view/theme/*/template/common/header/header_01.tpl">		
		<operation error="skip">
			<search><![CDATA[<div class="col-sm-4" id="header-center">]]></search>
			<add position="after"><![CDATA[
			<!--Browse Sellers -->
                <?php if ($module_purpletree_multivendor_browse_sellers) { ?>
	                <div style="margin-top: 39px;margin-left: -145px;">
					<i class="fa fa-user fas fa user-o" aria-hidden="true"></i> 
					<span><a href=<?php echo $seller_register_link; ?>><?php echo $text_seller_register ?></a></span>
					<i class="fa fa-users" aria-hidden="true" ></i> 
	                <span><a  href=<?php echo $browse_seller_link; ?>><?php echo $text_browse_sellers; ?></a></span></div>	
	            <?php } ?>
            <!--Browse Sellers End-->
			]]></add>
		</operation>
	</file>
		<file path="catalog/view/theme/*/template/product/product.tpl">
		<operation error="skip">
			<search><![CDATA[<span><?php echo $text_stock; ?></span> <?php echo $stock; ?></div>]]></search>
			<add position="after" offset="1"><![CDATA[
			<!--Purpletree Software Code -->
			    <?php if(!empty($seller_detail)) { ?>
				<li style="list-style: none;"><?php echo $text_seller_label; ?> <a href="<?php echo $seller_detail['seller_href']; ?>"><?php echo $seller_detail['seller_name']; ?></a></li>
				<?php if($seller_review_status) { ?>
				<li style="list-style: none;"><?php if ($seller_detail['seller_rating']) { ?>
				<div class="rating"  style="display:inline !important;">&nbsp;&nbsp;
					<?php echo $text_seller_rating; ?>&nbsp;&nbsp;
					  <?php for ($i = 1; $i <= 5; $i++) { ?>
					  <?php if ($seller_detail['seller_rating'] < $i) { ?>
					  <span class="fa fa-stack"><i class="fa fa-star-o fa-stack-1x"></i></span>
					  <?php } else { ?>
					  <span class="fa fa-stack"><i class="fa fa-star fa-stack-1x"></i></span>
					  <?php } ?>
					  <?php } ?> <a href="<?php echo $seller_detail['seller_review_link']; ?>"><?php echo $seller_detail['seller_count'];?> <?php echo $text_seller_review; ?></a>
					</div>
					<?php } else { ?>
					<div class="rating"  style="display:inline !important;"><?php echo $text_seller_rating; ?>&nbsp;&nbsp;
						<?php for ($i = 1; $i <= 5; $i++) { ?>
							<span class="fa fa-stack"><i class="fa fa-star-o fa-stack-1x"></i></span>
						<?php } ?>
						<a href="<?php echo $seller_detail['seller_review_link']; ?>"><?php echo $seller_detail['seller_count'];?> <?php echo $text_seller_review; ?></a></div>
					<?php } ?></li>
				 <?php } ?>
				 <li style="list-style: none;"><a href="<?php echo $seller_detail['seller_contact_link']; ?>"><?php echo $text_seller_contact; ?></a></li>
			 <?php } ?>
		    <!--Purpletree Software End-->
			]]></add>
		</operation>
	</file>
	<file path="catalog/view/theme/*/template/extension/module/account.tpl">
		<operation error="skip">
			<search><![CDATA[<li><a href="<?php echo $address; ?>"><?php echo $text_address; ?></a></li>]]></search>
			<add position="before"><![CDATA[
		<!--Purpletree Software-->
	        <?php if($sellercontact_module==1 and $purpletree_module_status==1) { ?>
		    <a class="list-group-item" href="<?php echo $sellercontact; ?>"><?php echo $text_seller_contact1 ; ?></a>
            <?php } ?>
	    <!--Purpletree Software End-->
			]]></add>
		</operation>
	</file>
    <file path="catalog/view/theme/*/template/account/order_info.tpl">
	    <operation error="skip">
	       <search><![CDATA[<td class="text-left"><?php echo $history['comment']; ?></td>]]></search>
		   <add position="after"><![CDATA[
	       <td class="text-left"><?php echo $history['updated_by']; ?></td>
		   ]]></add>
	    </operation>
	    <operation error="skip">
			<search><![CDATA[<td class="text-left"><?php echo $column_comment; ?></td>]]></search>
			<add position="after"><![CDATA[
			<td class="text-left"><?php echo $column_updated_by; ?></td>
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[<td class="text-left"><?php echo $column_date_added; ?></td>]]></search>
			<add position="before"><![CDATA[
			<td class="text-left"><?php $column_name; ?></td>
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[<td class="text-left"><?php echo $column_date_added; ?></td>]]></search>
			<add position="before"><![CDATA[
			<td class="text-left"><?php $column_name; ?></td>
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[<td class="text-left"><?php echo $history['date_added']; ?></td>]]></search>
			<add position="before"><![CDATA[
					<td class="text-left">
				<table>
					<?php foreach($history['product_name'] as $product) { ?>
						<tr>
							<td><?php echo $product['product_name']; ?></td>
						</tr>
					<?php } ?>
				</table>
			</td>
			]]></add>
		</operation>
	</file> 
	<file path="catalog/view/theme/*/template/common/header.tpl">
	    <operation error="skip">
	       <search><![CDATA[include('catalog/view/theme/'.$config->get('theme_' . $config->get('config_theme') . '_directory').'/template/common/header/header_01.tpl');]]></search>
		   <add position="before"><![CDATA[
$file1 = "";
		if (is_dir(DIR_MODIFICATION . 'catalog/view/theme/')) {
			$file1 = DIR_MODIFICATION . 'catalog/view/theme/'.$config->get('theme_' . $config->get('config_theme') . '_directory').'/template/common/header/header_01.tpl';
		}
		if (is_file($file1)) {
			include($file1);
		} else {
]]></add>
		</operation>
		<operation error="skip">
	       <search><![CDATA[include('catalog/view/theme/'.$config->get('theme_' . $config->get('config_theme') . '_directory').'/template/common/header/header_01.tpl');]]></search>
		   <add position="after"><![CDATA[
			}
			]]></add>
		</operation>		
	</file> 
		   <file path="catalog/view/theme/*/template/product/category.tpl">
	    <operation error="skip">
	       <search><![CDATA[<?php if ($products) { ?>]]></search>
		   <add position="before"><![CDATA[<!-- Start Seller Featured Products -->
	<?php if ($productss) { ?>  
     <h3><?php echo $text_seller_featured_products; ?></h3>
	<div class="row">
	<div id="carousel_seller_featured1" class="owl-carousel">
	<?php foreach ($productss as $product) { ?>
  <div class="item text-center">
  <div class="pts-product-layout" style="padding:10px;">
    <div class="pts-product-thumb transition">
      <div class="image"><a href="<?php echo $product['href']; ?>"><img src="<?php echo $product['thumb']; ?>" alt="<?php echo $product['name']; ?>" title="<?php echo $product['name']; ?>" class="img-responsive" /></a></div>
      <div class="pts-caption" style="min-height:auto !important">
        <h4><a href="<?php echo $product['href']; ?>"><?php echo $product['name']; ?></a></h4>
        <p><?php echo $product['description']; ?></p>
        <?php if ($product['rating']) { ?>
        <div class="rating">
          <?php for ($i = 1; $i <= 5; $i++) { ?>
          <?php if ($product['rating'] < $i) { ?>
          <span class="fa fa-stack"><i class="fa fa-star-o fa-stack-2x"></i></span>
          <?php } else { ?>
          <span class="fa fa-stack"><i class="fa fa-star fa-stack-2x"></i><i class="fa fa-star-o fa-stack-2x"></i></span>
          <?php } ?>
          <?php } ?>
        </div>
       <?php } ?>
      <?php if ($product['price']) { ?>
        <p class="price">
          <?php if (!$product['special']) { ?>
          <?php echo $product['price']; ?>
          <?php } else { ?>
          <span class="price-new"><?php echo $product['special']; ?></span> <span class="price-old"><?php echo $product['price']; ?></span>
          <?php } ?>
          <?php if ($product['tax']) { ?>
          <span class="price-tax"><?php echo $text_tax; ?> <?php echo $product['tax']; ?></span>
          <?php } ?>
        </p>
        <?php } ?>
      </div>
	   <div class="button-group">
        <button type="button" onclick="cart.add('<?php echo $product['product_id']; ?>');"><i class="fa fa-shopping-cart"></i> <span class="hidden-xs1 hidden-sm1 hidden-md"><?php echo $button_cart; ?></span></button>
        <button type="button" data-toggle="tooltip" title="<?php echo $button_wishlist; ?>" onclick="wishlist.add('<?php echo $product['product_id']; ?>');"><i class="fa fa-heart"></i></button>
        <button type="button" data-toggle="tooltip" title="<?php echo $button_compare; ?>" onclick="compare.add('<?php echo $product['product_id']; ?>');"><i class="fa fa-exchange"></i></button>
      </div>
    </div>
  </div>
  </div>
	<?php } ?>
	</div>
	</div>
	<?php } ?>
 <!-- End Seller Featured Product-->]]></add>
	    </operation>	   
		<operation error="skip">
	       <search><![CDATA[<?php echo $footer; ?>]]></search>
		   <add position="before"><![CDATA[<script type="text/javascript"><!--
$('#carousel_seller_featured1').owlCarousel({
					items:3,
					autoPlay: 3000,
					margin:10,
					navigation: true,
					navigationText: ['<i class="fa fa-chevron-left fa-5x"></i>', '<i class="fa fa-chevron-right fa-5x"></i>'],
					pagination: true
				});

//--></script>]]></add>
	    </operation>
	</file>

	<file path="system/library/template/twig.php">
	    <operation error="skip">
	       <search><![CDATA[$file = DIR_TEMPLATE . $template . '.tpl';]]></search>
		   <add position="after"><![CDATA[$file1 = "";
		   if (is_dir(DIR_MODIFICATION . 'catalog/view/theme/')) {
			$file1 = DIR_MODIFICATION . 'catalog/view/theme/' . $template . '.tpl';
		}]]></add>
		</operation>
		<operation error="skip">
	       <search><![CDATA[public function render($template, $cache = false) {]]></search>
		   <add position="after"><![CDATA[$file1 = DIR_MODIFICATION . 'catalog/view/theme/' . $template . '.tpl';]]></add>
		</operation>	<operation error="skip">
	       <search><![CDATA[$file = str_replace("default/","fastor/",$file);]]></search>
		   <add position="after"><![CDATA[$file1 = str_replace("default/","fastor/",$file1);]]></add>
		</operation>
		<operation error="skip">
	       <search><![CDATA[if (is_file($file)) {]]></search>
		   <add position="before"><![CDATA[if (is_file($file1)) {
			
			extract($this->data);

			ob_start();

			require($file1);

			return ob_get_clean();
		}]]></add>
		</operation>
	</file>
<file path="catalog/view/theme/*/template/account/register.tpl">
		<operation error="skip">
			<search><![CDATA[<?php echo $captcha; ?>]]></search>
			<add position="before" offset="0"><![CDATA[
			<?php if(!empty($module_purpletree_multivendor_status) && !empty($module_purpletree_multivendor_become_seller)) { ?>
			<fieldset>
			<legend><?php echo $text_seller_heading; ?></legend>
				<div class="form-group">
				<label class="col-sm-2 control-label"><?php echo $text_seller; ?></label>
				<div class="col-sm-10">
				<label class="radio-inline">
                <input type="radio" name="become_seller" value="1" id="add_document" />
                <?php echo $text_yes; ?></label>
				<label class="radio-inline">
                <input type="radio" name="become_seller" value="0" checked="checked" id="remove_document" />
                <?php echo $text_no; ?></label>
            </div>
            </div>
			</fieldset>
			<?php } ?>
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[<p><?php echo $text_account_already; ?></p>]]></search>
			<add position="before" offset="0"><![CDATA[
			 <?php if ($error_warning1) { ?>
			  <div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> <?php echo $error_warning1; ?></div>
			  <?php } ?>
			]]></add>
		</operation>
	</file>	
	<file path="catalog/controller/checkout/payment_method.php">
		<operation error="skip">
			<search><![CDATA[$this->response->setOutput($this->load->view('checkout/payment_method', $data));]]></search>
			<add position="before"><![CDATA[
			$data['module_purpletree_multivendor_status']=$this->config->get('module_purpletree_multivendor_status');
			$data['payment_pp_adaptive_status']=$this->config->get('payment_pp_adaptive_status');
			]]></add>
		</operation>
	</file>	
		<file path="catalog/view/theme/*/template/checkout/payment_method.twig">
		<operation error="skip">
			<search><![CDATA[<input type="radio" name="payment_method" value="{{ payment_method.code }}" checked="checked" />]]></search>
			<add position="replace"><![CDATA[
			{% if module_purpletree_multivendor_status %}
			{% if payment_pp_adaptive_status %}
			 <input type="radio" name="payment_method" value="{{ payment_method.code }}"{% if payment_method.code=='pp_adaptive1' %} {% else %} checked="checked" {% endif %}  {% if payment_method.code=='pp_adaptive1' %} disabled="disabled" {% endif %} />
			 {% else %}
			  <input type="radio" name="payment_method" value="{{ payment_method.code }}" checked="checked" />
			  {% endif %}
			 {% else %}
			 <input type="radio" name="payment_method" value="{{ payment_method.code }}" checked="checked" />
			 {% endif %}
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[ <input type="radio" name="payment_method" value="{{ payment_method.code }}" />]]></search>
			<add position="replace"><![CDATA[
			{% if module_purpletree_multivendor_status %}
			{% if payment_pp_adaptive_status %}
			<input type="radio" name="payment_method" value="{{ payment_method.code }}" {% if payment_method.code=='pp_adaptive1' %} disabled="disabled" {% endif %} />
			 {% else %}
			   <input type="radio" name="payment_method" value="{{ payment_method.code }}" />
			  {% endif %}
			 {% else %}
			  <input type="radio" name="payment_method" value="{{ payment_method.code }}" />
			 {% endif %}
			]]></add>
		</operation>
	</file>	
</modification>
